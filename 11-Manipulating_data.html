<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manual Basico da Linguagem R - 12&nbsp; Manipulando dados</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-Ploting_graphics.html" rel="next">
<link href="./10-Reading_data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Manipulando dados</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Manual Basico da Linguagem R</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-prefacio.html" class="sidebar-item-text sidebar-link">Prefácio <strong>da Segunda Edição</strong></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introdução</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Instalation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Instalação do R e do RStudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-RStudio.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RStudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-R-Projects.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Projetos do R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-R-Objects-Variables-Vectors.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Objetos do R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Dataframes-and-Tibbles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Frames e Tibbles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Operators.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Operadores no R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-R-Functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Funções no R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-R-Packages.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Pacotes do R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Reading_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lendo dados</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-Manipulating_data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Manipulando dados</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Ploting_graphics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Gráficos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Statistical_Analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Análises Estatísticas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Distributions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Distribuições de Probabilidade</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Simulations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Simulações</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-Datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Conclusion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Conclusão</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-tidyr" id="toc-sec-tidyr" class="nav-link active" data-scroll-target="#sec-tidyr"><span class="toc-section-number">12.1</span>  Organizando e transformando dados com tidyr</a>
  <ul class="collapse">
  <li><a href="#reformatação-de-dados-longo-para-largo-e-vice-versa" id="toc-reformatação-de-dados-longo-para-largo-e-vice-versa" class="nav-link" data-scroll-target="#reformatação-de-dados-longo-para-largo-e-vice-versa"><span class="toc-section-number">12.1.1</span>  Reformatação de Dados: Longo para Largo e Vice-Versa</a></li>
  <li><a href="#separando-e-unindo-colunas" id="toc-separando-e-unindo-colunas" class="nav-link" data-scroll-target="#separando-e-unindo-colunas"><span class="toc-section-number">12.1.2</span>  Separando e unindo colunas</a></li>
  <li><a href="#sec-NAvalues" id="toc-sec-NAvalues" class="nav-link" data-scroll-target="#sec-NAvalues"><span class="toc-section-number">12.1.3</span>  NA Values</a></li>
  </ul></li>
  <li><a href="#sec-dplyr" id="toc-sec-dplyr" class="nav-link" data-scroll-target="#sec-dplyr"><span class="toc-section-number">12.2</span>  Manipulando dados com <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#funções-mais-importantes-do-dplyr" id="toc-funções-mais-importantes-do-dplyr" class="nav-link" data-scroll-target="#funções-mais-importantes-do-dplyr"><span class="toc-section-number">12.2.1</span>  Funções Mais Importantes do dplyr</a></li>
  <li><a href="#filtrando-linhas-com-filter" id="toc-filtrando-linhas-com-filter" class="nav-link" data-scroll-target="#filtrando-linhas-com-filter"><span class="toc-section-number">12.2.2</span>  Filtrando linhas com <code>filter()</code></a></li>
  <li><a href="#selecionando-colunas-com-select" id="toc-selecionando-colunas-com-select" class="nav-link" data-scroll-target="#selecionando-colunas-com-select"><span class="toc-section-number">12.2.3</span>  Selecionando colunas com <code>select()</code></a></li>
  <li><a href="#extraindo-valores-com-pull" id="toc-extraindo-valores-com-pull" class="nav-link" data-scroll-target="#extraindo-valores-com-pull"><span class="toc-section-number">12.2.4</span>  Extraindo valores com <code>pull()</code></a></li>
  <li><a href="#criando-novas-variáveis-com-mutate" id="toc-criando-novas-variáveis-com-mutate" class="nav-link" data-scroll-target="#criando-novas-variáveis-com-mutate"><span class="toc-section-number">12.2.5</span>  Criando novas variáveis com <code>mutate()</code></a></li>
  <li><a href="#ordenando-dados-com-arrange" id="toc-ordenando-dados-com-arrange" class="nav-link" data-scroll-target="#ordenando-dados-com-arrange"><span class="toc-section-number">12.2.6</span>  Ordenando dados com <code>arrange()</code></a></li>
  <li><a href="#agrupando-dadoc-com-group_by-e-by" id="toc-agrupando-dadoc-com-group_by-e-by" class="nav-link" data-scroll-target="#agrupando-dadoc-com-group_by-e-by"><span class="toc-section-number">12.2.7</span>  Agrupando dadoc com <code>group_by()</code> e <code>by()</code></a></li>
  <li><a href="#desagrupando-dados-com-ungroup" id="toc-desagrupando-dados-com-ungroup" class="nav-link" data-scroll-target="#desagrupando-dados-com-ungroup"><span class="toc-section-number">12.2.8</span>  Desagrupando dados com <code>ungroup()</code></a></li>
  <li><a href="#renomeando-colunas-rename" id="toc-renomeando-colunas-rename" class="nav-link" data-scroll-target="#renomeando-colunas-rename"><span class="toc-section-number">12.2.9</span>  Renomeando colunas <code>rename()</code></a></li>
  <li><a href="#recodificando-valores-com-recode" id="toc-recodificando-valores-com-recode" class="nav-link" data-scroll-target="#recodificando-valores-com-recode"><span class="toc-section-number">12.2.10</span>  Recodificando valores com <code>recode()</code></a></li>
  <li><a href="#combinando-data-frames-com-bind_rows-e-bind_cols" id="toc-combinando-data-frames-com-bind_rows-e-bind_cols" class="nav-link" data-scroll-target="#combinando-data-frames-com-bind_rows-e-bind_cols"><span class="toc-section-number">12.2.11</span>  Combinando data frames com <code>bind_rows()</code> e <code>bind_cols()</code></a></li>
  <li><a href="#removendo-linhas-duplicadas-com-distinct" id="toc-removendo-linhas-duplicadas-com-distinct" class="nav-link" data-scroll-target="#removendo-linhas-duplicadas-com-distinct"><span class="toc-section-number">12.2.12</span>  Removendo linhas duplicadas com <code>distinct()</code></a></li>
  <li><a href="#sec-count" id="toc-sec-count" class="nav-link" data-scroll-target="#sec-count"><span class="toc-section-number">12.2.13</span>  Contando observações com <code>count()</code></a></li>
  </ul></li>
  <li><a href="#sec-forcats" id="toc-sec-forcats" class="nav-link" data-scroll-target="#sec-forcats"><span class="toc-section-number">12.3</span>  Trabalhando com dados categóricos com <code>forcats</code></a>
  <ul class="collapse">
  <li><a href="#variáveis-categóricas-e-factor-do-r" id="toc-variáveis-categóricas-e-factor-do-r" class="nav-link" data-scroll-target="#variáveis-categóricas-e-factor-do-r"><span class="toc-section-number">12.3.1</span>  Variáveis categóricas e <code>factor</code> do R</a></li>
  <li><a href="#manipulando-variáveis-categóricas-com-forcats" id="toc-manipulando-variáveis-categóricas-com-forcats" class="nav-link" data-scroll-target="#manipulando-variáveis-categóricas-com-forcats"><span class="toc-section-number">12.3.2</span>  Manipulando variáveis categóricas com <code>forcats</code></a></li>
  <li><a href="#agrupando-categorias" id="toc-agrupando-categorias" class="nav-link" data-scroll-target="#agrupando-categorias"><span class="toc-section-number">12.3.3</span>  Agrupando categorias</a></li>
  <li><a href="#sec-recodingfactors" id="toc-sec-recodingfactors" class="nav-link" data-scroll-target="#sec-recodingfactors"><span class="toc-section-number">12.3.4</span>  Recodificando variáveis categóricas</a></li>
  <li><a href="#ordenando-de-acordo-com-a-frequencia-dos-elementos" id="toc-ordenando-de-acordo-com-a-frequencia-dos-elementos" class="nav-link" data-scroll-target="#ordenando-de-acordo-com-a-frequencia-dos-elementos"><span class="toc-section-number">12.3.5</span>  Ordenando de acordo com a frequencia dos elementos</a></li>
  <li><a href="#categorizando-variáveis-numéricas-com-a-função-cut" id="toc-categorizando-variáveis-numéricas-com-a-função-cut" class="nav-link" data-scroll-target="#categorizando-variáveis-numéricas-com-a-função-cut"><span class="toc-section-number">12.3.6</span>  Categorizando variáveis numéricas com a função cut( )</a></li>
  </ul></li>
  <li><a href="#tabulando-dados-categóricos" id="toc-tabulando-dados-categóricos" class="nav-link" data-scroll-target="#tabulando-dados-categóricos"><span class="toc-section-number">12.4</span>  Tabulando dados categóricos</a>
  <ul class="collapse">
  <li><a href="#preparando-as-variáveis-categóricas-para-tabulação." id="toc-preparando-as-variáveis-categóricas-para-tabulação." class="nav-link" data-scroll-target="#preparando-as-variáveis-categóricas-para-tabulação."><span class="toc-section-number">12.4.1</span>  Preparando as variáveis categóricas para tabulação.</a></li>
  <li><a href="#tabulando-variáveis-categóricas" id="toc-tabulando-variáveis-categóricas" class="nav-link" data-scroll-target="#tabulando-variáveis-categóricas"><span class="toc-section-number">12.4.2</span>  Tabulando variáveis categóricas</a></li>
  </ul></li>
  <li><a href="#trabalhando-com-dados-numéricos" id="toc-trabalhando-com-dados-numéricos" class="nav-link" data-scroll-target="#trabalhando-com-dados-numéricos"><span class="toc-section-number">12.5</span>  Trabalhando com Dados Numéricos</a>
  <ul class="collapse">
  <li><a href="#estatística-descritiva-para-dados-numéricos" id="toc-estatística-descritiva-para-dados-numéricos" class="nav-link" data-scroll-target="#estatística-descritiva-para-dados-numéricos"><span class="toc-section-number">12.5.1</span>  Estatística Descritiva para dados numéricos</a></li>
  <li><a href="#agrupando-dados-numéricos" id="toc-agrupando-dados-numéricos" class="nav-link" data-scroll-target="#agrupando-dados-numéricos"><span class="toc-section-number">12.5.2</span>  Agrupando dados numéricos</a></li>
  <li><a href="#categorizando-variáveis-numéricas" id="toc-categorizando-variáveis-numéricas" class="nav-link" data-scroll-target="#categorizando-variáveis-numéricas"><span class="toc-section-number">12.5.3</span>  Categorizando variáveis numéricas</a></li>
  </ul></li>
  <li><a href="#resumindo-dados" id="toc-resumindo-dados" class="nav-link" data-scroll-target="#resumindo-dados"><span class="toc-section-number">12.6</span>  Resumindo dados</a>
  <ul class="collapse">
  <li><a href="#resumindo-dados-com-summary" id="toc-resumindo-dados-com-summary" class="nav-link" data-scroll-target="#resumindo-dados-com-summary"><span class="toc-section-number">12.6.1</span>  Resumindo dados com <code>summary()</code></a></li>
  <li><a href="#resumindo-dados-com-summarise-do-pacote-dplyr" id="toc-resumindo-dados-com-summarise-do-pacote-dplyr" class="nav-link" data-scroll-target="#resumindo-dados-com-summarise-do-pacote-dplyr"><span class="toc-section-number">12.6.2</span>  Resumindo dados com <code>summarise()</code> do pacote <code>dplyr</code></a></li>
  <li><a href="#resumindo-dados-com-skim-do-pacote-skimr" id="toc-resumindo-dados-com-skim-do-pacote-skimr" class="nav-link" data-scroll-target="#resumindo-dados-com-skim-do-pacote-skimr"><span class="toc-section-number">12.6.3</span>  Resumindo dados com <code>skim()</code> do pacote <code>skimr</code></a></li>
  <li><a href="#resumindo-dados-com-describe-do-pacote-psych" id="toc-resumindo-dados-com-describe-do-pacote-psych" class="nav-link" data-scroll-target="#resumindo-dados-com-describe-do-pacote-psych"><span class="toc-section-number">12.6.4</span>  Resumindo dados com <code>describe()</code> do pacote <code>psych</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Manipulando dados</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Neste capítulo, vamos aprender a manipular dados com os pacotes <code>dplyr</code> e <code>tidyr</code>. O <code>dplyr</code> é um pacote que fornece um conjunto de funções para manipulação de dados que são rápidas e fáceis de usar. O <code>tidyr</code> é um pacote que fornece um conjunto de funções para organizar dados em um formato mais limpo e organizado. Vamos aprender a usar esses pacotes para manipular dados de forma eficiente e eficaz. Em seguida vamos aprender a usar o pacote <code>forcats</code> para manipular dados categóricos de forma eficiente e eficaz. Finalmente vamos ver como analisar dados numéricos e fazer a sumarização de dados.</p>
<section id="sec-tidyr" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="sec-tidyr"><span class="header-section-number">12.1</span> Organizando e transformando dados com tidyr</h2>
<p>Na análise de dados na área da saúde, frequentemente lidamos com conjuntos de dados que precisam ser organizados de maneira eficiente para facilitar a análise e a visualização. O pacote <strong><code>tidyr</code></strong> do R é uma ferramenta poderosa para a manipulação e transformação de dados, permitindo que você organize seus dados de forma “arrumada” (tidy).</p>
<p>O <strong><code>tidyr</code></strong> faz parte do universo <strong><code>tidyverse</code></strong>, uma coleção de pacotes R projetados para ciência de dados. Ele fornece funções que facilitam a conversão de dados em formatos que são mais compatíveis com outros pacotes do <strong><code>tidyverse</code></strong>, como <strong><code>dplyr</code></strong>, <strong><code>ggplot2</code></strong> e <strong><code>readr</code></strong>.</p>
<p>Neste capítulo, exploraremos as principais funções do <strong><code>tidyr</code></strong>, incluindo:</p>
<ul>
<li><p><strong><code>pivot_longer()</code></strong> e <strong><code>pivot_wider()</code></strong>: funções para converter dados entre formatos largos e longos, sucessores modernos das funções <strong><code>gather()</code></strong> e <strong><code>spread()</code></strong>, oferecendo maior flexibilidade e controle.</p></li>
<li><p><strong><code>separate()</code></strong> e <strong><code>unite()</code></strong>: funções para dividir e combinar colunas, respectivamente.</p></li>
<li><p><strong><code>drop_na()</code></strong>: função para remover linhas com valores ausentes.</p></li>
<li><p><strong><code>replace_na()</code></strong>: função para remover linhas com valores ausentes.</p></li>
</ul>
<p>Vamos começar explorando como o <strong><code>tidyr</code></strong> pode simplificar a manipulação de dados e permitir que você se concentre nas análises que realmente importam para suas pesquisas e práticas na área da saúde.</p>
<section id="reformatação-de-dados-longo-para-largo-e-vice-versa" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="reformatação-de-dados-longo-para-largo-e-vice-versa"><span class="header-section-number">12.1.1</span> Reformatação de Dados: Longo para Largo e Vice-Versa</h3>
<p>Em análise de dados, os termos “dados longos” e “dados largos” referem-se a diferentes formas de estruturar conjuntos de dados. Dados largos, também conhecidos como formato “tidy”, são caracterizados por uma estrutura em que cada variável tem sua própria coluna e cada observação tem sua própria linha. Este formato é intuitivo para visualização direta e facilita a manipulação de dados em muitos casos, especialmente quando se trabalha com pacotes do <code>tidyverse</code>.</p>
<p>Por outro lado, dados longos possuem uma coluna para variáveis e outra para valores, permitindo múltiplas entradas para uma mesma entidade. Este formato é particularmente útil para análises temporais ou categóricas, onde múltiplas medições são realizadas para cada entidade. A habilidade de transformar dados entre esses formatos, utilizando funções como <code>pivot_longer()</code> e <code>pivot_wider()</code>, é crucial para uma análise eficiente e precisa, adaptando os dados à necessidade específica da tarefa analítica.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/long_dataframe.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Long data frame</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="a-função-pivot_longer-e-pivot_wider" class="level4" data-number="12.1.1.1">
<h4 data-number="12.1.1.1" class="anchored" data-anchor-id="a-função-pivot_longer-e-pivot_wider"><span class="header-section-number">12.1.1.1</span> A função <code>pivot_longer()</code> e <code>pivot_wider</code></h4>
<p>Na seção sobre data frames mostramos que o layout mais comum de um data frame é chamado de <strong>wide</strong>, na qual as linhas representam observações e as colunas representam variáveis. Mas nem sempre os data frames vem organizados da forma como precisamos. Às vezes uma variável está distribuída em mais de uma coluna.</p>
<p>Num dataset que construimos em seções anteriores, por exemplo, existem duas colunas para representar os resultados de 2 diferentes tipos de tratamento, A e B. Essa separação pode ajudar a comparar visualmente os 2 tratamentos numa tabela.</p>
<p>Mas, pode ser interessante agrupar essas duas colunas num única variável, que poderíamos chamar de tratamento. Ou seja, podemos representar esse dados de duas formas, chamadas de <code>wide</code> ou <code>long</code>.</p>
<p>Esse agrupamento de duas ou mais colunas em uma única variável é feito com a função <code>pivot_longer()</code>.</p>
<p>Vamos recriar esse dataset novamente aqui, com 3 pacientes e os 2 tipos de tratamento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criando os vetores do data frame simulado</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacientes   <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"João"</span>, <span class="st">"José"</span>, <span class="st">"Maria"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tratamentoA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">16</span>,<span class="dv">20</span>) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tratamentoB <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">8</span>,<span class="dv">9</span>) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># criando o data frame a partir dos vetores já criados</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pacientes, tratamentoA, tratamentoB)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mostrando o data frame criado</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  pacientes tratamentoA tratamentoB
1      João          25          12
2      José          16           8
3     Maria          20           9</code></pre>
</div>
</div>
<p>Veja que esse novo data frame possui 3 linhas e as colunas <code>tratamentoA</code> e <code>tratamentoB</code> com os resultados de cada tratamento.</p>
<p>O que precisamos é unir essas duas últimas colunas (<code>tratamentoA</code> e <code>tratamentoB</code>) em uma única coluna que iremos denominar simplesmente de <code>tratamento</code>.</p>
<p>Observe que o data frame no formato <code>long</code> terá 6 linhas, o dobro do anterior, e que os valores das duas antigas colunas(<code>tratamentoA</code> e <code>tratamentoB</code>) foram todos inseridos na coluna denominada <code>tratamento</code>. Observe que os resultados de cada tratamento foram colocados numa outra coluna que denominei de <code>scores</code>.</p>
<p>Ou seja, não há perda de informação, apenas uma modificação do layout do data frame, que é usualmente denominado de <strong>long</strong>, pelo fato de ser mais comprido que o anterior.</p>
<p>Essa transformação é realizada com a função <code>pivo_longer()</code>, como mostram os códigos abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o tidyr para usar a função pivot_longer</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># transformando a tibble para o formato long</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>result.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(result,                               </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cols=</span><span class="fu">c</span>(<span class="st">"tratamentoA"</span>, <span class="st">"tratamentoB"</span>), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">names_to =</span> <span class="st">"tratamento"</span>,               </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">values_to =</span> <span class="st">"scores"</span>)                 </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>result.long </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  pacientes tratamento  scores
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
1 João      tratamentoA     25
2 João      tratamentoB     12
3 José      tratamentoA     16
4 José      tratamentoB      8
5 Maria     tratamentoA     20
6 Maria     tratamentoB      9</code></pre>
</div>
</div>
<p>Ou usando o operador pipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>result.long <span class="ot">&lt;-</span> result <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span>(<span class="st">"tratamentoA"</span>, <span class="st">"tratamentoB"</span>), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">names_to =</span> <span class="st">"tratamento"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">values_to =</span> <span class="st">"scores"</span>)              </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>result.long </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  pacientes tratamento  scores
  &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
1 João      tratamentoA     25
2 João      tratamentoB     12
3 José      tratamentoA     16
4 José      tratamentoB      8
5 Maria     tratamentoA     20
6 Maria     tratamentoB      9</code></pre>
</div>
</div>
<p>O que a função <code>pivot_longer()</code> fez foi:</p>
<ol type="1">
<li>Carregou o data frame indicado (<code>result</code>),</li>
<li>Selecionou as colunas indicadas no argumento <code>cols=c("tratamentoA" e "tratamentoB").</code></li>
<li>Criou uma coluna chamada <code>tratamento</code> e colocou nessa coluna os nomes <code>tratamentoA</code> e <code>tratamentoB</code>.</li>
<li>Criou uma coluna chamada <code>scores</code> e colocou nessa coluna os valores que antes estavam nas colunas <code>tratamentoA</code> e <code>tratamentoB</code>.</li>
</ol>
<p>A função <code>pivot_wider()</code> faz justamente o oposto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>result.long <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"tratamento"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">values_from =</span> <span class="st">"scores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  pacientes tratamentoA tratamentoB
  &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;
1 João               25          12
2 José               16           8
3 Maria              20           9</code></pre>
</div>
</div>
<p>Vejamos como a transformação do data frame na versão long facilita a criação de um gráfico. Com esse novo formato, podemos usare a função <code>geom_boxplot</code> do <code>ggplot</code> para criar boxplots de cada tipo de tratamento, o que seria bem mais difícil no data frame do tipo wide.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result.long) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>tratamento, <span class="at">y=</span>scores)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="separando-e-unindo-colunas" class="level3" data-number="12.1.2">
<h3 data-number="12.1.2" class="anchored" data-anchor-id="separando-e-unindo-colunas"><span class="header-section-number">12.1.2</span> Separando e unindo colunas</h3>
<p>Quando trabalhamos com conjuntos de dados na área da saúde, muitas vezes encontramos situações em que precisamos dividir uma coluna em várias ou combinar várias colunas em uma só. As funções <code>separate()</code> e <code>unite()</code> do pacote tidyr são projetadas exatamente para essas tarefas.</p>
<section id="função-separate" class="level4" data-number="12.1.2.1">
<h4 data-number="12.1.2.1" class="anchored" data-anchor-id="função-separate"><span class="header-section-number">12.1.2.1</span> Função separate()</h4>
<p>A função <code>separate()</code> é usada para dividir uma coluna em duas ou mais colunas. Esta função é especialmente útil quando uma coluna contém informações que podem ser separadas por um delimitador (como uma vírgula, espaço ou qualquer outro caractere).</p>
<p>Imagine que temos um conjunto de dados com uma coluna chamada <code>data_hora</code> que contém informações de data e hora combinadas numa única coluna como mostrado no código abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id_paciente =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data_hora =</span> <span class="fu">c</span>(<span class="st">"2024-05-01 14:30"</span>, <span class="st">"2024-05-02 09:15"</span>, <span class="st">"2024-05-03 18:45"</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente        data_hora
1           1 2024-05-01 14:30
2           2 2024-05-02 09:15
3           3 2024-05-03 18:45</code></pre>
</div>
</div>
<p>Nesse caso, será útil colocar a data em uma coluna e a hora em outra coluna. A sintaxe da função separate é a seguinte:</p>
<p><code>separate(data, col, into, sep = " ")</code></p>
<ul>
<li>data: O conjunto de dados, o dataset</li>
<li>col: A coluna a ser separada.</li>
<li>into: Um vetor de novos nomes de colunas.</li>
<li>sep: O delimitador que separa os valores (por padrão, é um espaço).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando separate para dividir a coluna data_hora em data e hora</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dados_separados <span class="ot">&lt;-</span> <span class="fu">separate</span>(dados, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">col =</span> <span class="st">"data_hora"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"data"</span>, <span class="st">"hora"</span>), </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_separados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente       data  hora
1           1 2024-05-01 14:30
2           2 2024-05-02 09:15
3           3 2024-05-03 18:45</code></pre>
</div>
</div>
<p>Podemos também separar a data em dia mes e ano, como mostrado no código abaixo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando separate para dividir a coluna data_hora em data e hora</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dados_dma <span class="ot">&lt;-</span> <span class="fu">separate</span>(dados_separados, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col =</span> <span class="st">"data"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"ano"</span>, <span class="st">"mes"</span>, <span class="st">"dia"</span>), </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_dma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente  ano mes dia  hora
1           1 2024  05  01 14:30
2           2 2024  05  02 09:15
3           3 2024  05  03 18:45</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando separate para dividir a coluna hora em horas e minutos</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dados_hm <span class="ot">&lt;-</span> <span class="fu">separate</span>(dados_dma, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">col =</span> <span class="st">"hora"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"horas"</span>, <span class="st">"minutos"</span>), </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_hm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente  ano mes dia horas minutos
1           1 2024  05  01    14      30
2           2 2024  05  02    09      15
3           3 2024  05  03    18      45</code></pre>
</div>
</div>
</section>
<section id="função-unite" class="level4" data-number="12.1.2.2">
<h4 data-number="12.1.2.2" class="anchored" data-anchor-id="função-unite"><span class="header-section-number">12.1.2.2</span> Função unite()</h4>
<p>A função <code>unite()</code> é usada para combinar duas ou mais colunas em uma única coluna. Essa função é útil quando queremos simplificar nosso conjunto de dados ou criar uma nova coluna combinada. A sintaxe dessa função é:</p>
<p><code>unite(data, col, ..., sep = "_")</code></p>
<p>-data: O conjunto de dados. -col: O nome da nova coluna. -…: As colunas a serem unidas. -sep: O delimitador a ser usado para unir os valores (por padrão, é um sublinhado “_”).</p>
<p>Veja como unir as colunas que acabamos de separar:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando unite para combinar as colunas data e hora em data_hora</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">unite</span>(dados_hm, <span class="at">col =</span> <span class="st">"data_hora"</span>, horas, minutos, <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente  ano mes dia data_hora
1           1 2024  05  01     14:30
2           2 2024  05  02     09:15
3           3 2024  05  03     18:45</code></pre>
</div>
</div>
<p>A função <code>unite()</code> não suporte múltiplas uniões em um único comando. Assim, para unir novamente também as colunas ano, mes e dia, precisamos de uma nova linha com unite.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando unite para combinar as colunas data e hora em data_hora</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_hm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente  ano mes dia horas minutos
1           1 2024  05  01    14      30
2           2 2024  05  02    09      15
3           3 2024  05  03    18      45</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dados_hm <span class="ot">&lt;-</span> <span class="fu">unite</span>(dados_hm, <span class="at">col =</span> <span class="st">"data_hora"</span>, horas, minutos, <span class="at">sep =</span> <span class="st">":"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dados_hm <span class="ot">&lt;-</span> <span class="fu">unite</span>(dados_hm, <span class="at">col =</span> <span class="st">"data"</span>, ano, mes, dia, <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dados_hm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id_paciente       data data_hora
1           1 2024-05-01     14:30
2           2 2024-05-02     09:15
3           3 2024-05-03     18:45</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-NAvalues" class="level3" data-number="12.1.3">
<h3 data-number="12.1.3" class="anchored" data-anchor-id="sec-NAvalues"><span class="header-section-number">12.1.3</span> NA Values</h3>
<p>É muito frequente que faltem dados em pesquisas. Às vezes uma questão de um questionário deixou de ser respondida, às vezes um dado não foi encontrado etc. Esses dados são representados no R como <code>NA</code>, que significa NOT AVAILABLE. É importante reconhecer a existência desses dados faltantes pois a presença desses dados faltantes pode impedir que sejam executados cálculos matemáticos. Afinal de contas, o que poderia significar <code>3*NA</code>? Experimente fazer essa conta no R.</p>
<section id="desconsiderar-valores-na" class="level4" data-number="12.1.3.1">
<h4 data-number="12.1.3.1" class="anchored" data-anchor-id="desconsiderar-valores-na"><span class="header-section-number">12.1.3.1</span> Desconsiderar valores NA</h4>
<p>Como vimos anteriormente, nem todos argumentos são valores numéricos. Alguns argumentos servem para indicar como a função deve se comportar. Um argumento importante de muitas funções é o <code>na.rm = TRUE</code>. a expressão <code>na.rm=TRUE</code> é uma abreviação de REMOVE NOT AVAILABLE DATA, ou seja, remova os dados faltantes. Ao indicarmos que esse argumento é verdadeiro (<code>TRUE</code>), o R irá desconsiderar dados em branco ou faltantes ao fazer os cálculos. Sem esse argumento, frequentemente os cálculos não são realizados.</p>
<p><strong>Criando uma variável peso com valores NA</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>peso <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">55</span>,<span class="dv">8</span>, <span class="cn">NA</span>) </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>peso</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50 55  8 NA</code></pre>
</div>
</div>
<p><strong>Tentando calcular a média do peso, sem retirar os valores NA</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(peso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Veja que o resultado obtido foi <code>NA</code>, ou seja, o R não conseguiu fazer os cálculos. Uma das formas de resolver esse problema é retirar os valores <code>NA</code> antes de fazer os cálculos. Isso pode ser feito através do argumento <code>na.rm = TRUE</code>.</p>
<p><strong>Tentando calcular a média do peso, indicando ao R para retirar os valores NA com o o argumento na.rm = TRUE</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a média do peso, retirando os valores NA, utilizando o argumento na.rm = TRUE</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(peso, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37.66667</code></pre>
</div>
</div>
<p>Veremos a seguir como resolver problemas de valores <code>NA</code> em data frames usando o pacote <code>dplyr</code>, com as funções <code>drop_na()</code> e <code>replace_na()</code>.</p>
</section>
<section id="a-função-drop_na" class="level4" data-number="12.1.3.2">
<h4 data-number="12.1.3.2" class="anchored" data-anchor-id="a-função-drop_na"><span class="header-section-number">12.1.3.2</span> A função <code>drop_na()</code></h4>
<p>Em muitos conjuntos de dados, especialmente na área da saúde, é comum encontrar valores ausentes (NA). Esses valores podem surgir por diversos motivos, como erros de coleta de dados ou dados que não foram registrados. A função <code>drop_na()</code> do pacote <code>tidyr</code> é uma ferramenta eficaz para lidar com esses valores ausentes, permitindo a remoção de linhas que contêm NAs de forma fácil e eficiente.</p>
<p>A função <code>drop_na()</code> serve para excluirmos linhas com valores <code>NA</code> antes de executarmos algum cálculo estatístico. Lembre-se que muitas funções estatísticas não conseguem ser executadas se houver valores <code>NA</code> nos dados.</p>
<p>Vamos criar uma tabela com valores <code>NA</code> e então tentar calcular a média de alguma das variáveis sem retirar os valores <code>NA</code> e, em seguida, retirando os valores <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id     =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex    =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Male"</span>,<span class="st">"Male"</span>,<span class="st">"Male"</span>,<span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Female"</span>, <span class="st">"Female"</span>, <span class="st">"Female"</span>, <span class="st">"Female"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age    =</span> <span class="fu">c</span>(<span class="dv">44</span>, <span class="dv">18</span>,  <span class="dv">29</span>,  <span class="dv">33</span>, <span class="dv">57</span>,  <span class="dv">47</span>,  <span class="dv">33</span>,  <span class="dv">71</span>,  <span class="dv">34</span>,  <span class="cn">NA</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">172</span>, <span class="dv">175</span>, <span class="cn">NA</span>, <span class="dv">170</span>, <span class="dv">169</span>, <span class="dv">145</span>, <span class="dv">179</span>, <span class="dv">155</span>, <span class="dv">149</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">120</span>, <span class="dv">90</span>,  <span class="cn">NA</span>, <span class="dv">89</span>,  <span class="dv">72</span>,  <span class="dv">89</span>,  <span class="dv">91</span>,  <span class="dv">74</span>,  <span class="dv">70</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>mydata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
      id sex      age height weight
   &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1     1 Male      44     NA     70
 2     2 Male      18    172    120
 3     3 Male      29    175     90
 4     4 Male      33     NA     NA
 5     5 Male      57    170     89
 6     6 Female    47    169     72
 7     7 Female    33    145     89
 8     8 Female    71    179     91
 9     9 Female    34    155     74
10    10 Female    NA    149     70</code></pre>
</div>
</div>
<p>1ª Tentativa: tentando calcular a média das idades sem retirar os valores <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função pull</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>2ª Tentativa: tentando calcular a média das idades usando o argumento <code>na.rm=TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.66667</code></pre>
</div>
</div>
<p>Conseguimos calcular usando a função <code>mean()</code> com o argumento <code>na.rm=TRUE</code>. Entretanto, nem todas funções aceitam o argumento <code>na.rm=TRUE</code>. E as vezes precisamos retirar os valores <code>NA</code> numa sequencia diferente dentro do pipe. Podemos entáo resolver isso usando a função <code>drop_na()</code>.</p>
<p>Vejamos o resultado usando a função <code>drop_na()</code>. Perceba que a função <code>drop_na()</code> precisa ser usada <strong>antes</strong> da função <code>pull()</code>. Isso é porque a função <code>drop_na()</code> atua em um data frame e a função <code>pull()</code> recebe um data frame e tem como output um vetor. Então, na sequencia do código, depois do <code>pull()</code> o que existe é um vetor e não um data frame. Por isso a função <code>drop_na()</code> não pode ser usada depois do <code>pull()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.66667</code></pre>
</div>
</div>
<p>Vejamos alguns outros exemplos mais simples de como usar a função <code>drop_na()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes com NAs </span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nome   =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="cn">NA</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="cn">NA</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idade  =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="cn">NA</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="cn">NA</span>, <span class="dv">50</span>),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="cn">NA</span>, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Curitiba"</span>, <span class="st">"Porto Alegre"</span>, <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="cn">NA</span>))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana         25 São Paulo     
 2           2 Bruno       30 Rio de Janeiro
 3           3 &lt;NA&gt;        35 Belo Horizonte
 4           4 Diana       40 &lt;NA&gt;          
 5           5 Eduardo     NA Curitiba      
 6           6 Fernanda    28 Porto Alegre  
 7           7 Gustavo     33 Salvador      
 8           8 &lt;NA&gt;        45 Brasília      
 9           9 Isabela     NA Fortaleza     
10          10 João        50 &lt;NA&gt;          </code></pre>
</div>
</div>
<p>Podemos usar a função <code>drop_na()</code> para retirar todas as linhas que tenham dados faltantes em toda a tibble</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover linhas com NAs nas colunas 'nome' e 'idade'</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>pacientes2 <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(pacientes)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  id_paciente nome     idade cidade        
        &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
1           1 Ana         25 São Paulo     
2           2 Bruno       30 Rio de Janeiro
3           6 Fernanda    28 Porto Alegre  
4           7 Gustavo     33 Salvador      </code></pre>
</div>
</div>
<p>Às vezes, pode ser necessário remover linhas com NAs apenas em colunas específicas, enquanto preserva outras linhas com NAs em colunas menos críticas. Vamos considerar o mesmo conjunto de dados, mas desta vez removeremos apenas as linhas com NAs nas colunas nome e idade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover linhas com NAs na coluna 'idade'</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>pacientes3 <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(pacientes, idade)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  id_paciente nome     idade cidade        
        &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
1           1 Ana         25 São Paulo     
2           2 Bruno       30 Rio de Janeiro
3           3 &lt;NA&gt;        35 Belo Horizonte
4           4 Diana       40 &lt;NA&gt;          
5           6 Fernanda    28 Porto Alegre  
6           7 Gustavo     33 Salvador      
7           8 &lt;NA&gt;        45 Brasília      
8          10 João        50 &lt;NA&gt;          </code></pre>
</div>
</div>
</section>
<section id="a-função-replace_na" class="level4" data-number="12.1.3.3">
<h4 data-number="12.1.3.3" class="anchored" data-anchor-id="a-função-replace_na"><span class="header-section-number">12.1.3.3</span> A função <code>replace_na()</code></h4>
<p>Nem sempre deletar da análise os valores <code>NA</code> é a melhor solução. Ao deletar um dado <code>NA</code> da amostra, podemos estar aumentando artificialmente o desvio padrão. Algumas vezes pode ser interessante substituir os valores NA por outro valor. Por exemplo, no caso de dados numéricos, é uma técnica comum substituir os valores NA pela média. Isso não modifica a média do conjunto, e evita que o desvio padrão seja artificialmente aumentado.</p>
<p>Para substituir um valor numérico faltante pela média dos dados utilizando a função <code>replace_na()</code> do pacote <code>tidyr</code>, você pode seguir os passos abaixo. Primeiro, calcule a média dos valores existentes na coluna, ignorando os valores ausentes (NA). Em seguida, utilize <code>replace_na()</code> para substituir os valores ausentes pela média calculada.</p>
<p>Aqui está um exemplo detalhado, usando também a função mutate do pacote <code>dplyr</code> que será discutido no capítulo seguinte.</p>
<p>Vamos usar um conjunto de dados de pacientes e substituir os valores ausentes na coluna idade pela média das idades não ausentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes com NAs usando tibble</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nome   =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="cn">NA</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="cn">NA</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idade  =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="cn">NA</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="cn">NA</span>, <span class="dv">50</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="cn">NA</span>, <span class="st">"Curitiba"</span>, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Porto Alegre"</span>, <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="cn">NA</span>))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana         25 São Paulo     
 2           2 Bruno       30 Rio de Janeiro
 3           3 &lt;NA&gt;        35 Belo Horizonte
 4           4 Diana       40 &lt;NA&gt;          
 5           5 Eduardo     NA Curitiba      
 6           6 Fernanda    28 Porto Alegre  
 7           7 Gustavo     33 Salvador      
 8           8 &lt;NA&gt;        45 Brasília      
 9           9 Isabela     NA Fortaleza     
10          10 João        50 &lt;NA&gt;          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(pacientes<span class="sc">$</span>idade, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(pacientes<span class="sc">$</span>idade, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.647873</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular a média da coluna idade, ignorando NAs</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>media_idade <span class="ot">&lt;-</span> <span class="fu">mean</span>(pacientes<span class="sc">$</span>idade, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Substituir os valores ausentes na coluna idade com a média</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> pacientes <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idade =</span> <span class="fu">replace_na</span>(idade, media_idade))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana       25   São Paulo     
 2           2 Bruno     30   Rio de Janeiro
 3           3 &lt;NA&gt;      35   Belo Horizonte
 4           4 Diana     40   &lt;NA&gt;          
 5           5 Eduardo   35.8 Curitiba      
 6           6 Fernanda  28   Porto Alegre  
 7           7 Gustavo   33   Salvador      
 8           8 &lt;NA&gt;      45   Brasília      
 9           9 Isabela   35.8 Fortaleza     
10          10 João      50   &lt;NA&gt;          </code></pre>
</div>
</div>
<p>Observe que os valores agora são mostrados com 2 casas decimais. Isso ocorre porque ao calcular a média da idade o R transformou esses dados que antes eram numeros inteiros (int) em números reais (dbl).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recalculando a média das idades, agora não precisamos mais de informar na.rm = TRUE</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(pacientes<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(pacientes<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.626707</code></pre>
</div>
</div>
<p>Veja que a média não foi alterada após a substituição dos valores faltantes pela própria média. O desvio padrão, por outro lado fica um pouco menor.</p>
<p>Podemos usar <code>replace_na()</code> também para substituir o texto de variáveis. Por exemplo, podemos colocar o texto “Não informado” ou “Desconhecido” em campos onde havia NAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes com NAs usando tibble</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nome   =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="cn">NA</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="cn">NA</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idade  =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="cn">NA</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="cn">NA</span>, <span class="dv">50</span>),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="cn">NA</span>, <span class="st">"Curitiba"</span>, </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Porto Alegre"</span>, <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="cn">NA</span>))</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Substituir valores ausentes por valores específicos</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>pacientes_substituidos <span class="ot">&lt;-</span> <span class="fu">replace_na</span>(pacientes, </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">list</span>(<span class="at">nome =</span> <span class="st">"Desconhecido"</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cidade =</span> <span class="st">"Não Informado"</span>))</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_substituidos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome         idade cidade        
         &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana             25 São Paulo     
 2           2 Bruno           30 Rio de Janeiro
 3           3 Desconhecido    35 Belo Horizonte
 4           4 Diana           40 Não Informado 
 5           5 Eduardo         NA Curitiba      
 6           6 Fernanda        28 Porto Alegre  
 7           7 Gustavo         33 Salvador      
 8           8 Desconhecido    45 Brasília      
 9           9 Isabela         NA Fortaleza     
10          10 João            50 Não Informado </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sec-dplyr" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="sec-dplyr"><span class="header-section-number">12.2</span> Manipulando dados com <code>dplyr</code></h2>
<p>A análise de dados envolve frequentemente a transformação e manipulação de grandes conjuntos de dados para torná-los prontos para a análise. No contexto médico, isso pode incluir a limpeza de dados de pacientes, o cálculo de estatísticas resumidas, a filtragem de observações relevantes e a combinação de diferentes fontes de dados.</p>
<p>O pacote <code>dplyr</code>, parte integrante do <code>tidyverse</code>, é uma ferramenta poderosa para essas tarefas, proporcionando uma sintaxe clara e eficiente para a manipulação de dados em R.</p>
<p>O <code>dplyr</code> oferece um conjunto de funções intuitivas e expressivas para a manipulação de dados tabulares. Estas funções permitem realizar operações como seleção de colunas, filtragem de linhas, agrupamento de dados, criação de novas variáveis e combinações de datasets. O foco do <code>dplyr</code> é a simplicidade e a legibilidade do código, o que facilita a escrita de scripts claros e concisos, mesmo para iniciantes.</p>
<section id="funções-mais-importantes-do-dplyr" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="funções-mais-importantes-do-dplyr"><span class="header-section-number">12.2.1</span> Funções Mais Importantes do dplyr</h3>
<p>O <code>dplyr</code> é um dos pacotes mais populares do <code>tidyverse</code> para manipulação de dados. Aqui estão algumas das funções mais importantes e frequentemente utilizadas no <code>dplyr</code>:</p>
<ol type="1">
<li><strong><code>filter()</code></strong>: Filtra linhas em um conjunto de dados com base em condições específicas.</li>
<li><strong><code>select()</code></strong>: Seleciona colunas específicas de um conjunto de dados.</li>
<li><strong><code>pull()</code></strong>: Extrai uma coluna de um conjunto de dados como um vetor.</li>
<li><strong><code>mutate()</code></strong>: Adiciona novas colunas ou modifica colunas existentes em um conjunto de dados.</li>
<li><strong><code>arrange()</code></strong>: Ordena as linhas de um conjunto de dados com base em uma ou mais colunas.</li>
<li><strong><code>group_by()</code></strong>: Agrupa os dados com base em uma ou mais colunas, preparando-os para operações de agregação.</li>
<li><strong><code>ungroup()</code></strong>: Remove agrupamentos de um conjunto de dados.</li>
<li><strong><code>rename()</code></strong>: Renomeia colunas em um conjunto de dados.</li>
<li><strong><code>recode()</code></strong>: Recodifica valores, substituindo valores existentes por novos valores.</li>
<li><strong><code>bind_rows()</code></strong>: Empilha dois ou mais conjuntos de dados um em cima do outro (concatenação vertical).</li>
<li><strong><code>bind_cols()</code></strong>: Combina dois ou mais conjuntos de dados lado a lado (concatenação horizontal).</li>
<li><strong><code>distinct()</code></strong>: Retorna linhas distintas, removendo duplicatas de um conjunto de dados.</li>
<li><strong><code>count()</code></strong>: Conta o número de observações em cada grupo.</li>
<li><strong><code>summarize()</code> / <code>summarise()</code></strong>: Resume os dados em uma única linha ou várias linhas, aplicando funções de agregação.</li>
</ol>
<p>Essas funções são fundamentais para a manipulação e transformação de dados em R, permitindo que você limpe, organize e analise seus dados de maneira eficiente.</p>
</section>
<section id="filtrando-linhas-com-filter" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="filtrando-linhas-com-filter"><span class="header-section-number">12.2.2</span> Filtrando linhas com <code>filter()</code></h3>
<p>Num data frame as linhas representam as diferentes observações e as colunas representam as variáveis. Por exemplo, em pesquisas na área de saúde, geralmente cada linha representa um participante da pesquisa e as colunas as vriáveis da pesquisa.</p>
<p>Frequentemente precisamos acessar subgrupos de um grande conjunto de dados, ou seja, precisamos selecionar subgrupos nos quais desejamos fazer nossa análise. Isso é feito no R com a função <code>filter()</code> do pacote <code>dplyr</code> que faz parte do tidyverse.</p>
<p>O modo de usar a função <code>filter()</code> é muito simples: o primeiro argumento é o data frame a ser usado, em seguida as expressões lógicas para filtrar/selecionar as linhas do data frame, como mostraremos a seguir, usando novamente o dataset <code>mpg</code> do pacote <code>ggplot2</code> (Esse pacote também faz parte do <code>tidyverse</code>).</p>
<p>Vamos carregar esses dados com a função <code>data()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Relembrando o significado de cada variável do dataset <code>mpg</code>:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mpg.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">mpg dictionary</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Sabemos que para acessar uma variável de um data frame usamos o operador <code>$</code> e que a variável com os nomes das montadores é manufacturer. Vamos então checar quais são as montadoras dos carros dessa pacote com o comando <code>unique()</code>. Essa função lista os elementos de um conjunto, sem repetição:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>manufacturer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "audi"       "chevrolet"  "dodge"      "ford"       "honda"     
 [6] "hyundai"    "jeep"       "land rover" "lincoln"    "mercury"   
[11] "nissan"     "pontiac"    "subaru"     "toyota"     "volkswagen"</code></pre>
</div>
</div>
<p>Como podemos ver, esse banco de dados tem carros de várias montadoras. Em análises estatísticas que é frequentemente necessário separar os dados de acordo com alguma regra, por exemplo, de acordo com a montadora. Podemos, por exemplo desejar analisar apenas os carros das montadoras tradicionais no Brasil (Ford, Chevrolet, Volkswagen). Vamos fazer um novo data frame com essas montadoras. Para isso usamos a função <code>filter()</code> como descrito anteriormente e criar um novo data frame chamado <code>cfv</code>, letras iniciais dessas montadoras.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>cfv <span class="ot">&lt;-</span> <span class="fu">filter</span>(mpg, manufacturer <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"chevrolet"</span>, <span class="st">"ford"</span>, <span class="st">"volkswagen"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe que usamos um novo operador nessa função %in%. Esse operador procurou dentro da variável manufacturer os nomes “chevrolet”, “ford”, “volkswagen”. A função <code>filter()</code> por sua vez, selecionou essas montadoras e o resultado foi colocado num novo data frame chamado de <code>cfv</code>.</p>
<p>Veja que agora nosso data frame só possui essas três montadoras.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(cfv<span class="sc">$</span>manufacturer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "chevrolet"  "ford"       "volkswagen"</code></pre>
</div>
</div>
<p>Podemos visualizar o consumo dessas três marcar selecionadas num boxplot comparativo, como feito a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cty<span class="sc">~</span>manufacturer,   <span class="co"># plota o consumo de acordo com a montadora</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">data=</span>cfv,        <span class="co"># indica que os dados estão no data frame cfv</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"lightblue"</span>) <span class="co"># colore os box com a cor lightblue</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Podemos ver com essa análise inicial que os carros da volkswagen percorrem mais milhas com um galão que os carros da Chevrolet e da Ford. Mas quais são esses carros?</p>
<p>Podemos usar o comando <code>filter()</code> para filtramos os dados de acordo com regras numéricas. Por exemplo, para sabermos quais são os carros que conseguem percorrer mais de 30 milhas com um galão usamos também a função <code>filter()</code> como abaixo, no qual criamos um novo data frame com o nome <code>bestcars</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>bestcars <span class="ot">&lt;-</span> <span class="fu">filter</span>(cfv, cty <span class="sc">&gt;</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para mostrar o conteúdo desse novo data frame que chamamos de bestaras basta digitar o nome do data frame no console. E para saber apenas o nome dos modelos desses carros, basta usar o operador <code>$</code>, como mostrado abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>bestcars<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "jetta"      "new beetle"</code></pre>
</div>
</div>
<p>Se desejássemos separar apenas UMA determinada montadora, poderíamos da mesma forma usar a função filter. Lembrando que o operador de igualdade no R é um igual duplo ==. Por exemplo, podemos criar um dataframe apenas com os carros da Jeep.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>jeep <span class="ot">&lt;-</span> <span class="fu">filter</span>(mpg, manufacturer <span class="sc">==</span> <span class="st">"jeep"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>jeep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 11
  manufacturer model       displ  year   cyl trans drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
1 jeep         grand cher…   3    2008     6 auto… 4        17    22 d     suv  
2 jeep         grand cher…   3.7  2008     6 auto… 4        15    19 r     suv  
3 jeep         grand cher…   4    1999     6 auto… 4        15    20 r     suv  
4 jeep         grand cher…   4.7  1999     8 auto… 4        14    17 r     suv  
5 jeep         grand cher…   4.7  2008     8 auto… 4         9    12 e     suv  
6 jeep         grand cher…   4.7  2008     8 auto… 4        14    19 r     suv  
7 jeep         grand cher…   5.7  2008     8 auto… 4        13    18 r     suv  
8 jeep         grand cher…   6.1  2008     8 auto… 4        11    14 p     suv  </code></pre>
</div>
</div>
</section>
<section id="selecionando-colunas-com-select" class="level3" data-number="12.2.3">
<h3 data-number="12.2.3" class="anchored" data-anchor-id="selecionando-colunas-com-select"><span class="header-section-number">12.2.3</span> Selecionando colunas com <code>select()</code></h3>
<p>A função <code>select()</code> seleciona as colunas desejadas, ou seja, as variáveis desejadas. Muitas vezes um data frame possui muitas colunas e pode ser útil criar um novo data frame apenas com as variáveis de interesse. A função <code>select()</code> faz justamente isso. O dataset <code>mpg</code> possui 11 variáveis. Se nossa análise vai usar apenas <code>manufacturer</code>, <code>displ</code> e <code>cty</code>, podemos criar um novo data frame com apenas essas variáveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>newdf <span class="ot">&lt;-</span> <span class="fu">select</span>(mpg, manufacturer, displ, cty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para verificar esse novo data frame basta usar a função <code>str()</code> e veremos que agora só existem 3 variáveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(newdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [234 × 3] (S3: tbl_df/tbl/data.frame)
 $ manufacturer: chr [1:234] "audi" "audi" "audi" "audi" ...
 $ displ       : num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
 $ cty         : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...</code></pre>
</div>
</div>
<p>Quando trabalhamos com datasets com centenas ou milhares de variáveis, usar a função <code>select()</code> é bastante útil.</p>
</section>
<section id="extraindo-valores-com-pull" class="level3" data-number="12.2.4">
<h3 data-number="12.2.4" class="anchored" data-anchor-id="extraindo-valores-com-pull"><span class="header-section-number">12.2.4</span> Extraindo valores com <code>pull()</code></h3>
<p>A função <code>pull()</code> funciona de forma parecida com o operador <code>$</code>. Ambos tem a função de extrair valores de um data frame. Já vimos como usar o operador <code>$</code> para extrair valores de uma variável e usar esses valores em funções estatísticas tais como <code>mean()</code>, <code>median()</code> e <code>sd()</code>. Vamos relembrar como isso foi feito usando o dataset <code>mpg</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a média das milhas por galão na cidade </span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mpg<span class="sc">$</span>cty) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.85897</code></pre>
</div>
</div>
<p>Mas as vezes são necessárias diversas operações antes de encontrar o conjunto numérico desejado para calcular uma média. Por exemplo, se quisermos calcular a média das milhas percorridas com um galão em automóveis do tipo SUV? vamos ver como podemos fazer isso usando o operador pipe <code>|&gt;</code> e as funções <code>select()</code>, <code>filter()</code> e <code>pull()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mpg)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> <span class="fu">filter</span>(class<span class="sc">==</span><span class="st">"suv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(cty) <span class="sc">|&gt;</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(select(filter(mpg, class == "suv"), cty)): argument is
not numeric or logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>O código acima falhou!. O motivo é que o argumento passado pelo pipe para a função <code>mean()</code> não é um vetor, mas sim uma data frame (ou uma tibble). Podemos conferir isso no código abaixo, onde substituimos a função <code>mean()</code> pela função <code>class()</code> que informa o tipo de objeto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> <span class="fu">filter</span>(class<span class="sc">==</span><span class="st">"suv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(cty) <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">class</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Para que a função <code>mean()</code> possa calcular a média é necessário que o argumento passado para essa função seja um conjunto numérico, ou seja, um vetor numérico. É aí que entra a função <code>pull()</code>, que extrai os valores do data frame e repassa esse valores adiante pelo pipe. Vejamos agora como consertar o código.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> <span class="fu">filter</span>(class<span class="sc">==</span><span class="st">"suv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(cty) <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>() <span class="sc">|&gt;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.5</code></pre>
</div>
</div>
</section>
<section id="criando-novas-variáveis-com-mutate" class="level3" data-number="12.2.5">
<h3 data-number="12.2.5" class="anchored" data-anchor-id="criando-novas-variáveis-com-mutate"><span class="header-section-number">12.2.5</span> Criando novas variáveis com <code>mutate()</code></h3>
<p>É frequente a necessidade de modificar ou criar novas variáveis no processo de análise de dados. Uma situação comum é a necessidade de transformarmos a unidade de medida de libras para peso, de milhas para quilômetros, de horas para minutos etc.</p>
<p>No dataset <code>mpg</code> a medida da distância percorrida é dada em milhas. Podemos usar a função <code>mutate()</code> do pacote <code>dplyr</code> que faz parte do <code>tidyverse</code> para criar uma nova variável com a medida em quilômetros. Veja no código abaixo como fazer isso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">cty.km =</span> cty<span class="sc">*</span><span class="fl">1.609344</span>, mpg) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 12
   manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class
   &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
 1 audi         a4           1.8  1999     4 auto… f        18    29 p     comp…
 2 audi         a4           1.8  1999     4 manu… f        21    29 p     comp…
 3 audi         a4           2    2008     4 manu… f        20    31 p     comp…
 4 audi         a4           2    2008     4 auto… f        21    30 p     comp…
 5 audi         a4           2.8  1999     6 auto… f        16    26 p     comp…
 6 audi         a4           2.8  1999     6 manu… f        18    26 p     comp…
 7 audi         a4           3.1  2008     6 auto… f        18    27 p     comp…
 8 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…
 9 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…
10 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…
# ℹ 224 more rows
# ℹ 1 more variable: cty.km &lt;dbl&gt;</code></pre>
</div>
</div>
<p>O código acima por ser lido da seguinte maneira: crie uma variável com o nome <code>cty.km</code> com valores iguais aos da variável <code>cty</code> multiplicado por 1.609344, proveniente do dataset <code>mpg</code>. Esse código, entretanto, tem um problema: o resultado dessa operação não foi salvo em nenhuma variável. Ao ser executado, esse código irá apenas mostrar todo o resultado sem salvar nada. Para que a nova variável seja salva é necessário acrescenta essa etapa no código como feito abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="at">cty.km =</span> cty<span class="sc">*</span><span class="fl">1.609344</span>, mpg) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos também reescrever esse código usando o operador pipe <code>|&gt;</code> ou <code>|&gt;</code>, tornando esse código mais fácil de ser compreendido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">cty.km =</span> cty<span class="sc">*</span><span class="fl">1.609344</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O coódigo acima pode ser lido da seguinte forma: use o dataset <code>mpg</code>, crie uma variável com o nome <code>cty.km</code> com valores iguais aos da variável <code>cty</code> multiplicado por 1.609344. Finalmente, acrescente essa nova variável no dataset <code>mpg</code>.</p>
<p>Veja que, quando usamos o operador pipe, o dataset usado é informado antes do operador pipe e as funções a seguir já não precisam mais dessa informação nos seus argumentos.</p>
</section>
<section id="ordenando-dados-com-arrange" class="level3" data-number="12.2.6">
<h3 data-number="12.2.6" class="anchored" data-anchor-id="ordenando-dados-com-arrange"><span class="header-section-number">12.2.6</span> Ordenando dados com <code>arrange()</code></h3>
<p>Na manipulação de dados, a ordenação é uma operação fundamental que ajuda a organizar e visualizar melhor os dados. A função <code>arrange()</code> do pacote <code>dplyr</code> permite ordenar as linhas de um data frame com base em uma ou mais colunas. Essa função é essencial para classificar dados em ordem crescente ou decrescente, facilitando a análise e a interpretação.</p>
<p>Sintaxe:<br>
<code>arrange(data, ...)</code><br>
- data: O data frame a ser ordenado.<br>
- …: As colunas pelas quais o data frame será ordenado.</p>
<p>Por padrão, a ordenação é crescente. Para ordenar de forma decrescente, use o argumento <code>desc()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nome   =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="st">"Helena"</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idade  =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">50</span>, <span class="dv">22</span>, <span class="dv">50</span>),</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, <span class="st">"Porto Alegre"</span>, </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="st">"Manaus"</span>, <span class="st">"Recife"</span>))</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana         25 São Paulo     
 2           2 Bruno       30 Rio de Janeiro
 3           3 Carlos      35 Belo Horizonte
 4           4 Diana       40 Curitiba      
 5           5 Eduardo     50 Porto Alegre  
 6           6 Fernanda    28 Salvador      
 7           7 Gustavo     33 Brasília      
 8           8 Helena      50 Fortaleza     
 9           9 Isabela     22 Manaus        
10          10 João        50 Recife        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar os dados pela coluna idade em ordem crescente</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>pacientes_ordenados <span class="ot">&lt;-</span> <span class="fu">arrange</span>(pacientes, idade)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_ordenados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           9 Isabela     22 Manaus        
 2           1 Ana         25 São Paulo     
 3           6 Fernanda    28 Salvador      
 4           2 Bruno       30 Rio de Janeiro
 5           7 Gustavo     33 Brasília      
 6           3 Carlos      35 Belo Horizonte
 7           4 Diana       40 Curitiba      
 8           5 Eduardo     50 Porto Alegre  
 9           8 Helena      50 Fortaleza     
10          10 João        50 Recife        </code></pre>
</div>
</div>
<p>Agora, vamos ordenar os dados pela coluna idade em ordem decrescente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar os dados pela coluna idade em ordem decrescente</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>pacientes_ordenados_desc <span class="ot">&lt;-</span> <span class="fu">arrange</span>(pacientes, <span class="fu">desc</span>(idade))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_ordenados_desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           5 Eduardo     50 Porto Alegre  
 2           8 Helena      50 Fortaleza     
 3          10 João        50 Recife        
 4           4 Diana       40 Curitiba      
 5           3 Carlos      35 Belo Horizonte
 6           7 Gustavo     33 Brasília      
 7           2 Bruno       30 Rio de Janeiro
 8           6 Fernanda    28 Salvador      
 9           1 Ana         25 São Paulo     
10           9 Isabela     22 Manaus        </code></pre>
</div>
</div>
<p>Podemos também ordenar o data frame por múltiplas colunas. Por exemplo, vamos ordenar pela coluna idade em ordem crescente e, em seguida, pela coluna cidade em ordem crescente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar os dados pela coluna idade e depois pela coluna nome</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>pacientes_ordenados_mult <span class="ot">&lt;-</span> <span class="fu">arrange</span>(pacientes, idade, cidade)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_ordenados_mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           9 Isabela     22 Manaus        
 2           1 Ana         25 São Paulo     
 3           6 Fernanda    28 Salvador      
 4           2 Bruno       30 Rio de Janeiro
 5           7 Gustavo     33 Brasília      
 6           3 Carlos      35 Belo Horizonte
 7           4 Diana       40 Curitiba      
 8           8 Helena      50 Fortaleza     
 9           5 Eduardo     50 Porto Alegre  
10          10 João        50 Recife        </code></pre>
</div>
</div>
</section>
<section id="agrupando-dadoc-com-group_by-e-by" class="level3" data-number="12.2.7">
<h3 data-number="12.2.7" class="anchored" data-anchor-id="agrupando-dadoc-com-group_by-e-by"><span class="header-section-number">12.2.7</span> Agrupando dadoc com <code>group_by()</code> e <code>by()</code></h3>
<p>As funções <code>by()</code> do R base e <code>group_by()</code> do <code>dplyr</code> no <code>tidyverse</code> são usadas para agrupar dados e aplicar operações sobre esses grupos. Ambas são ferramentas poderosas para manipulação de dados, mas possuem diferentes sintaxes e vantagens.</p>
<p><strong>Propósito e Vantagens</strong></p>
<p><strong><code>by()</code></strong></p>
<p>A função <code>by()</code> é usada para aplicar uma função a subconjuntos de um data frame, organizados por um fator ou uma combinação de fatores. É uma solução base do R, sem necessidade de carregar pacotes adicionais. As vantagens de <strong><code>by()</code></strong> incluem:</p>
<ul>
<li><strong>Simplicidade</strong>: Uma solução base do R, que não requer pacotes externos.</li>
<li><strong>Flexibilidade</strong>: Pode ser usada com qualquer função que aceite data frames como input.</li>
<li><strong>Compatibilidade</strong>: Por ser parte do R base, funciona em qualquer instalação do R.</li>
<li><strong>Resulta em listas</strong>: O output é uma lista, que pode ser útil para manipulações subsequentes.</li>
</ul>
<p><strong><code>group_by()</code></strong></p>
<p>A função <code>group_by()</code> do pacote <code>dplyr</code>, parte do <code>tidyverse</code>, é usada para agrupar dados em um data frame e é geralmente combinada com outras funções como <code>summarise</code>, <code>mutate</code>, etc. As vantagens de <code>group_by()</code> incluem:</p>
<ul>
<li><strong>Facilidade de uso</strong>: Sintaxe intuitiva e fácil de usar.</li>
<li><strong>Integração com a pipe (%&gt;%)</strong>: Permite a construção de pipelines de manipulação de dados de maneira clara e legível.</li>
<li><strong>Flexibilidade</strong>: Pode ser usada com múltiplas colunas para criar grupos mais complexos.</li>
<li><strong>Performance</strong>: Otimizada para grandes conjuntos de dados.</li>
<li><strong>Compatibilidade</strong>: Facilmente combinada com outros pacotes do <code>tidyverse</code>.</li>
</ul>
<section id="agrupando-com-a-função-by" class="level4" data-number="12.2.7.1">
<h4 data-number="12.2.7.1" class="anchored" data-anchor-id="agrupando-com-a-função-by"><span class="header-section-number">12.2.7.1</span> Agrupando com a função by()</h4>
<p>A função <code>by()</code> estratifica ou agrupa dados segundo alguma variável categórica. Podemos, portanto, aplicar a função <code>summary()</code> no dataset mtcars através da função <code>by()</code>, estratificando o dataset de acordo com o tipo de câmbio (manual ou automático) e aplicando a função <code>summary()</code> em cada grupo. Veja como fazer isso no código abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(mtcars, mtcars<span class="sc">$</span>am, summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mtcars$am: 0
      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   :120.1   Min.   : 62.0  
 1st Qu.:14.95   1st Qu.:6.000   1st Qu.:196.3   1st Qu.:116.5  
 Median :17.30   Median :8.000   Median :275.8   Median :175.0  
 Mean   :17.15   Mean   :6.947   Mean   :290.4   Mean   :160.3  
 3rd Qu.:19.20   3rd Qu.:8.000   3rd Qu.:360.0   3rd Qu.:192.5  
 Max.   :24.40   Max.   :8.000   Max.   :472.0   Max.   :245.0  
      drat             wt             qsec             vs               am   
 Min.   :2.760   Min.   :2.465   Min.   :15.41   Min.   :0.0000   Min.   :0  
 1st Qu.:3.070   1st Qu.:3.438   1st Qu.:17.18   1st Qu.:0.0000   1st Qu.:0  
 Median :3.150   Median :3.520   Median :17.82   Median :0.0000   Median :0  
 Mean   :3.286   Mean   :3.769   Mean   :18.18   Mean   :0.3684   Mean   :0  
 3rd Qu.:3.695   3rd Qu.:3.842   3rd Qu.:19.17   3rd Qu.:1.0000   3rd Qu.:0  
 Max.   :3.920   Max.   :5.424   Max.   :22.90   Max.   :1.0000   Max.   :0  
      gear            carb      
 Min.   :3.000   Min.   :1.000  
 1st Qu.:3.000   1st Qu.:2.000  
 Median :3.000   Median :3.000  
 Mean   :3.211   Mean   :2.737  
 3rd Qu.:3.000   3rd Qu.:4.000  
 Max.   :4.000   Max.   :4.000  
------------------------------------------------------------ 
mtcars$am: 1
      mpg             cyl             disp             hp             drat     
 Min.   :15.00   Min.   :4.000   Min.   : 71.1   Min.   : 52.0   Min.   :3.54  
 1st Qu.:21.00   1st Qu.:4.000   1st Qu.: 79.0   1st Qu.: 66.0   1st Qu.:3.85  
 Median :22.80   Median :4.000   Median :120.3   Median :109.0   Median :4.08  
 Mean   :24.39   Mean   :5.077   Mean   :143.5   Mean   :126.8   Mean   :4.05  
 3rd Qu.:30.40   3rd Qu.:6.000   3rd Qu.:160.0   3rd Qu.:113.0   3rd Qu.:4.22  
 Max.   :33.90   Max.   :8.000   Max.   :351.0   Max.   :335.0   Max.   :4.93  
       wt             qsec             vs               am         gear      
 Min.   :1.513   Min.   :14.50   Min.   :0.0000   Min.   :1   Min.   :4.000  
 1st Qu.:1.935   1st Qu.:16.46   1st Qu.:0.0000   1st Qu.:1   1st Qu.:4.000  
 Median :2.320   Median :17.02   Median :1.0000   Median :1   Median :4.000  
 Mean   :2.411   Mean   :17.36   Mean   :0.5385   Mean   :1   Mean   :4.385  
 3rd Qu.:2.780   3rd Qu.:18.61   3rd Qu.:1.0000   3rd Qu.:1   3rd Qu.:5.000  
 Max.   :3.570   Max.   :19.90   Max.   :1.0000   Max.   :1   Max.   :5.000  
      carb      
 Min.   :1.000  
 1st Qu.:1.000  
 Median :2.000  
 Mean   :2.923  
 3rd Qu.:4.000  
 Max.   :8.000  </code></pre>
</div>
</div>
</section>
<section id="agrupando-com-a-função-group_by" class="level4" data-number="12.2.7.2">
<h4 data-number="12.2.7.2" class="anchored" data-anchor-id="agrupando-com-a-função-group_by"><span class="header-section-number">12.2.7.2</span> Agrupando com a função group_by()</h4>
<p>Frequentemente precisamos realizar análises estatísticas em grupos, por exemplo, a média de idade entre os homens e a média de idade entre as mulheres. Para isso será necessário separar esses grupos antes de realizar a análise. Por exemplo, para calcular a média de alguma variável em cada tipo de carro precisamos, criar grupos segundo o tipo de carro e depois calcular a média.</p>
<p>Nas seções anteriores vimos como usar o comando <code>filter()</code> para selecionar subgrupos dentre os dados. Havíamos usado o comando <code>filter()</code> para selecionar algumas das montadoras dentre as várias existentes. Esse comando é útil quando precisamos de apenas alguns grupos dentre os vários existentes. E usamos também a função <code>select()</code> para selecionar as variáveis de interesse.</p>
<p>O comando <code>group_by()</code>, usado em conjunto com a função <code>summarize()</code>, nos permite fazer exatamente isso de uma forma mais simples.</p>
<p>O código abaixo cria grupos segundo o tipo de carro (<code>class</code>) e depois calcula a média da distância percorrida na cidade com um galão (variável <code>cty</code>) de cada grupo. O resultado é apresentado numa tabela que pode ser armazenada em um novo objeto, se necessário.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  class      `mean(cty)`
  &lt;chr&gt;            &lt;dbl&gt;
1 2seater           15.4
2 compact           20.1
3 midsize           18.8
4 minivan           15.8
5 pickup            13  
6 subcompact        20.4
7 suv               13.5</code></pre>
</div>
</div>
<p>Podemos ver que, com um galão de gasolina, os SUVs e as Pickups conseguem percorrer uma distância bem menor que os outros tipos de carros, ou seja, são bem menos econômicos. Já os carros compactos e subcompactos conseguem percorrer uma distância bem maior com apenas um galão, sendo, portanto, mais econômicos.</p>
<p>Podemos calcular mais de uma medida em cada grupo, bastando incluir o que se deseja calcular como argumento da função <code>summarize()</code>, como mostra o código a seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="fu">mean</span>(cty), <span class="fu">median</span>(cty), <span class="fu">sd</span>(cty), <span class="fu">max</span>(cty), <span class="fu">min</span>(cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  class      `mean(cty)` `median(cty)` `sd(cty)` `max(cty)` `min(cty)`
  &lt;chr&gt;            &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;int&gt;      &lt;int&gt;
1 2seater           15.4            15     0.548         16         15
2 compact           20.1            20     3.39          33         15
3 midsize           18.8            18     1.95          23         15
4 minivan           15.8            16     1.83          18         11
5 pickup            13              13     2.05          17          9
6 subcompact        20.4            19     4.60          35         14
7 suv               13.5            13     2.42          20          9</code></pre>
</div>
</div>
<p>Podemos também incluir um nome para cada estatística calculada, como feito abaixo. Lembre-se apenas de não usar acentos, espaços ou caracteres especiais no nome usado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="at">media=</span><span class="fu">mean</span>(cty), <span class="at">mediana=</span><span class="fu">median</span>(cty), desvio_padrão<span class="ot">=</span><span class="fu">sd</span>(cty), <span class="at">maximo=</span><span class="fu">max</span>(cty), <span class="at">minimo=</span><span class="fu">min</span>(cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  class      media mediana desvio_padrão maximo minimo
  &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;
1 2seater     15.4      15         0.548     16     15
2 compact     20.1      20         3.39      33     15
3 midsize     18.8      18         1.95      23     15
4 minivan     15.8      16         1.83      18     11
5 pickup      13        13         2.05      17      9
6 subcompact  20.4      19         4.60      35     14
7 suv         13.5      13         2.42      20      9</code></pre>
</div>
</div>
<p>O comando <code>group_by()</code> também pode ser usado para agrupar dados de acordo com mais de uma variável, bastando separar as variáveis por vírgula dentro do parênteses. Por exemplo, para agrupar os dados de acordo com o tipo de carro e o tipo de tração usamos <code>group_by(drv, class)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drv, class) <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">media=</span><span class="fu">mean</span>(cty))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
# Groups:   drv [3]
   drv   class      media
   &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 4     compact     18  
 2 4     midsize     16  
 3 4     pickup      13  
 4 4     subcompact  19.5
 5 4     suv         13.8
 6 f     compact     20.9
 7 f     midsize     19.0
 8 f     minivan     15.8
 9 f     subcompact  22.4
10 r     2seater     15.4
11 r     subcompact  15.9
12 r     suv         12  </code></pre>
</div>
</div>
<p>É possível que você veja uma mensagem “<code>summarise()</code> has grouped output by <code>drv</code>. You can override using the <code>.groups</code> argument.”</p>
<p>Essa mensagem pode ser desconsiderada. Não se preocupe com isso. No meu código essa mensagem não aparece porque eu defini <code>message=FALSE</code> no cabeçalho do meu code chunk.</p>
</section>
</section>
<section id="desagrupando-dados-com-ungroup" class="level3" data-number="12.2.8">
<h3 data-number="12.2.8" class="anchored" data-anchor-id="desagrupando-dados-com-ungroup"><span class="header-section-number">12.2.8</span> Desagrupando dados com <code>ungroup()</code></h3>
<p>Ao trabalhar com conjuntos de dados, especialmente após aplicar a função <code>group_by()</code> para criar agrupamentos, pode ser necessário remover esses agrupamentos para realizar operações subsequentes que não dependem da estrutura de grupos. A função <code>ungroup()</code> do <code>dplyr</code> é utilizada para desfazer agrupamentos em um data frame, retornando-o ao seu estado original.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="st">"Helena"</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="dv">22</span>, <span class="dv">50</span>),</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Porto Alegre"</span>, <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="st">"Manaus"</span>, <span class="st">"Recife"</span>))</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar os dados pela coluna cidade</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>pacientes_agrupados <span class="ot">&lt;-</span> pacientes <span class="sc">|&gt;</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cidade)</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizar alguma operação de agrupamento, por exemplo, calcular a média da idade</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>media_idade <span class="ot">&lt;-</span> pacientes_agrupados <span class="sc">|&gt;</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_idade =</span> <span class="fu">mean</span>(idade, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(media_idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   cidade         media_idade
   &lt;chr&gt;                &lt;dbl&gt;
 1 Belo Horizonte          35
 2 Brasília                33
 3 Curitiba                40
 4 Fortaleza               45
 5 Manaus                  22
 6 Porto Alegre            50
 7 Recife                  50
 8 Rio de Janeiro          30
 9 Salvador                28
10 São Paulo               25</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Desagrupar os dados</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>pacientes_desagrupados <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(pacientes_agrupados)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar se os dados foram desagrupados</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_desagrupados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana         25 São Paulo     
 2           2 Bruno       30 Rio de Janeiro
 3           3 Carlos      35 Belo Horizonte
 4           4 Diana       40 Curitiba      
 5           5 Eduardo     50 Porto Alegre  
 6           6 Fernanda    28 Salvador      
 7           7 Gustavo     33 Brasília      
 8           8 Helena      45 Fortaleza     
 9           9 Isabela     22 Manaus        
10          10 João        50 Recife        </code></pre>
</div>
</div>
</section>
<section id="renomeando-colunas-rename" class="level3" data-number="12.2.9">
<h3 data-number="12.2.9" class="anchored" data-anchor-id="renomeando-colunas-rename"><span class="header-section-number">12.2.9</span> Renomeando colunas <code>rename()</code></h3>
<p>A função <code>rename()</code> do dplyr é uma ferramenta essencial para renomear colunas em um data frame de forma clara e concisa. Ela permite que você torne os nomes das colunas mais descritivos, corrija erros de nomenclatura e padronize os nomes das colunas para facilitar a leitura e a manipulação dos dados. Seja renomeando uma única coluna ou várias colunas de uma vez, a função <code>rename()</code> simplifica o processo de ajuste dos nomes das colunas para melhor atender às necessidades de sua análise.</p>
<p>Também é possível renomear várias colunas de uma só vez, passando múltiplos pares de <code>novo_nome = nome_antigo</code> para a função <code>rename()</code>.</p>
<p>Vamos considerar um conjunto de dados de pacientes e renomear a coluna <code>idade</code> para <code>idade_anos</code> e a coluna <code>nome</code> para <code>primeiro_nome</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>, </span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="st">"Helena"</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="dv">22</span>, <span class="dv">50</span>),</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, </span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Porto Alegre"</span>, <span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="st">"Manaus"</span>, <span class="st">"Recife"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomear a coluna idade para idade_anos e nome para primeiro nome</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>pacientes_2 <span class="ot">&lt;-</span> <span class="fu">rename</span>(pacientes, </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idade_anos =</span> idade, </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">primeiro_nome =</span> nome)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente primeiro_nome idade_anos cidade        
         &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana                   25 São Paulo     
 2           2 Bruno                 30 Rio de Janeiro
 3           3 Carlos                35 Belo Horizonte
 4           4 Diana                 40 Curitiba      
 5           5 Eduardo               50 Porto Alegre  
 6           6 Fernanda              28 Salvador      
 7           7 Gustavo               33 Brasília      
 8           8 Helena                45 Fortaleza     
 9           9 Isabela               22 Manaus        
10          10 João                  50 Recife        </code></pre>
</div>
</div>
</section>
<section id="recodificando-valores-com-recode" class="level3" data-number="12.2.10">
<h3 data-number="12.2.10" class="anchored" data-anchor-id="recodificando-valores-com-recode"><span class="header-section-number">12.2.10</span> Recodificando valores com <code>recode()</code></h3>
<p>Frequentemente necessitamos modificar valores de variáveis ou reduzir o número de variáveis categóricas. A função <code>recode()</code> serve para isso. No exemplo abaixo a variável <code>x</code> contém dados sobre o sexo, mas com nomes heterogêneos para identificar quem é do sexo masculino ou feminino. Com esses diferentes nomes a tabulação dos dados será inadequada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Fem"</span>, <span class="st">"Fem"</span>, <span class="st">"Fem"</span>, <span class="st">"Feminino"</span>, </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Masc"</span>, <span class="st">"Masc"</span>, <span class="st">"Masc"</span>, <span class="st">"Masc"</span>, <span class="st">"Masc"</span>, <span class="st">"Masculino"</span> )</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x
      Fem  Feminino      Masc Masculino 
        3         1         5         1 </code></pre>
</div>
</div>
<p>Podemos resolver esse problema recodificando o valor da variável “Feminino” para “Fem” e “Masculino” para “Masc”. Observe que é preciso atribuir o resultado à um objeto para que a recodificação seja salva.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">recode</span>(x, <span class="at">Feminino =</span> <span class="st">"Fem"</span>, <span class="at">Masculino =</span> <span class="st">"Masc"</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x2
 Fem Masc 
   4    6 </code></pre>
</div>
</div>
<p>O código acima poderia ser reescrito com o operador pipe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">recode</span>(<span class="at">Feminino =</span> <span class="st">"Fem"</span>, <span class="at">Masculino =</span> <span class="st">"Masc"</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x3
 Fem Masc 
   4    6 </code></pre>
</div>
</div>
<p>A recodificação de variáveis pode servir também para reduzir o número de categorias de uma variável.</p>
<p>Por exemplo, no dataset <code>mpg</code> a variável <code>trans</code> (tipo de transmissão) tem 10 categorias, ou seja, 10 diferentes de tipos de transmissão: 8 tipos de marchas automáticas e 2 tipos de marchas manuais.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessária para poder ter acesso ao dataset mpg</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>trans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "auto(l5)"   "manual(m5)" "manual(m6)" "auto(av)"   "auto(s6)"  
 [6] "auto(l4)"   "auto(l3)"   "auto(l6)"   "auto(s5)"   "auto(s4)"  </code></pre>
</div>
</div>
<p>Para compararmos os carros com marchas automáticas com marchas manuais precisamos reduzir essas 10 categorias para apenas duas: <code>manual</code> e <code>automática</code>.</p>
<p>Podemos fazer isso criando uma nova variável com apenas essas duas categorias.</p>
<p>Podemos fazer isso usando função <code>mutate()</code> para criar uma nova variável <code>marcha</code>.</p>
<p>Usaremos a função <code>recode()</code>, para codificar os valores da variável <code>marcha</code> a partir dos valores da variável <code>trans</code>, e o operador <code>pipe</code> para facilitar tudo isso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">marcha =</span> <span class="fu">recode</span>(trans,</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(l3)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(l4)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>, </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(l5)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>,                                                                   <span class="st">"auto(l6)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>, </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(s4)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(s5)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>, </span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"auto(s6)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>,                                                                   <span class="st">"auto(av)"</span>   <span class="ot">=</span> <span class="st">"automatica"</span>, </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"manual(m5)"</span> <span class="ot">=</span> <span class="st">"manual"</span>, </span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"manual(m6)"</span> <span class="ot">=</span> <span class="st">"manual"</span>))</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>marcha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "automatica" "manual"    </code></pre>
</div>
</div>
<p>Veja que a variável marcha tem apenas 2 níveis: automática e manual:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>marcha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
automatica     manual 
       157         77 </code></pre>
</div>
</div>
</section>
<section id="combinando-data-frames-com-bind_rows-e-bind_cols" class="level3" data-number="12.2.11">
<h3 data-number="12.2.11" class="anchored" data-anchor-id="combinando-data-frames-com-bind_rows-e-bind_cols"><span class="header-section-number">12.2.11</span> Combinando data frames com <code>bind_rows()</code> e <code>bind_cols()</code></h3>
<p>Ao trabalhar com dados, muitas vezes é necessário combinar vários data frames em um único data frame. As funções <code>bind_rows()</code> e <code>bind_cols()</code> do pacote <code>dplyr</code> são projetada para concatenar data frames verticalmente, empilhando as linhas de cada data frame um em cima do outro, ou horizontalmente combinando suas colunas em um único data frame. Estas funções são particularmente útil quando se tem dados provenientes de diferentes fontes ou partes de um estudo que precisam ser unificados.</p>
<section id="combinando-por-linhas-com-bind_rows" class="level4" data-number="12.2.11.1">
<h4 data-number="12.2.11.1" class="anchored" data-anchor-id="combinando-por-linhas-com-bind_rows"><span class="header-section-number">12.2.11.1</span> Combinando por linhas com `bind_rows()</h4>
<p><em>Exemplo 1</em>: Combinar Dois Data Frames Simples</p>
<p>Vamos considerar dois data frames de pacientes e combiná-los verticalmente (por linhas) em um único data frame usando <code>bind_rows()</code>. Essa função funciona empilhando as linhas de cada data frame um em cima do outro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes - Parte 1</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>pacientes_parte1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>),</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">50</span>),</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, <span class="st">"Porto Alegre"</span>))</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes - Parte 2</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>pacientes_parte2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Fernanda"</span>, <span class="st">"Gustavo"</span>, <span class="st">"Helena"</span>, <span class="st">"Isabela"</span>, <span class="st">"João"</span>),</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">28</span>, <span class="dv">33</span>, <span class="dv">45</span>, <span class="dv">22</span>, <span class="dv">50</span>),</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"Salvador"</span>, <span class="st">"Brasília"</span>, <span class="st">"Fortaleza"</span>, <span class="st">"Manaus"</span>, <span class="st">"Recife"</span>))</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar os data frames</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pacientes_parte1, pacientes_parte2)</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id_paciente nome     idade cidade        
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;         
 1           1 Ana         25 São Paulo     
 2           2 Bruno       30 Rio de Janeiro
 3           3 Carlos      35 Belo Horizonte
 4           4 Diana       40 Curitiba      
 5           5 Eduardo     50 Porto Alegre  
 6           6 Fernanda    28 Salvador      
 7           7 Gustavo     33 Brasília      
 8           8 Helena      45 Fortaleza     
 9           9 Isabela     22 Manaus        
10          10 João        50 Recife        </code></pre>
</div>
</div>
<p><em>Exemplo 2</em>: Combinar Data Frames com Diferentes Colunas</p>
<p>Quando os data frames têm diferentes colunas, <code>bind_rows()</code> ainda pode combiná-los, preenchendo as colunas ausentes com NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes - Parte 3 com coluna extra</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>pacientes_parte3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Lara"</span>, <span class="st">"Marcos"</span>),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">27</span>, <span class="dv">34</span>),</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"Natal"</span>, <span class="st">"Maceió"</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">genero =</span> <span class="fu">c</span>(<span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>))</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar os data frames</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>pacientes_completos <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(pacientes_parte3, pacientes)</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_completos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
   id_paciente nome     idade cidade         genero   
         &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
 1          11 Lara        27 Natal          Feminino 
 2          12 Marcos      34 Maceió         Masculino
 3           1 Ana         25 São Paulo      &lt;NA&gt;     
 4           2 Bruno       30 Rio de Janeiro &lt;NA&gt;     
 5           3 Carlos      35 Belo Horizonte &lt;NA&gt;     
 6           4 Diana       40 Curitiba       &lt;NA&gt;     
 7           5 Eduardo     50 Porto Alegre   &lt;NA&gt;     
 8           6 Fernanda    28 Salvador       &lt;NA&gt;     
 9           7 Gustavo     33 Brasília       &lt;NA&gt;     
10           8 Helena      45 Fortaleza      &lt;NA&gt;     
11           9 Isabela     22 Manaus         &lt;NA&gt;     
12          10 João        50 Recife         &lt;NA&gt;     </code></pre>
</div>
</div>
<p><em>Exemplo 3</em>: Adicionar uma Coluna de Identificação da Origem</p>
<p>Ao combinar vários data frames, pode ser útil adicionar uma coluna que identifique a origem de cada linha. Podemos fazer isso usando o argumento .id.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar os data frames com uma coluna de identificação</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>pacientes_identificados <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="at">parte1 =</span> pacientes_parte1, </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">parte2 =</span> pacientes_parte2, </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">parte3 =</span> pacientes_parte3, </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">.id =</span> <span class="st">"origem"</span>)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_identificados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 6
   origem id_paciente nome     idade cidade         genero   
   &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
 1 parte1           1 Ana         25 São Paulo      &lt;NA&gt;     
 2 parte1           2 Bruno       30 Rio de Janeiro &lt;NA&gt;     
 3 parte1           3 Carlos      35 Belo Horizonte &lt;NA&gt;     
 4 parte1           4 Diana       40 Curitiba       &lt;NA&gt;     
 5 parte1           5 Eduardo     50 Porto Alegre   &lt;NA&gt;     
 6 parte2           6 Fernanda    28 Salvador       &lt;NA&gt;     
 7 parte2           7 Gustavo     33 Brasília       &lt;NA&gt;     
 8 parte2           8 Helena      45 Fortaleza      &lt;NA&gt;     
 9 parte2           9 Isabela     22 Manaus         &lt;NA&gt;     
10 parte2          10 João        50 Recife         &lt;NA&gt;     
11 parte3          11 Lara        27 Natal          Feminino 
12 parte3          12 Marcos      34 Maceió         Masculino</code></pre>
</div>
</div>
</section>
<section id="combinando-por-colunas-bind_cols" class="level4" data-number="12.2.11.2">
<h4 data-number="12.2.11.2" class="anchored" data-anchor-id="combinando-por-colunas-bind_cols"><span class="header-section-number">12.2.11.2</span> Combinando por colunas <code>bind_cols()</code></h4>
<p>As vezes é necessário combinar várias tabelas ou data frames lado a lado, unindo suas colunas. A função <code>bind_cols()</code> do pacote <code>dplyr</code> é projetada para concatenar data frames horizontalmente, combinando suas colunas em um único data frame. Esta função é útil quando você tem diferentes partes de dados que compartilham a mesma estrutura de linhas e deseja uni-los para formar um conjunto de dados completo.</p>
<p><em>Exemplo</em>: Combinar Dois Data Frames Lado a Lado</p>
<p>Vamos considerar dois data frames de pacientes que contêm informações complementares e combiná-los lado a lado usando <code>bind_cols()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes - Parte 1</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>pacientes_parte1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>))</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes - Parte 2</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>pacientes_parte2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">50</span>),</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, <span class="st">"Porto Alegre"</span>))</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinar os data frames</span></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(pacientes_parte1, pacientes_parte2)</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id_paciente nome    idade cidade        
        &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;         
1           1 Ana        25 São Paulo     
2           2 Bruno      30 Rio de Janeiro
3           3 Carlos     35 Belo Horizonte
4           4 Diana      40 Curitiba      
5           5 Eduardo    50 Porto Alegre  </code></pre>
</div>
</div>
</section>
</section>
<section id="removendo-linhas-duplicadas-com-distinct" class="level3" data-number="12.2.12">
<h3 data-number="12.2.12" class="anchored" data-anchor-id="removendo-linhas-duplicadas-com-distinct"><span class="header-section-number">12.2.12</span> Removendo linhas duplicadas com <code>distinct()</code></h3>
<p>Em conjuntos de dados, é comum encontrar linhas duplicadas que podem distorcer análises e resultados. A função <code>distinct()</code> do pacote <code>dplyr</code> é utilizada para remover essas duplicatas, retornando apenas as linhas distintas de um data frame. Esta função é útil para garantir a integridade e a limpeza dos dados antes de prosseguir com análises mais detalhadas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes com duplicatas</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># os pacientes com ids 2 e 4 estão duplicados</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nome =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Bruno"</span>, <span class="st">"Bruno"</span>, <span class="st">"Carlos"</span>, <span class="st">"Diana"</span>, <span class="st">"Diana"</span>, <span class="st">"Eduardo"</span>),</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">idade =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">40</span>, <span class="dv">50</span>),</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cidade =</span> <span class="fu">c</span>(<span class="st">"São Paulo"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Rio de Janeiro"</span>, <span class="st">"Belo Horizonte"</span>, <span class="st">"Curitiba"</span>, <span class="st">"Curitiba"</span>, <span class="st">"Porto Alegre"</span>))</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover linhas duplicadas</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>pacientes_distintos <span class="ot">&lt;-</span> <span class="fu">distinct</span>(pacientes)</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_distintos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id_paciente nome    idade cidade        
        &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;         
1           1 Ana        25 São Paulo     
2           2 Bruno      30 Rio de Janeiro
3           3 Carlos     35 Belo Horizonte
4           4 Diana      40 Curitiba      
5           5 Eduardo    50 Porto Alegre  </code></pre>
</div>
</div>
<p><em>Exemplo 2</em>: Remover Duplicatas com Base em Colunas Específicas</p>
<p>Podemos especificar colunas específicas para considerar ao remover duplicatas. Neste exemplo, removeremos duplicatas com base nas colunas id, mantendo apenas uma ocorrência de cada combinação. Podemos usar o argumento <code>.keep_all = TRUE</code> para manter todas as colunas do data frame original, mesmo ao remover duplicatas com base em colunas específicas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover duplicatas com base nas colunas nome e idade</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>pacientes_distintos_colunas <span class="ot">&lt;-</span> <span class="fu">distinct</span>(pacientes, id_paciente, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes_distintos_colunas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  id_paciente nome    idade cidade        
        &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;         
1           1 Ana        25 São Paulo     
2           2 Bruno      30 Rio de Janeiro
3           3 Carlos     35 Belo Horizonte
4           4 Diana      40 Curitiba      
5           5 Eduardo    50 Porto Alegre  </code></pre>
</div>
</div>
</section>
<section id="sec-count" class="level3" data-number="12.2.13">
<h3 data-number="12.2.13" class="anchored" data-anchor-id="sec-count"><span class="header-section-number">12.2.13</span> Contando observações com <code>count()</code></h3>
<p>Contar observações em um conjunto de dados é uma operação fundamental em análise de dados. A função <code>count()</code> do pacote <code>dplyr</code> é uma ferramenta poderosa para contar o número de ocorrências de valores em uma ou mais colunas, proporcionando uma maneira rápida e eficiente de resumir dados categóricos.</p>
<p><em>Exemplo 1</em>: Contar Ocorrências Simples</p>
<p>Vamos considerar um conjunto de dados de pacientes e contar o número de ocorrências de cada doença e do gênero dos participantes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemplo de dados de pacientes com diagnósticos e sexo</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>pacientes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sexo =</span> <span class="fu">c</span>(<span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, </span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Feminino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, </span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Masculino"</span>),</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">diagnostico =</span> <span class="fu">c</span>(<span class="st">"Depressão"</span>, <span class="st">"Bipolaridade"</span>, <span class="st">"Pneumonia"</span>, <span class="st">"AVC"</span>, <span class="st">"Depressão"</span>, </span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Pneumonia"</span>, <span class="st">"Bipolaridade"</span>, <span class="st">"AVC"</span>, <span class="st">"Depressão"</span>, <span class="st">"Pneumonia"</span>,</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"AVC"</span>, <span class="st">"Bipolaridade"</span>, <span class="st">"Depressão"</span>, <span class="st">"Pneumonia"</span>, <span class="st">"AVC"</span>, </span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Bipolaridade"</span>, <span class="st">"Pneumonia"</span>, <span class="st">"Depressão"</span>, <span class="st">"Depressão"</span>, <span class="st">"Depressão"</span>))</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizar os dados</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pacientes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
   id_paciente sexo      diagnostico 
         &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       
 1           1 Feminino  Depressão   
 2           2 Masculino Bipolaridade
 3           3 Masculino Pneumonia   
 4           4 Feminino  AVC         
 5           5 Masculino Depressão   
 6           6 Feminino  Pneumonia   
 7           7 Feminino  Bipolaridade
 8           8 Masculino AVC         
 9           9 Feminino  Depressão   
10          10 Masculino Pneumonia   
11          11 Feminino  AVC         
12          12 Masculino Bipolaridade
13          13 Feminino  Depressão   
14          14 Masculino Pneumonia   
15          15 Feminino  AVC         
16          16 Masculino Bipolaridade
17          17 Feminino  Pneumonia   
18          18 Masculino Depressão   
19          19 Feminino  Depressão   
20          20 Masculino Depressão   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar o número de pacientes por genero</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(pacientes, sexo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sexo          n
  &lt;chr&gt;     &lt;int&gt;
1 Feminino     10
2 Masculino    10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar o número de pacientes por diagnóstico</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(pacientes, diagnostico)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  diagnostico      n
  &lt;chr&gt;        &lt;int&gt;
1 AVC              4
2 Bipolaridade     4
3 Depressão        7
4 Pneumonia        5</code></pre>
</div>
</div>
<p>Para ordenar os resultados em ordem decrescente pelo número de ocorrências, use o argumento <code>sort = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(pacientes, diagnostico, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  diagnostico      n
  &lt;chr&gt;        &lt;int&gt;
1 Depressão        7
2 Pneumonia        5
3 AVC              4
4 Bipolaridade     4</code></pre>
</div>
</div>
<p>Podemos contar ocorrências em múltiplas colunas como sexo e diagnóstico.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Contar o número de pacientes por sexo e diagnóstico</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(pacientes, diagnostico, sexo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  diagnostico  sexo          n
  &lt;chr&gt;        &lt;chr&gt;     &lt;int&gt;
1 AVC          Feminino      3
2 AVC          Masculino     1
3 Bipolaridade Feminino      1
4 Bipolaridade Masculino     3
5 Depressão    Feminino      4
6 Depressão    Masculino     3
7 Pneumonia    Feminino      2
8 Pneumonia    Masculino     3</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-forcats" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="sec-forcats"><span class="header-section-number">12.3</span> Trabalhando com dados categóricos com <code>forcats</code></h2>
<p>No campo da análise de dados, especialmente na área médica, os dados categóricos desempenham um papel crucial. Seja categorizando pacientes pelo genero, agrupando tratamentos ou analisando respostas de pesquisas, gerenciar essas variáveis categóricas de maneira eficiente é essencial. O pacote <code>forcats</code>, parte da coleção <code>tidyverse</code>, oferece um conjunto de ferramentas especificamente projetadas para trabalhar com fatores no R.</p>
<p>Fatores são a estrutura de dados do R para dados categóricos, permitindo que você manipule e analise dados não numéricos com facilidade. Embora o R base forneça funcionalidades básicas para fatores, o <code>forcats</code> aprimora isso, oferecendo ferramentas mais intuitivas para a manipulação de fatores. Este pacote simplifica tarefas como reordenar níveis de fatores, gerenciar valores ausentes e converter fatores para outros tipos de dados, tornando-se uma ferramenta indispensável para analistas de dados médicos.</p>
<p>Neste capítulo, você aprenderá a aproveitar as capacidades do forcats para agilizar seu fluxo de trabalho de análise de dados.</p>
<section id="variáveis-categóricas-e-factor-do-r" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="variáveis-categóricas-e-factor-do-r"><span class="header-section-number">12.3.1</span> Variáveis categóricas e <code>factor</code> do R</h3>
<p>R usa o tipo <code>factor</code> para lidar com variáveis categóricas, isto é, variáveis que possuem um conjunto fixo e conhecido de valores possíveis. O objetivo do pacote <code>forcats</code> é fornecer um conjunto de ferramentas que resolva problemas comuns com esse tipo de variável, incluindo a alteração da ordem dos níveis ou dos valores. Esse tipo de variável no R é também útil quando pretendemos apresentar os dados de forma que naão seja a ordem alfabética.</p>
<p>Por exemplo, se temos um conjunto de dados com os meses do ano, a ordenação correta não é a ordem alfabética, mas sim a sequência dos meses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Janeiro"</span>, <span class="st">"Fevereiro"</span>, <span class="st">"Março"</span>,    <span class="st">"Abril"</span>, </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Maio"</span>,    <span class="st">"Junho"</span>,     <span class="st">"Julho"</span>,    <span class="st">"Agosto"</span>, </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Setembro"</span>, <span class="st">"Outubro"</span>,  <span class="st">"Novembro"</span>, <span class="st">"Dezembro"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Veja que ao pedir ao R para ordenar os valores da variável meses, a ordenação segue em ordem alfabética, o que, nesse caso, é totalmente inconveniente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(meses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Abril"     "Agosto"    "Dezembro"  "Fevereiro" "Janeiro"   "Julho"    
 [7] "Junho"     "Maio"      "Março"     "Novembro"  "Outubro"   "Setembro" </code></pre>
</div>
</div>
<p>Isso pode ser corrigido transformando a variável num <code>factor</code> e definindo os níveis e a ordenação desses níveis da variável.</p>
<p>A primeira etapa é definir os níveis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"Janeiro"</span>, <span class="st">"Fevereiro"</span>, <span class="st">"Março"</span>,    <span class="st">"Abril"</span>, </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Maio"</span>,    <span class="st">"Junho"</span>,     <span class="st">"Julho"</span>,    <span class="st">"Agosto"</span>, </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Setembro"</span>, <span class="st">"Outubro"</span>,  <span class="st">"Novembro"</span>, <span class="st">"Dezembro"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A segunda etapa é transformar a variável original numa do tipo factor com a função <code>factor()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o pacote forcats</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>meses2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(meses, <span class="at">levels =</span> meses)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(meses2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Janeiro   Fevereiro Março     Abril     Maio      Junho     Julho    
 [8] Agosto    Setembro  Outubro   Novembro  Dezembro 
12 Levels: Janeiro Fevereiro Março Abril Maio Junho Julho Agosto ... Dezembro</code></pre>
</div>
</div>
<p>Quando omitimos o argumento <code>levels</code>, a ordenação continua sendo alfabética:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>meses3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(meses)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(meses3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Abril     Agosto    Dezembro  Fevereiro Janeiro   Julho     Junho    
 [8] Maio      Março     Novembro  Outubro   Setembro 
12 Levels: Abril Agosto Dezembro Fevereiro Janeiro Julho Junho Maio ... Setembro</code></pre>
</div>
</div>
<p>Quando definimos os níveis de uma variável do tipo <code>factor</code> qualquer valor desconhecido é transformado em <code>NA</code>. Veja abaixo o que ocorre quando escrevemos um dos meses de forma errada (Fevereirooo):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>meses_erro <span class="ot">&lt;-</span>   <span class="fu">c</span>(<span class="st">"Janeiro"</span>, <span class="st">"Fevereirooo"</span>, <span class="st">"Março"</span>,    <span class="st">"Abril"</span>, </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Maio"</span>,    <span class="st">"Junho"</span>,     <span class="st">"Julho"</span>,    <span class="st">"Agosto"</span>, </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Setembro"</span>, <span class="st">"Outubro"</span>,  <span class="st">"Novembro"</span>, <span class="st">"Dezembro"</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>meses_erro <span class="ot">&lt;-</span> <span class="fu">factor</span>(meses_erro, <span class="at">levels =</span> meses)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(meses_erro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] Janeiro  Março    Abril    Maio     Junho    Julho    Agosto   Setembro
 [9] Outubro  Novembro Dezembro
12 Levels: Janeiro Fevereiro Março Abril Maio Junho Julho Agosto ... Dezembro</code></pre>
</div>
</div>
<p>O mês de Fevereiro não apareceu quando pedimos ao R para ordenar os valores, pois não havia um mes chamado “Fevereiro”. O data frame tinha um mês chamado “Fevereirooo” e portanto, o comando <code>sort()</code> ignorou esse mês, já que não havia entre os níveis um mês com esse nome.</p>
<p>Isso pode ser problemático, pois a exclusão foi feita de forma invisível, ou seja, o R não explicitou essa exclusão. É ainda que o pacote <code>forcats</code> mostra sua utilidade.</p>
</section>
<section id="manipulando-variáveis-categóricas-com-forcats" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2" class="anchored" data-anchor-id="manipulando-variáveis-categóricas-com-forcats"><span class="header-section-number">12.3.2</span> Manipulando variáveis categóricas com <code>forcats</code></h3>
<p>O pacote forcats é um pacote popular do R desenvolvido por Hadley Wickham que faz parte da coleção de pacotes do <code>tidyverse</code> Ele é projetado para trabalhar com dados categóricos, especificamente <code>factors</code> Algumas vantagens do pacote <code>forcats</code> incluem:</p>
<p><em>Consistência</em>: O pacote segue os princípios do <code>tidyverse</code>, garantindo uma interface consistente e intuitiva para trabalhar com <code>factors</code>.</p>
<p><em>Simplicidade</em>: <code>forcats</code> fornece um conjunto de funções que simplificam tarefas comuns, como alterar a ordem dos níveis de fatores, reduzir níveis ou reordenar níveis com base em sua frequência ou outros atributos.</p>
<p><em>Recodificação e renomeação</em>: funções como <code>fct_recode()</code> e <code>fct_relevel()</code> simplificam a recodificação ou renomeação de níveis de <code>factors</code>, o que pode ser particularmente útil ao limpar e pré-processar dados.</p>
<p><em>Controle</em>: o <code>forcats</code> facilita o controle explícito da ordem dos níveis das variáveis categóricas ou a definição de níveis específicos como referências nas análises, o que pode ser importante ao trabalhar com variáveis categóricas ordinais.</p>
<p><em>Visualização</em>: ao usar o <code>ggplot2</code>, outro pacote do <code>tidyverse</code>, as funções <code>forcats</code> podem ser usadas para personalizar a ordem das categorias exibidas, o que pode levar a gráficos mais informativos e esteticamente agradáveis.</p>
<p><em>Compatibilidade</em>: como parte da ordenação, o <code>forcats</code> funciona perfeitamente com outros pacotes de ordenação como <code>dplyr</code>, <code>aligner</code> e <code>ggplot2</code>, tornando-o uma excelente opção para gerenciar e visualizar dados categóricos em um fluxo de trabalho de dados organizado.</p>
<p><em>Documentação</em>: O pacote forcats vem com documentação abrangente e possui forte suporte da comunidade, tornando mais fácil para os usuários encontrar soluções para suas dúvidas e problemas.</p>
<p>Ao oferecer essas vantagens, o pacote <code>forcats</code> torna o trabalho com dados categóricos em R mais eficiente e fácil de usar.</p>
<section id="reordenando-variáveis-categóricas" class="level4" data-number="12.3.2.1">
<h4 data-number="12.3.2.1" class="anchored" data-anchor-id="reordenando-variáveis-categóricas"><span class="header-section-number">12.3.2.1</span> Reordenando variáveis categóricas</h4>
<p>Geralmente é útil alterar a ordem dos níveis de fator em uma visualização. Nos exemplos seguintes não se preocupe com os códigos para gerar os gráficos. Em capítulos adiante iremos discutir como criar gráficos com o <code>ggplot2</code>. No momento o que interessa é observar que podemos indicar ao R como deverá ser interpretada a ordenação da variável categórica.</p>
<p>A técnica ideal é definir essa ordenação antes de gerar o gráfico, como será mostrado nos códigos adiante.</p>
<p>Vejamos esse exemplo de uma <code>tibble</code> com os preços de frutas e legumes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando uma tibble fictícia</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">produto =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"abacaxi"</span>, <span class="st">"goiaba"</span>, <span class="st">"limão"</span>, <span class="st">"uva T"</span>, <span class="st">"kiwi"</span>, <span class="st">"vagem"</span>, <span class="st">"jilo"</span>)),</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">preco =</span> <span class="fu">c</span>(<span class="fl">3.0</span>, <span class="fl">3.5</span>, <span class="fl">1.5</span>, <span class="fl">11.0</span>, <span class="fl">8.39</span>, <span class="fl">4.55</span>, <span class="fl">2.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotar esses dados sem nenhum ajuste resultaria num gráfico ordenado de forma alfabética.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>produto, <span class="at">y=</span>preco), </span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">"lightgreen"</span>, </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Porém, frequentemente é interessante ordenar de acordo com algum padrão que não alfabético, por exemplo, de acordo com o preço. Para isso podemos usar a função <code>fct_reorder()</code> como abaixo. Veja como o mesmo gráfico agora será ordenado segundo o preço.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o pacote dplyr para usar mutate</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar a variável produto de acordo com uma outra variável: preco</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">produto =</span> <span class="fu">fct_reorder</span>(produto, preco))</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plotando novamente o gráfico</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>produto, <span class="at">y=</span>preco), </span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>, </span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill=</span><span class="st">"lightgreen"</span>, </span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">col=</span><span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="agrupando-categorias" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3" class="anchored" data-anchor-id="agrupando-categorias"><span class="header-section-number">12.3.3</span> Agrupando categorias</h3>
<p>As vezes desejamos colpasar algumas categorias mais específicas para outras mais genéricas. Por exemplo, podemos criar grupos de <code>legumes</code> e <code>frutas</code> a partir dos dados da tible anterior.</p>
<p>O código a seguir reune cria uma variável <code>tipo</code>, com dois grupos (<code>fruta</code> e <code>legume</code>). Para isso reúne sob o rótulo <code>fruta</code> os produtos “abacaxi”, “goiaba”, “limão”, “uva T” e “kiwi”; e sob o rótulo <code>legume</code> os produtos “vagem” e “jilo”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tipo =</span> <span class="fu">fct_collapse</span>(produto,</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"fruta"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"abacaxi"</span>, <span class="st">"goiaba"</span>, <span class="st">"limão"</span>, <span class="st">"uva T"</span>, <span class="st">"kiwi"</span>),</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"legume"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"vagem"</span>, <span class="st">"jilo"</span>)))</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  produto preco tipo  
  &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt; 
1 abacaxi  3    fruta 
2 goiaba   3.5  fruta 
3 limão    1.5  fruta 
4 uva T   11    fruta 
5 kiwi     8.39 fruta 
6 vagem    4.55 legume
7 jilo     2    legume</code></pre>
</div>
</div>
</section>
<section id="sec-recodingfactors" class="level3" data-number="12.3.4">
<h3 data-number="12.3.4" class="anchored" data-anchor-id="sec-recodingfactors"><span class="header-section-number">12.3.4</span> Recodificando variáveis categóricas</h3>
<p>Podemos recodificar os níveis da variáveis categórica <code>produto</code> usando <code>fct_recode()</code>.</p>
<p>Vamos recodificar:<br>
<code>uva T</code> para <code>Uva Thompson</code><br>
<code>limão</code> para <code>Limão Thaiti</code><br>
<code>goiaba</code> para <code>Goiaba</code><br>
<code>abacaxi</code> para <code>Abacaxi</code><br>
<code>kiwi</code> para <code>Kiwi</code><br>
<code>vagem</code> para <code>Vagem</code><br>
<code>jilo</code> para <code>Jiló</code></p>
<p>Veja que o novo nome vem na frente do nome antigo dentro do código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode factor levels</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">produto =</span> <span class="fu">fct_recode</span>(produto,</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Uva Thompson"</span> <span class="ot">=</span> <span class="st">"uva T"</span>,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Limão Thaiti"</span> <span class="ot">=</span> <span class="st">"limão"</span>,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Goiaba"</span>       <span class="ot">=</span> <span class="st">"goiaba"</span>,</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Abacaxi"</span>      <span class="ot">=</span> <span class="st">"abacaxi"</span>,</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Kiwi"</span>         <span class="ot">=</span> <span class="st">"kiwi"</span>,</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Vagem"</span>        <span class="ot">=</span> <span class="st">"vagem"</span>, </span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Jiló"</span>         <span class="ot">=</span> <span class="st">"jilo"</span>))</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  produto      preco tipo  
  &lt;fct&gt;        &lt;dbl&gt; &lt;fct&gt; 
1 Abacaxi       3    fruta 
2 Goiaba        3.5  fruta 
3 Limão Thaiti  1.5  fruta 
4 Uva Thompson 11    fruta 
5 Kiwi          8.39 fruta 
6 Vagem         4.55 legume
7 Jiló          2    legume</code></pre>
</div>
</div>
</section>
<section id="ordenando-de-acordo-com-a-frequencia-dos-elementos" class="level3" data-number="12.3.5">
<h3 data-number="12.3.5" class="anchored" data-anchor-id="ordenando-de-acordo-com-a-frequencia-dos-elementos"><span class="header-section-number">12.3.5</span> Ordenando de acordo com a frequencia dos elementos</h3>
<p>O pacote <code>forcats</code> tem também uma função que ordena os elementos de acordo com a frequencia deles. Vejamos a aplicação dessa função num data frame que contém as variáveis sexo, idade.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um data frame com dados de idade e sexo</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir parâmetros da distribuição normal</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>media_idade   <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>desvio_padrao <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>n_pessoas     <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir sementes aleatórias para garantir a reprodutibilidade</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar uma tibble com o nome df_sexo</span></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>df_sexo <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span>n_pessoas,</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sexo =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Masculino"</span>, <span class="st">"Feminino"</span>, <span class="st">"Outro"</span>, <span class="st">"Não definido"</span>), n_pessoas, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idade =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n_pessoas, <span class="at">mean =</span> media_idade, <span class="at">sd =</span> desvio_padrao), <span class="dv">0</span>))</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_sexo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 3
      id sexo         idade
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1     1 Feminino        51
 2     2 Outro           40
 3     3 Outro           42
 4     4 Não definido    53
 5     5 Feminino        47
 6     6 Masculino       41
 7     7 Feminino        53
 8     8 Masculino       36
 9     9 Feminino        32
10    10 Feminino        44
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Veja que a frequencia continua sendo por ordem alfabética.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotando um gráfico de barras das frequencias de cada sexo</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sexo) <span class="sc">+</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>sexo, <span class="at">fill=</span>sexo)) <span class="sc">+</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Podemos fazer com que as barras sejam plotadas de acordo com a frequencia, o que faz o gráfico ficar esteticamente mais interessante. Para isso usaremos a função <code>fct_infreq()</code> para indicar que essa variável categórica deverá ser tratada de acordo com a frequencia dos dados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicando que a variável sexo deverá ser ordenada de acordo com a frequencia (decrescente)</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>df_sexo <span class="ot">&lt;-</span> df_sexo <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexo =</span> <span class="fu">fct_infreq</span>(sexo))</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plotando um gráfico de barras das frequencias de cada sexo</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sexo) <span class="sc">+</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>sexo, <span class="at">fill=</span>sexo)) <span class="sc">+</span></span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Caso o interesse seja plotar na ordem inversa, podemos fazer isso com a função <code>fct_rev</code> aplicada juntamente com a função <code>fct_infreq</code> como mostra o código abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicando que a variável sexo deverá ser ordenada de acordo com a frequencia, na ordem crescente</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>df_sexo <span class="ot">&lt;-</span> df_sexo <span class="sc">%&gt;%</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sexo =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(sexo)))</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plotando um gráfico de barras das frequencias de cada sexo</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sexo) <span class="sc">+</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>sexo, <span class="at">fill=</span>sexo)) <span class="sc">+</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="categorizando-variáveis-numéricas-com-a-função-cut" class="level3" data-number="12.3.6">
<h3 data-number="12.3.6" class="anchored" data-anchor-id="categorizando-variáveis-numéricas-com-a-função-cut"><span class="header-section-number">12.3.6</span> Categorizando variáveis numéricas com a função cut( )</h3>
<p>A função <code>cut()</code> nos permite criar uma variável categórica a partir de uma variável numérica. Isso é útil em diversas situações como por exemplo criar grupos de crianças, adultos e idosos a partir de uma variável numérica; ou categorizar escores númericos em escalas em níveis de leve, moderado e grave. A função <code>cut()</code> discretiza esses dados e nos permite criar também os rótulos (nomes) para essas categorias.</p>
<p>A forma usual dessa função é:</p>
<pre><code>  cut(variável, 
      breaks=c(-Inf, x1, x2, Inf),
      labels=c("label", "label", "label"))</code></pre>
<p>Veja que o parâmetro breaks pode usar <code>-Inf</code> como limite inferior e <code>Inf</code> como limite superior, significando limite infinito negativo e limite infinito positivo. Entretanto, geralmente conhecemos nosso dataset e o ideal é usar os limites máximo e mínino conhecidos.</p>
<p>Entre esses limites extremos serão definidos os pontos de corte. Veja também que com 4 pontos serão criados 3 categorias. Por padrão os intervalos são do abertos à esquerda e fechados à direita, tal como em (x1, x2]. De tal forma que o intervalo termina no valores indicados, incluindo esse valor.</p>
<p>Outra funcionalidade bastante útil da função <code>cut()</code> é a possibilidade de criação de rótulos próprios, <code>labels</code> para nomear as categorias criadas. É importante aqui que o número de labels seja exatamente igual ao número de categorias criadas. Com 4 pontos no argumento breaks como no exemplo acima serão criados 3 categorias.</p>
<p>Para exemplificar o uso da função cut vamos usar o dataset <code>mpg</code> e criar uma variável categórica <code>cty_cat</code> a partir <code>cty</code> (milhas percorridas na estrada com 1 galão de combustível). A variável <code>cty</code> é numérica, com valores variando de 9 milhas a 35 milhas. Vamos definir 3 categorias de carros:</p>
<p>Como o limite superior do intervalo é aberto, o valor desse ponto de corte será parte da 1º categoria, portanto, o primeiro ponto de corte deve ser 15, já que definimos o primeiro intervalo como menor ou igual a 15. O segundo ponto de corte será 20, pois será o limite superior da segunda categoria é menor ou igual a 20. O código ficará então assim:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mpg)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>cty_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(mpg<span class="sc">$</span>cty,               </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">35</span>),                  </span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Beberrão"</span>,<span class="st">"Moderado"</span>, <span class="st">"Econômico"</span>))</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Beberrão  Moderado Econômico 
       97        92        45 </code></pre>
</div>
</div>
<p>Agora o data frame mpg contém uma nova variável categórica denominada <code>cty_cat</code> com 3 níveis, o que podemos verificar com a função <code>class()</code> e <code>unique()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Moderado  Econômico Beberrão 
Levels: Beberrão Moderado Econômico</code></pre>
</div>
</div>
<p>Entretanto, ainda falta um pequeno detalhe. A variável criada deveria ser ordenada, mas foi criada como sendo uma variável nominal. Por padrão o R cria uma variável categórica nominal com a função <code>cut()</code>. Para indicar que desejamos que a nova variável seja ordenada devemos incluir o parâmetro <code>ordered_result</code> como sendo TRUE (<code>ordered_result = TRUE</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>cty_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(mpg<span class="sc">$</span>cty,</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">35</span>),                               </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Beberrão"</span>,<span class="st">"Moderado"</span>, <span class="st">"Econômico"</span>),</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ordered_result =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos verificar agora que a variável <code>cty_cat( )</code> é ordenada e qual a ordenação.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ordered" "factor" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Moderado  Econômico Beberrão 
Levels: Beberrão &lt; Moderado &lt; Econômico</code></pre>
</div>
</div>
</section>
</section>
<section id="tabulando-dados-categóricos" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="tabulando-dados-categóricos"><span class="header-section-number">12.4</span> Tabulando dados categóricos</h2>
<p>Os dados categóricos desempenham um papel fundamental em pesquisas na área da saúde, sendo essenciais para a compreensão de padrões, tendências e relações dentro dos dados coletados. Dados categóricos são aqueles que podem ser classificados em diferentes categorias ou grupos, como sexo, tipo de doença, grupo sanguíneo, entre outros. Ao contrário dos dados numéricos, que representam quantidades e podem ser submetidos a operações matemáticas diretas, os dados categóricos representam qualidades e são analisados de maneiras distintas.</p>
<p>A importância dos dados categóricos em estudos de saúde é evidente em diversas situações. Por exemplo, em estudos epidemiológicos, a categorização dos indivíduos por faixa etária, sexo e fatores de risco é crucial para entender a distribuição e os determinantes das doenças. Da mesma forma, em ensaios clínicos, a resposta dos pacientes a diferentes tratamentos pode ser categorizada como “melhora”, “piora” ou “nenhuma mudança”, proporcionando insights valiosos sobre a eficácia dos tratamentos.</p>
<p>Outro exemplo relevante é a categorização de doenças. As classificações internacionais, como a Classificação Internacional de Doenças (CID), utilizam categorias para agrupar doenças e condições de saúde, facilitando a coleta, análise e comparação de dados em nível global. Isso permite identificar tendências em saúde pública, avaliar a carga de doenças e desenvolver estratégias de prevenção e controle mais eficazes.</p>
<p>Além disso, dados categóricos são frequentemente utilizados para estudar a relação entre variáveis. Por exemplo, pode-se investigar a associação entre o tipo de dieta (vegetariana, vegana, onívora) e a incidência de doenças cardiovasculares, ou entre hábitos de vida (não-fumante, ex-fumante, fumante) e o risco de desenvolver câncer.</p>
<p>Uma das principais tarefas ao análisar dados categóricos é sua tabulação, ou seja, a contagem da quantidade ou do percentual em cada grupo e a criação de tabelas de frequencias. Veremos também que frequentemente precisamos recodificar o nome de variáveis, agrupar categorias em níveis mais amplos.</p>
<section id="preparando-as-variáveis-categóricas-para-tabulação." class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="preparando-as-variáveis-categóricas-para-tabulação."><span class="header-section-number">12.4.1</span> Preparando as variáveis categóricas para tabulação.</h3>
<p>As funções <code>table()</code> e <code>prop.table()</code> do R possibilitam a criação de tabelas de frequencias de dados categóricos com grande praticidade. Veremos também como usar as funções <code>count()</code> do <code>tidyverse</code> para criar essas tabelas.</p>
<p>Lembre-se que é sempre indicado verificarmos como o R está interpretando as variáveis, para nos certificamos que as variáveis a serem analisadas estão realmente no formato <code>factor</code>, formato para variáveis categóricas do R. Além disso, também é bom indicarmos se há alguma ordenação ou não nessas variáveis antes de qualquer análise.</p>
<p>Quando lidamos com variáveis categóricas, usar números para identificar os tipos deixa as tabelas muito confusas. Por exemplo, no caso do dataset <code>mtcars</code> precisamos lembrar que “0” significa motores em V e “1” significa motores alinhados. Seria melhor renomear essas variáveis categóricas antes de criar as tabelas, como fizemos na seção sobre o pacote <code>forcats</code> (<a href="#sec-recodingfactors"><span>Section&nbsp;12.3.4</span></a>).</p>
<p>Vamos usar como exemplo ainda o dataset <code>mtcars</code>. Inicialmente usaremos a função <code>str()</code> para verificar a estrutura desse arquivo e verificar como o R está interpretando os tipos de cada variável. O comando “<code>?mtcars</code>” digitado no console mostrará no painel help as informações sobre esse dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<p>Veja que o R interpreta diversas variáveis categóricas desse dataset como sendo numéricas.<br>
A variável <code>am</code> é na verdade categórica, e indica se o carro tem marcha automática (“0”) ou manual (“1”). A variável <code>vs</code> é também categórica, e indica o tipo de motor. O valor “0” indica motor V-Shaped e valor “1” indica motor linear. A variável <code>cyl</code>, apesar de também trazer números, é na também categórica, e indica o número de cilindros do carro, podendo ser 4, 6 ou 8 cilindros.</p>
<p>A primeira etapa será então transformar essas variáveis em categóricas com <code>as.factor()</code> e a segunda etapa será renomear essas variáveis com rótulos mais descritivos, usando <code>fct_recode()</code>do pacote <code>forcats</code>, para facilitar a interpretação dos dados. No caso da variável <code>cyl</code>, que indica as cilindradas do carro, será útil também indicar a ordenação dessa variável.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats) <span class="co"># necessário para usar a função fct_recode</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável 'am' em categórica</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>am)</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificando os rótulos de am</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(mtcars<span class="sc">$</span>am, <span class="st">"Automático"</span> <span class="ot">=</span> <span class="st">"0"</span>, <span class="st">"Manual"</span> <span class="ot">=</span> <span class="st">"1"</span>)</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável 'vs' em categórica</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>vs)</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificando os rótulos de  vs</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(mtcars<span class="sc">$</span>vs, <span class="st">"Motor em V"</span> <span class="ot">=</span> <span class="st">"0"</span>, <span class="st">"Motor em linha"</span> <span class="ot">=</span> <span class="st">"1"</span>)</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando a variável 'cyl' em categórica</span></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Recodificando os rótulos de  cyl</span></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(mtcars<span class="sc">$</span>cyl, <span class="st">"4 Cilindros"</span> <span class="ot">=</span> <span class="st">"4"</span>, <span class="st">"6 Cilindros"</span> <span class="ot">=</span> <span class="st">"6"</span>, <span class="st">"8 Cilindros"</span> <span class="ot">=</span> <span class="st">"8"</span>)</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicando a ordenação dos calores dessa variável</span></span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(mtcars<span class="sc">$</span>cyl, <span class="st">"4 Cilindros"</span>, <span class="st">"6 Cilindros"</span>, <span class="st">"8 Cilindros"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Veja agora essas variáveis estão sendo corretamente interpretadas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : Factor w/ 3 levels "4 Cilindros",..: 2 2 1 2 3 2 3 1 1 2 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : Factor w/ 2 levels "Motor em V","Motor em linha": 1 1 2 2 1 2 1 2 2 2 ...
 $ am  : Factor w/ 2 levels "Automático","Manual": 2 2 2 1 1 1 1 1 1 1 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<p>Agora que já temos nossas variáveis categóricas interpretadas corretamente no R podemos criar nossas tabelas de frequencias.</p>
</section>
<section id="tabulando-variáveis-categóricas" class="level3" data-number="12.4.2">
<h3 data-number="12.4.2" class="anchored" data-anchor-id="tabulando-variáveis-categóricas"><span class="header-section-number">12.4.2</span> Tabulando variáveis categóricas</h3>
<section id="a-função-table-do-r-base" class="level4" data-number="12.4.2.1">
<h4 data-number="12.4.2.1" class="anchored" data-anchor-id="a-função-table-do-r-base"><span class="header-section-number">12.4.2.1</span> A função <code>table()</code> do R base</h4>
<p>A função <code>table()</code> do R é utilizada para criar tabelas de contingência a partir de vetores ou fatores. Ela conta as frequências de ocorrência de cada valor único nas variáveis fornecidas, sendo muito útil para resumir e analisar dados categóricos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mtcars<span class="sc">$</span>cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
4 Cilindros 6 Cilindros 8 Cilindros 
         11           7          14 </code></pre>
</div>
</div>
<p>Podemos também usar o <code>pipe</code> juntamente com a função <code>table()</code>, mas nesse caso, precisamos selecionar as colunas desejadas usando <code>select()</code> antes da função <code>table()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar as função select()</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>mtcars  <span class="sc">|&gt;</span>   </span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cyl) <span class="sc">|&gt;</span> </span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cyl
4 Cilindros 6 Cilindros 8 Cilindros 
         11           7          14 </code></pre>
</div>
</div>
<p>Podemos criar tabelas 2x2 com a função table, bastando para isso selecinar as duas colunas/variáveis desejadas. O código abaixo constroi uma tabela 2x2 com as variáveis cilindradas (cyl) e alinhamento do motor (vs)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar as função select()</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>mtcars  <span class="sc">|&gt;</span>   </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cyl, vs) <span class="sc">|&gt;</span> </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             vs
cyl           Motor em V Motor em linha
  4 Cilindros          1             10
  6 Cilindros          3              4
  8 Cilindros         14              0</code></pre>
</div>
</div>
<section id="calculando-percentuais-com-prop.table" class="level5" data-number="12.4.2.1.1">
<h5 data-number="12.4.2.1.1" class="anchored" data-anchor-id="calculando-percentuais-com-prop.table"><span class="header-section-number">12.4.2.1.1</span> Calculando percentuais com prop.table()</h5>
<p>A função <code>prop.table()</code> calcula percentuais em tabelas. Importante entender que o argumento da função <code>prop.table()</code> é uma tabela criada com a função <code>table()</code>. Ou seja, precisamos primeiro criar a tabela com <code>table()</code> para depois aplicarmos a função <code>prop.table()</code>. Para tornar o código mais fácil de ser lido, é conveniente usar o operador pipe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando o percentual de carros com motor em V e motores em linha reta</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nesse exemplo não foi usado o operador pipe.</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(mtcars<span class="sc">$</span>vs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Motor em V Motor em linha 
        0.5625         0.4375 </code></pre>
</div>
</div>
<p>Esse código pode ser escrito de forma mais elegante usando o operador pipe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando o percentual de carros com motor em V e motores em linha reta</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nesse exemplo usamos o operador pipe.</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>vs <span class="sc">|&gt;</span> </span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Motor em V Motor em linha 
        0.5625         0.4375 </code></pre>
</div>
</div>
<p>Observe que o código com o pipe fica bem mais elegante, e facilita as próximas etapas. Podemos agora facilmente agregar outras funções, por exemplo, arredondar as casas decimais para apenas duas casas, adicionar uma coluna com o total, multiplicar por 100 para tornar o número um percentual, etc:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando o percentual de carros com motor em V e motores em linha reta</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nesse exemplo usamos o operador pipe.</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span>      <span class="co"># iniciando o pipe com a variável dataset mtcars2 (criando anteriormente)</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vs) <span class="sc">|&gt;</span> </span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span>       <span class="co"># criando a tabela com os valores absolutos</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>() <span class="sc">|&gt;</span>  <span class="co"># calculando os percentuais</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">100</span>) <span class="sc">|&gt;</span>    <span class="co"># multiplicando os valores por 100</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>()     <span class="co"># adicionando uma coluna com o total.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>vs
    Motor em V Motor em linha            Sum 
         56.25          43.75         100.00 </code></pre>
</div>
</div>
<p>Podemos também criar tabelas com mais de uma variável, por exemplo, acrescentando aqui a variável <code>am</code>, que indica o tipo de marcha usado (autmática ou manual).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span>          <span class="co"># iniciando o pipe o dataset mtcars2 (criando anteriormente)</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vs, am) <span class="sc">|&gt;</span> <span class="co"># selecionando as duas variáveis, vs e am</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span>        <span class="co"># criando a tabela com os valores absolutos</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>()      <span class="co"># adicionando uma coluna com o total.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                am
vs               Automático Manual Sum
  Motor em V             12      6  18
  Motor em linha          7      7  14
  Sum                    19     13  32</code></pre>
</div>
</div>
<p>Em tabelas com mais de uma variável é preciso ter cuidado com a função <code>prop.table()</code>. Essa função vai calcular os percentuais em cada célula usando o total de elementos. Nessa tabela acima podemos ver que temos 32 carros. Então os percentuais serão calculados com base em 32, como mostrado abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span>          <span class="co"># iniciando o pipe o dataset mtcars2 (criando anteriormente)</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vs, am) <span class="sc">|&gt;</span> <span class="co"># selecionando as duas variáveis, vs e am</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span>        <span class="co"># criando a tabela com os valores absolutos</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">100</span>) <span class="sc">|&gt;</span>     <span class="co"># multiplicando os valores por 100</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>()      <span class="co"># adicionando uma coluna com o total.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                am
vs               Automático  Manual     Sum
  Motor em V         37.500  18.750  56.250
  Motor em linha     21.875  21.875  43.750
  Sum                59.375  40.625 100.000</code></pre>
</div>
</div>
<p>Muitas vezes é intessante calcular os percentuais nas linhas ou nas colunas e não no total. Para isso é necessário adicionar o argumento “1” ou “2” na função <code>prop.table()</code>.</p>
<p>1 - calcula as proporções nas linhas 2 - calcula as proporções nas colunas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span>          <span class="co"># iniciando o pipe o dataset mtcars2 (criando anteriormente)</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vs, am) <span class="sc">|&gt;</span> <span class="co"># selecionando as duas variáveis, vs e am</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span>        <span class="co"># criando a tabela com os valores absolutos</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span>  <span class="co"># calculando as proporções nas linhas</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">100</span>) <span class="sc">|&gt;</span>     <span class="co"># multiplicando os valores por 100</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>() <span class="sc">|&gt;</span>   <span class="co"># adicionando uma coluna com o total.</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">1</span>)          <span class="co"># arredonda os valores para 1 casa decimal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                am
vs               Automático Manual   Sum
  Motor em V           66.7   33.3 100.0
  Motor em linha       50.0   50.0 100.0
  Sum                 116.7   83.3 200.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span>          <span class="co"># iniciando o pipe o dataset mtcars2 (criando anteriormente)</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vs, am) <span class="sc">|&gt;</span> <span class="co"># selecionando as duas variáveis, vs e am</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span>        <span class="co"># criando a tabela com os valores absolutos</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span>  <span class="co"># calculando as proporções nas colunas</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">`</span><span class="at">*</span><span class="st">`</span>)(<span class="dv">100</span>) <span class="sc">|&gt;</span>     <span class="co"># multiplicando os valores por 100</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>() <span class="sc">|&gt;</span>   <span class="co"># adicionando uma coluna com o total.</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">1</span>)          <span class="co"># arredonda os valores para 1 casa decimal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                am
vs               Automático Manual   Sum
  Motor em V           63.2   46.2 109.3
  Motor em linha       36.8   53.8  90.7
  Sum                 100.0  100.0 200.0</code></pre>
</div>
</div>
</section>
<section id="lidando-com-nas-na-função-table" class="level5" data-number="12.4.2.1.2">
<h5 data-number="12.4.2.1.2" class="anchored" data-anchor-id="lidando-com-nas-na-função-table"><span class="header-section-number">12.4.2.1.2</span> Lidando com NAs na função <code>table()</code></h5>
<p>Frequentemente existem dados faltantes em datasets. Esses dados são usualmente denotados no R pela sigla <code>NA</code> que indica <strong>Not Available</strong> (não disponível).</p>
<p>A função <code>table()</code>, por padrão, não inclui os dados faltantes na tabela gerada. Entretanto, muitas vezes é importante poder ter esses dados incluídos na tabela. Para isso é necessário ajustar um parâmetro da função table, inserindo <code>exclude=false</code> na função como mostremos a seguir.</p>
<p>Para exemplificar isso vamos primeiro inserir alguns <code>NAs</code> no dataset <code>mtcars</code>. O código abaixo faz com que todos os carros com 8 cilindros, na variável <code>cyl</code> sejam trocados por <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl[mtcars<span class="sc">$</span>cyl<span class="sc">==</span><span class="st">"8 Cilindros"</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>mtcars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     mpg         cyl  disp  hp drat    wt  qsec             vs
Mazda RX4           21.0 6 Cilindros 160.0 110 3.90 2.620 16.46     Motor em V
Mazda RX4 Wag       21.0 6 Cilindros 160.0 110 3.90 2.875 17.02     Motor em V
Datsun 710          22.8 4 Cilindros 108.0  93 3.85 2.320 18.61 Motor em linha
Hornet 4 Drive      21.4 6 Cilindros 258.0 110 3.08 3.215 19.44 Motor em linha
Hornet Sportabout   18.7        &lt;NA&gt; 360.0 175 3.15 3.440 17.02     Motor em V
Valiant             18.1 6 Cilindros 225.0 105 2.76 3.460 20.22 Motor em linha
Duster 360          14.3        &lt;NA&gt; 360.0 245 3.21 3.570 15.84     Motor em V
Merc 240D           24.4 4 Cilindros 146.7  62 3.69 3.190 20.00 Motor em linha
Merc 230            22.8 4 Cilindros 140.8  95 3.92 3.150 22.90 Motor em linha
Merc 280            19.2 6 Cilindros 167.6 123 3.92 3.440 18.30 Motor em linha
Merc 280C           17.8 6 Cilindros 167.6 123 3.92 3.440 18.90 Motor em linha
Merc 450SE          16.4        &lt;NA&gt; 275.8 180 3.07 4.070 17.40     Motor em V
Merc 450SL          17.3        &lt;NA&gt; 275.8 180 3.07 3.730 17.60     Motor em V
Merc 450SLC         15.2        &lt;NA&gt; 275.8 180 3.07 3.780 18.00     Motor em V
Cadillac Fleetwood  10.4        &lt;NA&gt; 472.0 205 2.93 5.250 17.98     Motor em V
Lincoln Continental 10.4        &lt;NA&gt; 460.0 215 3.00 5.424 17.82     Motor em V
Chrysler Imperial   14.7        &lt;NA&gt; 440.0 230 3.23 5.345 17.42     Motor em V
Fiat 128            32.4 4 Cilindros  78.7  66 4.08 2.200 19.47 Motor em linha
Honda Civic         30.4 4 Cilindros  75.7  52 4.93 1.615 18.52 Motor em linha
Toyota Corolla      33.9 4 Cilindros  71.1  65 4.22 1.835 19.90 Motor em linha
Toyota Corona       21.5 4 Cilindros 120.1  97 3.70 2.465 20.01 Motor em linha
Dodge Challenger    15.5        &lt;NA&gt; 318.0 150 2.76 3.520 16.87     Motor em V
AMC Javelin         15.2        &lt;NA&gt; 304.0 150 3.15 3.435 17.30     Motor em V
Camaro Z28          13.3        &lt;NA&gt; 350.0 245 3.73 3.840 15.41     Motor em V
Pontiac Firebird    19.2        &lt;NA&gt; 400.0 175 3.08 3.845 17.05     Motor em V
Fiat X1-9           27.3 4 Cilindros  79.0  66 4.08 1.935 18.90 Motor em linha
Porsche 914-2       26.0 4 Cilindros 120.3  91 4.43 2.140 16.70     Motor em V
Lotus Europa        30.4 4 Cilindros  95.1 113 3.77 1.513 16.90 Motor em linha
Ford Pantera L      15.8        &lt;NA&gt; 351.0 264 4.22 3.170 14.50     Motor em V
Ferrari Dino        19.7 6 Cilindros 145.0 175 3.62 2.770 15.50     Motor em V
Maserati Bora       15.0        &lt;NA&gt; 301.0 335 3.54 3.570 14.60     Motor em V
Volvo 142E          21.4 4 Cilindros 121.0 109 4.11 2.780 18.60 Motor em linha
                            am gear carb
Mazda RX4               Manual    4    4
Mazda RX4 Wag           Manual    4    4
Datsun 710              Manual    4    1
Hornet 4 Drive      Automático    3    1
Hornet Sportabout   Automático    3    2
Valiant             Automático    3    1
Duster 360          Automático    3    4
Merc 240D           Automático    4    2
Merc 230            Automático    4    2
Merc 280            Automático    4    4
Merc 280C           Automático    4    4
Merc 450SE          Automático    3    3
Merc 450SL          Automático    3    3
Merc 450SLC         Automático    3    3
Cadillac Fleetwood  Automático    3    4
Lincoln Continental Automático    3    4
Chrysler Imperial   Automático    3    4
Fiat 128                Manual    4    1
Honda Civic             Manual    4    2
Toyota Corolla          Manual    4    1
Toyota Corona       Automático    3    1
Dodge Challenger    Automático    3    2
AMC Javelin         Automático    3    2
Camaro Z28          Automático    3    4
Pontiac Firebird    Automático    3    2
Fiat X1-9               Manual    4    1
Porsche 914-2           Manual    5    2
Lotus Europa            Manual    5    2
Ford Pantera L          Manual    5    4
Ferrari Dino            Manual    5    6
Maserati Bora           Manual    5    8
Volvo 142E              Manual    4    2</code></pre>
</div>
</div>
<p>A função <code>table()</code> usual não iria inclui nenhum valor <code>NA</code> e, portanto, podemos ter a falsa impressão que não há dados faltantes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mtcars<span class="sc">$</span>cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
4 Cilindros 6 Cilindros 8 Cilindros 
         11           7           0 </code></pre>
</div>
</div>
<p>Entretanto, podemos mudar esse comportamento da função <code>table()</code> inserindo o parâmetro <code>exclude = FALSE</code> como a seguir, que mostra haver 14 <code>NAs</code> nessa variável.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mtcars<span class="sc">$</span>cyl, <span class="at">exclude =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
4 Cilindros 6 Cilindros 8 Cilindros        &lt;NA&gt; 
         11           7           0          14 </code></pre>
</div>
</div>
<p>Para voltar a usar o dataset <code>mtcars</code> com os dados completos, basta carregar novamente esse dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
</section>
</section>
<section id="cruzando-dados-com-a-função-xtabs" class="level4" data-number="12.4.2.2">
<h4 data-number="12.4.2.2" class="anchored" data-anchor-id="cruzando-dados-com-a-função-xtabs"><span class="header-section-number">12.4.2.2</span> Cruzando dados com a função xtabs( )</h4>
<p>A função <code>xtabs()</code> serve para criarmos tabelas de cruzamento de dados usando o operador de fórmulas <code>~</code> já discutido no capítulo de operadores (<a href="07-Operators.html"><span>Chapter&nbsp;8</span></a>). Para demonstrar o uso dessa função vamos usar os dados do dataset <code>mpg</code> do pacote <code>ggplot2</code>.</p>
<p>A variável <code>drv</code> contém dados acerca do tipo de tração dos carros (f=frontal, r=traseira, 4=4x4) e a variável <code>class</code> contém dados acerca do tipo de carro (compact, midsize, suv, 2seater, minivan, pickup, subcompact).</p>
<p>A expressão a ser usada como argumento nessa função tem a forma a seguir <code>xtabs(~ variável + variável, dataset)</code></p>
<p>Vamos criar uma tabela com o tipo de tração <code>drv</code> nas linhas e o tipo de carro <code>class</code> nas colunas, usando a função <code>xtabs()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>( <span class="sc">~</span> drv <span class="sc">+</span> class, mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   class
drv 2seater compact midsize minivan pickup subcompact suv
  4       0      12       3       0     33          4  51
  f       0      35      38      11      0         22   0
  r       5       0       0       0      0          9  11</code></pre>
</div>
</div>
</section>
<section id="tabulando-dados-com-count" class="level4" data-number="12.4.2.3">
<h4 data-number="12.4.2.3" class="anchored" data-anchor-id="tabulando-dados-com-count"><span class="header-section-number">12.4.2.3</span> Tabulando dados com <code>count()</code></h4>
<p>A função <code>count()</code> do pacote <code>dplyr</code> é uma ferramenta poderosa para contar observações em um dataframe, especialmente quando se trabalha com dados em formato de tabela. Ela oferece uma sintaxe simples e intuitiva, permitindo facilmente agregar e contar dados categóricos.</p>
<p>Vamos explorar o uso de <code>count()</code> com o exemplo do dataset mtcars e discutir as diferenças e vantagens em relação à função <code>table()</code> do R base.</p>
<p><strong>Vantagens do <code>count()</code></strong></p>
<p><em>Clareza e Consistência</em>: A função count() é mais intuitiva e consistente com outras funções do dplyr, proporcionando uma curva de aprendizado mais suave para os usuários do tidyverse. Tem sintaxe mais legível e intuitiva, especialmente para quem já está familiarizado com o estilo de manipulação de dados do <code>dplyr.</code></p>
<p><em>Integração com o tidyverse</em>: Permite encadear operações de forma clara e eficiente, melhorando a legibilidade e a manutenção do código.</p>
<p><em>Flexibilidade</em>: Facilita operações adicionais como agrupamentos complexos e filtros dentro da mesma cadeia de operações. Integra-se perfeitamente com outras funções do <code>dplyr</code>, permitindo operações adicionais como filtragem, agrupamento e mutação de dados em uma sequência fluida de comandos.</p>
<p><em>Resultado</em>: A função <code>count()</code> retorna um tibble, que é um tipo de dataframe moderno e mais amigável para manipulação subsequente dentro do universo tidyverse. Por outro lado, a função <code>table()</code> retorna um objeto de classe table, que pode exigir conversão adicional para se integrar com outras funções de manipulação de dados.</p>
<p>Em resumo, a função <code>count()</code> do <code>dplyr</code> oferece uma abordagem moderna e integrada para contar dados categóricos em dataframes, proporcionando vantagens significativas em termos de sintaxe, flexibilidade e integração com outras funções do tidyverse. Embora <code>table()</code> do R base seja útil e eficiente para contagens rápidas, <code>count()</code> é preferível em contextos onde a manipulação e análise de dados complexos são necessárias.</p>
<section id="tabulando-uma-variável-com-count" class="level5" data-number="12.4.2.3.1">
<h5 data-number="12.4.2.3.1" class="anchored" data-anchor-id="tabulando-uma-variável-com-count"><span class="header-section-number">12.4.2.3.1</span> Tabulando uma variável com count()</h5>
<p>A função <code>count()</code> pode ser utilizada para contar as ocorrências de cada valor único de uma variável. Vamos contar o número de carros para cada número de cilindros (cyl).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> </span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl  n
1   4 11
2   6  7
3   8 14</code></pre>
</div>
</div>
<p>Podemos acrescentar o argumento sort=TRUE para mostrar os grupos com mais elementos no topo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> </span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl  n
1   8 14
2   4 11
3   6  7</code></pre>
</div>
</div>
</section>
<section id="tabulando-duas-variáveis-com-count" class="level5" data-number="12.4.2.3.2">
<h5 data-number="12.4.2.3.2" class="anchored" data-anchor-id="tabulando-duas-variáveis-com-count"><span class="header-section-number">12.4.2.3.2</span> Tabulando duas variáveis com count()</h5>
<p>Com a função <code>count()</code> podemos contar o número ocorrências de uma variável categórica, agrupadas segundo uma outra variável categórica. Por exemplo, podemos contar o número de de carros agrupados por número de cilindros (cyl) de acordo com o tipo de marcha (am) - automática ou manual.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl, am)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl am  n
1   4  0  3
2   4  1  8
3   6  0  4
4   6  1  3
5   8  0 12
6   8  1  2</code></pre>
</div>
</div>
</section>
</section>
<section id="calculando-proporções-com-count" class="level4" data-number="12.4.2.4">
<h4 data-number="12.4.2.4" class="anchored" data-anchor-id="calculando-proporções-com-count"><span class="header-section-number">12.4.2.4</span> Calculando Proporções com count()</h4>
<p>Podemos calcular as proporções de cada categoria em relação ao total usando a função <code>count()</code> associada com a função <code>mutate()</code>. Vamos contar o número de carros para cada número de cilindros e, em seguida, calcular a proporção de cada contagem em relação ao total.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl  n proportion
1   4 11    0.34375
2   6  7    0.21875
3   8 14    0.43750</code></pre>
</div>
</div>
<p>Podemos facilmente transformar esses valores em percentuais ajustando o código anterior para multiplicar por 100.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl) <span class="sc">|&gt;</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))<span class="sc">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl  n proportion
1   4 11     34.375
2   6  7     21.875
3   8 14     43.750</code></pre>
</div>
</div>
<section id="renomeando-as-colunas-de-count" class="level5" data-number="12.4.2.4.1">
<h5 data-number="12.4.2.4.1" class="anchored" data-anchor-id="renomeando-as-colunas-de-count"><span class="header-section-number">12.4.2.4.1</span> Renomeando as colunas de count()</h5>
<p>Podemos facilmente contar o número de carros para cada número de cilindros e renomear as colunas de saída.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função count</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyl, <span class="at">name =</span> <span class="st">"numero de carros"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl numero de carros
1   4               11
2   6                7
3   8               14</code></pre>
</div>
</div>
</section>
</section>
<section id="contando-depois-de-filtrar-dados" class="level4" data-number="12.4.2.5">
<h4 data-number="12.4.2.5" class="anchored" data-anchor-id="contando-depois-de-filtrar-dados"><span class="header-section-number">12.4.2.5</span> Contando depois de filtrar dados</h4>
<p>Podemos combinar a função <code>count()</code> com a função <code>filter()</code> para contar o número de ocorrências de uma variável categórica após filtrar os dados. Vamos contar o número de carros para cada número de marchas (gear), mas somente para os carros com um peso (wt) menor que <code>4.0</code> (4.000 libras). Em seguida, ordenar o resultado por número de marchas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># necessário para usar a função filter e count</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wt <span class="sc">&lt;</span> <span class="fl">4.0</span>) <span class="sc">|&gt;</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(gear) <span class="sc">|&gt;</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  gear  n
1    3 11
2    4 12
3    5  5</code></pre>
</div>
</div>
<p>Os exemplos acima ilustram como a função <code>count()</code> do <code>dplyr</code> pode ser utilizada em situações mais complexas, combinando-a com outras funções para realizar filtragens, agrupamentos, transformações e ordenações. Isso demonstra a flexibilidade e poder do <code>dplyr</code> para manipulação de dados em R, tornando a análise mais eficiente e o código mais legível.</p>
</section>
</section>
</section>
<section id="trabalhando-com-dados-numéricos" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="trabalhando-com-dados-numéricos"><span class="header-section-number">12.5</span> Trabalhando com Dados Numéricos</h2>
<section id="estatística-descritiva-para-dados-numéricos" class="level3" data-number="12.5.1">
<h3 data-number="12.5.1" class="anchored" data-anchor-id="estatística-descritiva-para-dados-numéricos"><span class="header-section-number">12.5.1</span> Estatística Descritiva para dados numéricos</h3>
<p>Vamos examinar as principais funções do R para descrever numéricamente um conjunto de dados: as medidas de centralidade (media, mediana), de partição (percentis) e de dispersão (amplitude, variância e desvio padrão). Veremos como aplicar essas funções em vetores e em data frames ou <code>tibbles.</code></p>
<section id="medidas-de-centralidade" class="level4" data-number="12.5.1.1">
<h4 data-number="12.5.1.1" class="anchored" data-anchor-id="medidas-de-centralidade"><span class="header-section-number">12.5.1.1</span> Medidas de Centralidade</h4>
<p>As principais medidas de centralidade, ou posição, (média e mediana) são facilmente calculadas no R com as funções <code>mean()</code> e <code>median()</code>. Essa funções recebem valores numéricos como argumentos. Para exemplificar essas funções vamos usar novamente um vetor numérico simulando um conjunto de idades e pesos. Observe que no conjunto de pesos há uma dado faltante (NA). Podemos inserir tanto o próprio vetor isolado como argumento, como também uma coluna do data frame ou tibble como mostraremos adiante. nos próximos exemplos iremos usar geralmente a forma do tidyverse para calcular medidas estatísticas em variáveis de um data frame, usando o operador $ para acessarmos as colulnas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cria um conjunto de idades (anos)</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>idade <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">27</span>, <span class="dv">32</span>, <span class="dv">18</span>, <span class="dv">30</span>)</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cria um conjunto de pesos (kg)</span></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>peso  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">70</span>,  <span class="dv">6</span>,  <span class="dv">8</span>, <span class="dv">66</span>, <span class="dv">72</span>, <span class="dv">68</span>, <span class="cn">NA</span>)</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(idade, peso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a média aritmética da idade num vetor</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.85714</code></pre>
</div>
</div>
<p>Para calculara a média do peso, será necessário incluir o argumento <code>na.rm=TRUE</code>, pois a variável contem valores <code>NA</code>. Veja o resultado do cálculo com e sem esse argumento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a média do peso, sem retirar os NA (o R não consegue calcular)</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(peso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a média do peso, retirando os NA</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(peso, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48.33333</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a média do peso, retirando os NA, usando a tibble criada</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>peso, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48.33333</code></pre>
</div>
</div>
</section>
<section id="medidas-de-partição-e-posição" class="level4" data-number="12.5.1.2">
<h4 data-number="12.5.1.2" class="anchored" data-anchor-id="medidas-de-partição-e-posição"><span class="header-section-number">12.5.1.2</span> Medidas de Partição e Posição</h4>
<section id="máximo-e-mínimo" class="level5" data-number="12.5.1.2.1">
<h5 data-number="12.5.1.2.1" class="anchored" data-anchor-id="máximo-e-mínimo"><span class="header-section-number">12.5.1.2.1</span> Máximo e Mínimo</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a função min calcular o valor mínimo do conjunto numérico indicado como argumento</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(df<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a função max calcular o  o valor máximo do conjunto numérico indicado como argumento</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(df<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45</code></pre>
</div>
</div>
</section>
<section id="quantil-quartil-e-percentil" class="level5" data-number="12.5.1.2.2">
<h5 data-number="12.5.1.2.2" class="anchored" data-anchor-id="quantil-quartil-e-percentil"><span class="header-section-number">12.5.1.2.2</span> Quantil, quartil e percentil</h5>
<p>O percentil é uma medida de localização que divide uma amostra ordenada em 100 partes. Cada valor de percentil indica o percentual de dados abaixo daquele valor. Por exemplo, o percentil 25% indica o valor abaixo do qual estão 25% dos dados. Em estatística é usual usar-se o termo quantil ao invés de percentil. A diferença é que o quantil é escrito com valores decimais (0.25) e percentil com valores percentuais (25%). Os percentis (ou quantis) mais importantes são os de 25%, 50% e 75%, conhecidos, respectivamente, como 1º quartil, 2º quartil e 3º quartil, por dividirem a amostra dos dados em 4 partes iguais, cada uma com 1/4 (ou 25%) dos dados.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="11-Manipulating_data_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A função <code>quantile()</code> do R calcula todos esses quartis de uma só vez.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula os quartis 25% (1º), 50% (2º) e 75% (3º)</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(df<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0%  25%  50%  75% 100% 
  10   15   27   31   45 </code></pre>
</div>
</div>
<p>Podemos usar essa função para calcular individualmente o quantil desejado, bastando inserir esse valor como argumento logo depois da variável com os dados. Lembrando que é necessário usar o valor decimal e não o percentual (mais uma dica: lembre-se que no R o decimal é o ponto final e não a vírgula). Mais uma vez, se houver valores NA será necessário incluir o argumento na.rm=TRUE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(df<span class="sc">$</span>idade, <span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>25% 
 15 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(df<span class="sc">$</span>idade, <span class="fl">0.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 10% 
11.2 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(df<span class="sc">$</span>peso, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 25% 
22.5 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a função range retornao valor mínimo e máximo do conjunto numérico indicado como argumento</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(df<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10 45</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a função diff calcula a diferença entre os valores indicados como argumentos, nesse caso, a amplitude (máximo - mínimo) da idade</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span>(<span class="fu">range</span>(df<span class="sc">$</span>idade))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35</code></pre>
</div>
</div>
</section>
<section id="amplitude-interquartil" class="level5" data-number="12.5.1.2.3">
<h5 data-number="12.5.1.2.3" class="anchored" data-anchor-id="amplitude-interquartil"><span class="header-section-number">12.5.1.2.3</span> Amplitude interquartil</h5>
<p>A amplitude interquartil é uma medida de dispersão que mede a amplitude de 50% das observações centrais do conjunto. O primeiro e o terceiro quartis, respectivamente os percentis 25% e 75%, dividem a amostra de forma que 50% dos dados estão entre esses pontos. A amplitude desses dados centrais é conhecida como amplitude interquartil (interquartile range - IQR) e é uma medida de amplitude mais robusta que a amplitude, pois não é sensível aos valores extremos. Seu cálculo é simplesmente o valor do 3º quartil menos o valor do 1º quartil.</p>
<p>A amplitude interquartil é também conhecida pelos termos em inglês midspread, <strong>middle 50%</strong> ou <strong>H-spread</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcula a amplitude interquartil</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(df<span class="sc">$</span>idade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
</div>
</section>
</section>
<section id="medidas-de-dispersão" class="level4" data-number="12.5.1.3">
<h4 data-number="12.5.1.3" class="anchored" data-anchor-id="medidas-de-dispersão"><span class="header-section-number">12.5.1.3</span> Medidas de Dispersão</h4>
<section id="variância-e-desvio-padrão" class="level5" data-number="12.5.1.3.1">
<h5 data-number="12.5.1.3.1" class="anchored" data-anchor-id="variância-e-desvio-padrão"><span class="header-section-number">12.5.1.3.1</span> Variância e Desvio Padrão</h5>
<p>As funções do R para calcular a variância <code>var()</code> e desvio padrão <code>sd()</code> utilizam as fórmulas para a variância e desvio padrão com a correção de Bessel, feita para corrigir o viés da estimativa da variância e do desvio padrão, que tendem a subestimar a variabilidade da população quando calculados a partir de uma amostra. As funções <code>var()</code> e <code>sd()</code> utilizam no denominador os valores <code>n-1</code> e não <code>n</code>. Ou seja, as funções do R estão calculando a estimativa da variância da população a partir de uma amostra. Ou seja, essas funções assumem que os dados representam uma amostra da população e não a população inteira.</p>
<p>Quando for necessário estimar o desvio padrão ou variância levando em consideração apenas os elementos da amostra precisamos fazer um pequeno ajuste.</p>
<p>Vejamos isso nos próximos exemplos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um vetor de dados distribuidos de frorma normal com 100 elementos</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">100</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Variância com e sem a correção de Bessel</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a variância com a correção de bessel</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou seja, calculando a estimativa do variância da população a partir de uma amostra</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">var</span>(x) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8067621</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a variância sem a correção de bessel</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nesse caso precisamos multiplicar o resultado por (n-1)/n</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(x) <span class="sc">*</span> ((n<span class="dv">-1</span>)<span class="sc">/</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7986945</code></pre>
</div>
</div>
<p><strong>Desvio padrão com e sem a correção de Bessel</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando o desvio padrão com a correção de bessel</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ou seja, calculando a estimativa do desvio da população a partir de uma amostra</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8981994</code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando o desvio padrão sem a correção de bessel</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nesse caso precisamos multiplicar o resultado por sqrt((n-1)/n)</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">sd</span>(x) <span class="sc">*</span> <span class="fu">sqrt</span>((n<span class="dv">-1</span>)<span class="sc">/</span>n) <span class="co"># população</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8936971</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="agrupando-dados-numéricos" class="level3" data-number="12.5.2">
<h3 data-number="12.5.2" class="anchored" data-anchor-id="agrupando-dados-numéricos"><span class="header-section-number">12.5.2</span> Agrupando dados numéricos</h3>
<p>Frequentemente precisamos agrupar dados numéricos com base em variáveis categóricas. Por exemplo, quando desejamos separar as médias de uma determinada medida entre cada gênero, ou entre diferentes faixas etárias ou entre um grupo experimental e um grupo controle.</p>
<p>A linguagem R possui funções criadas especialmente para esse fim: a função <code>by()</code> do R base e a função <code>group_by()</code> do <code>tidyverse</code> são as mais importantes para essa finalidade.</p>
<p>A função <code>by()</code> do R base é usada para aplicar uma função a subconjuntos de um data frame, organizados por um fator ou combinação de fatores. Aqui estão algumas vantagens de usar <code>by()</code>:</p>
<ul>
<li><em>Simplicidade</em>: Uma solução base do R, sem necessidade de carregar pacotes adicionais.</li>
<li><em>Flexibilidade</em>: Pode ser usada com qualquer função que aceite data frames como input, o que permite operações complexas nos subconjuntos de dados.</li>
<li><em>Compatibilidade</em>: Por ser parte do R base, não depende de pacotes externos e é garantido funcionar em qualquer instalação do R.</li>
<li><em>Resulta em listas</em>: O output é uma lista, que pode ser útil para manipulações subsequentes.</li>
</ul>
<p>A função <code>group_by()</code> do pacote <code>dplyr</code>, que faz parte do <code>tidyverse</code>, é usada para agrupar dados em um data frame. Aqui estão algumas das vantagens de usar <code>group_by()</code>:</p>
<ul>
<li><em>Facilidade de uso</em>: A sintaxe é intuitiva e fácil de usar, especialmente quando combinada com outras funções do <code>dplyr</code> como <code>summarise</code>, <code>mutate</code>, etc.</li>
<li><em>Integração com a pipe</em> (|&gt;): Permite a construção de pipelines de manipulação de dados de maneira clara e legível.</li>
<li><em>Flexibilidade</em>: Pode ser usada com múltiplas colunas para criar grupos mais complexos.</li>
<li><em>Performance</em>: Otimizado para grandes conjuntos de dados, especialmente quando combinado com outras operações do <code>dplyr.</code></li>
<li><em>Compatibilidade</em>: Facilmente combinado com outros pacotes do <code>tidyverse</code>, como <code>ggplot2</code> para visualização de dados, <code>tidyr</code> para transformação, entre outros.</li>
</ul>
<p>A função <code>group_by()</code> é geralmente mais fácil de ler e entender, especialmente em pipelines de dados, se integra perfeitamente com outras funções do <code>tidyverse</code>, proporcionando uma maneira coesa e eficiente de manipulação de dados. Por outro lado, <code>by()</code> é útil quando não se deseja depender de pacotes externos e quando se trabalha em um ambiente onde a simplicidade é essencial. Ambas as funções têm suas vantagens e a escolha entre elas pode depender do contexto específico e das necessidades do seu projeto.</p>
<section id="agrupando-com-by" class="level4" data-number="12.5.2.1">
<h4 data-number="12.5.2.1" class="anchored" data-anchor-id="agrupando-com-by"><span class="header-section-number">12.5.2.1</span> Agrupando com <code>by()</code></h4>
<p>A função <code>by()</code> agrupa a variável desejada segundo alguma outra variável categórica. A função <code>by()</code> tem como argumentos:</p>
<ul>
<li>data: um objeto do R, geralmente um data frame ou <code>tibble</code>.<br>
</li>
<li>INDICES: uma variável categórica (factor) que define a separação dos grupos.<br>
</li>
<li>FUN: uma função a ser aplicada aos subconjuntos data frame.</li>
</ul>
<p>O dataset <code>mtcars</code> do R é um conjunto de dados sobre 32 carros de 1973-1974, com dados sobre 10 aspectos do design dos carros. Nesse dataset variável <code>am</code> representa a marcha do carro, sendo 0 = câmbio automático, 1 = câmbio manual. Podemos, portanto, aplicar a função <code>summary()</code> no dataset mtcars através da função <code>by()</code>, estratificando alguma variável de acordo com o tipo de câmbio (manual ou automático) e aplicando o comando em cada grupo.</p>
<p>Veja como fazer isso no código abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(<span class="at">data =</span>  mtcars, <span class="at">INDICES =</span>  mtcars<span class="sc">$</span>am, <span class="at">FUN =</span>   summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mtcars$am: 0
      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   :120.1   Min.   : 62.0  
 1st Qu.:14.95   1st Qu.:6.000   1st Qu.:196.3   1st Qu.:116.5  
 Median :17.30   Median :8.000   Median :275.8   Median :175.0  
 Mean   :17.15   Mean   :6.947   Mean   :290.4   Mean   :160.3  
 3rd Qu.:19.20   3rd Qu.:8.000   3rd Qu.:360.0   3rd Qu.:192.5  
 Max.   :24.40   Max.   :8.000   Max.   :472.0   Max.   :245.0  
      drat             wt             qsec             vs               am   
 Min.   :2.760   Min.   :2.465   Min.   :15.41   Min.   :0.0000   Min.   :0  
 1st Qu.:3.070   1st Qu.:3.438   1st Qu.:17.18   1st Qu.:0.0000   1st Qu.:0  
 Median :3.150   Median :3.520   Median :17.82   Median :0.0000   Median :0  
 Mean   :3.286   Mean   :3.769   Mean   :18.18   Mean   :0.3684   Mean   :0  
 3rd Qu.:3.695   3rd Qu.:3.842   3rd Qu.:19.17   3rd Qu.:1.0000   3rd Qu.:0  
 Max.   :3.920   Max.   :5.424   Max.   :22.90   Max.   :1.0000   Max.   :0  
      gear            carb      
 Min.   :3.000   Min.   :1.000  
 1st Qu.:3.000   1st Qu.:2.000  
 Median :3.000   Median :3.000  
 Mean   :3.211   Mean   :2.737  
 3rd Qu.:3.000   3rd Qu.:4.000  
 Max.   :4.000   Max.   :4.000  
------------------------------------------------------------ 
mtcars$am: 1
      mpg             cyl             disp             hp             drat     
 Min.   :15.00   Min.   :4.000   Min.   : 71.1   Min.   : 52.0   Min.   :3.54  
 1st Qu.:21.00   1st Qu.:4.000   1st Qu.: 79.0   1st Qu.: 66.0   1st Qu.:3.85  
 Median :22.80   Median :4.000   Median :120.3   Median :109.0   Median :4.08  
 Mean   :24.39   Mean   :5.077   Mean   :143.5   Mean   :126.8   Mean   :4.05  
 3rd Qu.:30.40   3rd Qu.:6.000   3rd Qu.:160.0   3rd Qu.:113.0   3rd Qu.:4.22  
 Max.   :33.90   Max.   :8.000   Max.   :351.0   Max.   :335.0   Max.   :4.93  
       wt             qsec             vs               am         gear      
 Min.   :1.513   Min.   :14.50   Min.   :0.0000   Min.   :1   Min.   :4.000  
 1st Qu.:1.935   1st Qu.:16.46   1st Qu.:0.0000   1st Qu.:1   1st Qu.:4.000  
 Median :2.320   Median :17.02   Median :1.0000   Median :1   Median :4.000  
 Mean   :2.411   Mean   :17.36   Mean   :0.5385   Mean   :1   Mean   :4.385  
 3rd Qu.:2.780   3rd Qu.:18.61   3rd Qu.:1.0000   3rd Qu.:1   3rd Qu.:5.000  
 Max.   :3.570   Max.   :19.90   Max.   :1.0000   Max.   :1   Max.   :5.000  
      carb      
 Min.   :1.000  
 1st Qu.:1.000  
 Median :2.000  
 Mean   :2.923  
 3rd Qu.:4.000  
 Max.   :8.000  </code></pre>
</div>
</div>
<p>Podemos usar a função by inserindo os argumentos na ordem, sem necessidade de explicitar o que é cada um, como feito a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(mtcars, mtcars<span class="sc">$</span>am, summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mtcars$am: 0
      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   :120.1   Min.   : 62.0  
 1st Qu.:14.95   1st Qu.:6.000   1st Qu.:196.3   1st Qu.:116.5  
 Median :17.30   Median :8.000   Median :275.8   Median :175.0  
 Mean   :17.15   Mean   :6.947   Mean   :290.4   Mean   :160.3  
 3rd Qu.:19.20   3rd Qu.:8.000   3rd Qu.:360.0   3rd Qu.:192.5  
 Max.   :24.40   Max.   :8.000   Max.   :472.0   Max.   :245.0  
      drat             wt             qsec             vs               am   
 Min.   :2.760   Min.   :2.465   Min.   :15.41   Min.   :0.0000   Min.   :0  
 1st Qu.:3.070   1st Qu.:3.438   1st Qu.:17.18   1st Qu.:0.0000   1st Qu.:0  
 Median :3.150   Median :3.520   Median :17.82   Median :0.0000   Median :0  
 Mean   :3.286   Mean   :3.769   Mean   :18.18   Mean   :0.3684   Mean   :0  
 3rd Qu.:3.695   3rd Qu.:3.842   3rd Qu.:19.17   3rd Qu.:1.0000   3rd Qu.:0  
 Max.   :3.920   Max.   :5.424   Max.   :22.90   Max.   :1.0000   Max.   :0  
      gear            carb      
 Min.   :3.000   Min.   :1.000  
 1st Qu.:3.000   1st Qu.:2.000  
 Median :3.000   Median :3.000  
 Mean   :3.211   Mean   :2.737  
 3rd Qu.:3.000   3rd Qu.:4.000  
 Max.   :4.000   Max.   :4.000  
------------------------------------------------------------ 
mtcars$am: 1
      mpg             cyl             disp             hp             drat     
 Min.   :15.00   Min.   :4.000   Min.   : 71.1   Min.   : 52.0   Min.   :3.54  
 1st Qu.:21.00   1st Qu.:4.000   1st Qu.: 79.0   1st Qu.: 66.0   1st Qu.:3.85  
 Median :22.80   Median :4.000   Median :120.3   Median :109.0   Median :4.08  
 Mean   :24.39   Mean   :5.077   Mean   :143.5   Mean   :126.8   Mean   :4.05  
 3rd Qu.:30.40   3rd Qu.:6.000   3rd Qu.:160.0   3rd Qu.:113.0   3rd Qu.:4.22  
 Max.   :33.90   Max.   :8.000   Max.   :351.0   Max.   :335.0   Max.   :4.93  
       wt             qsec             vs               am         gear      
 Min.   :1.513   Min.   :14.50   Min.   :0.0000   Min.   :1   Min.   :4.000  
 1st Qu.:1.935   1st Qu.:16.46   1st Qu.:0.0000   1st Qu.:1   1st Qu.:4.000  
 Median :2.320   Median :17.02   Median :1.0000   Median :1   Median :4.000  
 Mean   :2.411   Mean   :17.36   Mean   :0.5385   Mean   :1   Mean   :4.385  
 3rd Qu.:2.780   3rd Qu.:18.61   3rd Qu.:1.0000   3rd Qu.:1   3rd Qu.:5.000  
 Max.   :3.570   Max.   :19.90   Max.   :1.0000   Max.   :1   Max.   :5.000  
      carb      
 Min.   :1.000  
 1st Qu.:1.000  
 Median :2.000  
 Mean   :2.923  
 3rd Qu.:4.000  
 Max.   :8.000  </code></pre>
</div>
</div>
<p>Como os valores dessa <code>am</code> variável são números (<code>0</code> e <code>1</code>), o R os interpreta como numéricos. O mesmo acontece nas variáveis <code>cyl</code>, <code>am</code>, <code>vs</code>, <code>gear</code> e <code>carb</code>, que na verdade são categóricas. A tabela abaixo descreve as variáveis desse conjunto de dados.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mtcars.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">mtcars dictionary</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Vamos verificar como essas variáveis estão sendo interpretadas no R usando a função <code>str()</code>, que verifica a estrutura dos dados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<p>Observe que <code>cyl</code>, <code>am</code>, <code>vs</code>, <code>gear</code> e <code>carb</code> foram interpretadas como numéricas. Nesse caso, a função <code>summary()</code> irá erroneamente calcular medidas numéricas nas nessas variáveis, que na verdade são categóricas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5  
 Median :19.20   Median :6.000   Median :196.3   Median :123.0  
 Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0  
      drat             wt             qsec             vs        
 Min.   :2.760   Min.   :1.513   Min.   :14.50   Min.   :0.0000  
 1st Qu.:3.080   1st Qu.:2.581   1st Qu.:16.89   1st Qu.:0.0000  
 Median :3.695   Median :3.325   Median :17.71   Median :0.0000  
 Mean   :3.597   Mean   :3.217   Mean   :17.85   Mean   :0.4375  
 3rd Qu.:3.920   3rd Qu.:3.610   3rd Qu.:18.90   3rd Qu.:1.0000  
 Max.   :4.930   Max.   :5.424   Max.   :22.90   Max.   :1.0000  
       am              gear            carb      
 Min.   :0.0000   Min.   :3.000   Min.   :1.000  
 1st Qu.:0.0000   1st Qu.:3.000   1st Qu.:2.000  
 Median :0.0000   Median :4.000   Median :2.000  
 Mean   :0.4062   Mean   :3.688   Mean   :2.812  
 3rd Qu.:1.0000   3rd Qu.:4.000   3rd Qu.:4.000  
 Max.   :1.0000   Max.   :5.000   Max.   :8.000  </code></pre>
</div>
</div>
<p>Para resolver esse problema precisamos informar ao R que as variáveis <code>cyl</code>, <code>am</code>, <code>vs</code>, <code>gear</code> e <code>carb</code> são categóricas com a função <code>as.factor()</code> como mostrado a seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>cyl  <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am   <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>am)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>vs   <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>vs)</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>gear)</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>carb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora a função <code>summary()</code> irá corretamente fazer as tabelas, pois já estão configuradas como sendo categóricas. Podemos ver no código abaixo que existem 19 carros com cambio automático (am=0), e 13 carros com cambio manual (am=1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg        cyl         disp             hp             drat      
 Min.   :10.40   4:11   Min.   : 71.1   Min.   : 52.0   Min.   :2.760  
 1st Qu.:15.43   6: 7   1st Qu.:120.8   1st Qu.: 96.5   1st Qu.:3.080  
 Median :19.20   8:14   Median :196.3   Median :123.0   Median :3.695  
 Mean   :20.09          Mean   :230.7   Mean   :146.7   Mean   :3.597  
 3rd Qu.:22.80          3rd Qu.:326.0   3rd Qu.:180.0   3rd Qu.:3.920  
 Max.   :33.90          Max.   :472.0   Max.   :335.0   Max.   :4.930  
       wt             qsec       vs     am     gear   carb  
 Min.   :1.513   Min.   :14.50   0:18   0:19   3:15   1: 7  
 1st Qu.:2.581   1st Qu.:16.89   1:14   1:13   4:12   2:10  
 Median :3.325   Median :17.71                 5: 5   3: 3  
 Mean   :3.217   Mean   :17.85                        4:10  
 3rd Qu.:3.610   3rd Qu.:18.90                        6: 1  
 Max.   :5.424   Max.   :22.90                        8: 1  </code></pre>
</div>
</div>
<p>Veja que essa função resolve muitas de nossas necessidades no processo de análise de dados, porém, como já dito, é comum que uma variável categórica seja codificada com números, nesse caso, temos de fazer o ajuste antes de usar a função <code>summary()</code>, como fizemos antes de usar a função <code>summary()</code> com o dataset <code>mtcars</code> em seções anteriores.</p>
</section>
<section id="agrupando-com-group_by" class="level4" data-number="12.5.2.2">
<h4 data-number="12.5.2.2" class="anchored" data-anchor-id="agrupando-com-group_by"><span class="header-section-number">12.5.2.2</span> Agrupando com <code>group_by()</code></h4>
<p>Vamos usar a função <code>group_by()</code> para separar grupos antes de calcular alguma medida estatística. Como exemplo, vamos comparar de níveis de glicose entre grupos com diferentes hábitos de exercício. Para isso precisaremos agrupar os dados numéricos dos níveis de glicose com base nas categorias de exercício (ex: Sedentário, Moderado, Intenso). Para isso será preciso carregar o pacote <code>dplyr.</code> Iremos também usar uma variável para armazenar os dados para análise e usar o operador pipe para melhorar a estética do código.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o pacote dplyr e tibble</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o data frame com 15 pacientes</span></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">paciente =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">exercicio =</span> <span class="fu">c</span>(<span class="st">"Sedentário"</span>, <span class="st">"Moderado"</span>, <span class="st">"Intenso"</span>, </span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Moderado"</span>, <span class="st">"Sedentário"</span>, <span class="st">"Intenso"</span>, </span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Sedentário"</span>, <span class="st">"Moderado"</span>, <span class="st">"Intenso"</span>, </span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Moderado"</span>, <span class="st">"Sedentário"</span>, <span class="st">"Intenso"</span>, </span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"Sedentário"</span>, <span class="st">"Moderado"</span>, <span class="st">"Intenso"</span>),</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">nivel_glicose =</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">130</span>, <span class="dv">110</span>, <span class="dv">140</span>, <span class="dv">160</span>, <span class="dv">100</span>, </span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">155</span>, <span class="dv">135</span>, <span class="dv">115</span>, <span class="dv">145</span>, <span class="dv">165</span>, <span class="dv">105</span>, </span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">158</span>, <span class="dv">138</span>, <span class="dv">112</span>))</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
   paciente exercicio  nivel_glicose
      &lt;int&gt; &lt;chr&gt;              &lt;dbl&gt;
 1        1 Sedentário           150
 2        2 Moderado             130
 3        3 Intenso              110
 4        4 Moderado             140
 5        5 Sedentário           160
 6        6 Intenso              100
 7        7 Sedentário           155
 8        8 Moderado             135
 9        9 Intenso              115
10       10 Moderado             145
11       11 Sedentário           165
12       12 Intenso              105
13       13 Sedentário           158
14       14 Moderado             138
15       15 Intenso              112</code></pre>
</div>
</div>
<p>Agora vamos usar a função <code>group_by()</code> para calcular a média dos níveis de glicose por grupo de exercício. ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando group_by() para calcular a média dos níveis de glicose por grupo de exercício</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>result_exercicio <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(exercicio) <span class="sc">|&gt;</span></span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_glicose =</span> <span class="fu">mean</span>(nivel_glicose))</span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result_exercicio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  exercicio  mean_glicose
  &lt;chr&gt;             &lt;dbl&gt;
1 Intenso            108.
2 Moderado           138.
3 Sedentário         158.</code></pre>
</div>
<p>:::</p>
<p>Vamos tentar analisar novamente o dataset <code>mtcars</code>, mas agora usando a função <code>group_by()</code> do <code>dplyr.</code> ::: {.cell}</p>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar o pacote dplyr</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar o dataset mtcars</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estratificar os dados segundo a variável "am" e calcular estatísticas resumidas</span></span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>mtcars_analysis <span class="ot">&lt;-</span> mtcars <span class="sc">|&gt;</span></span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(am) <span class="sc">|&gt;</span></span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mpg =</span> <span class="fu">mean</span>(mpg),          <span class="co"># Média de milhas por galão</span></span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_hp =</span> <span class="fu">mean</span>(hp),            <span class="co"># Média de potência</span></span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_wt =</span> <span class="fu">mean</span>(wt),            <span class="co"># Média de peso</span></span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_qsec =</span> <span class="fu">mean</span>(qsec),        <span class="co"># Média de tempo no quarto de milha</span></span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">count =</span> <span class="fu">n</span>())                   <span class="co"># Contagem de carros em cada grupo</span></span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-16"><a href="#cb279-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Exibir o resultado</span></span>
<span id="cb279-17"><a href="#cb279-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mtcars_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
     am mean_mpg mean_hp mean_wt mean_qsec count
  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
1     0     17.1    160.    3.77      18.2    19
2     1     24.4    127.    2.41      17.4    13</code></pre>
</div>
<p>:::</p>
<p>O código acima agrupou diversos dados segundo o tipo de transmissão (transmissão: 0 = automática, 1 = manual) usando <code>group_by()</code> e em seguida usou a função <code>summarise()</code> para calcular diversas medidas em cada grupo:</p>
<ul>
<li>mean_mpg: Média de milhas por galão (mpg).</li>
<li>mean_hp: Média de potência (hp).</li>
<li>mean_wt: Média de peso (wt).</li>
<li>mean_qsec: Média de tempo no quarto de milha (qsec).</li>
<li>count: Contagem de carros em cada grupo.</li>
</ul>
<section id="resumindo-numericamente-os-dados" class="level5" data-number="12.5.2.2.1">
<h5 data-number="12.5.2.2.1" class="anchored" data-anchor-id="resumindo-numericamente-os-dados"><span class="header-section-number">12.5.2.2.1</span> Resumindo numericamente os dados:</h5>
<p>As funções <code>summary()</code> do R base e <code>summarise()</code> ou <code>summarize()</code> do pacote <code>dplyr</code> servem para resumir um conjunto de dados.</p>
<p>A diferença nas funções <code>summarise()</code> ou <code>summarize()</code> do <code>dplyr</code> precisamos especificar quais medidas estatísticas serão calculadas. Apesar de dar um trabalho a mais escrever o código, você tem muito mais flexibilidade, podendo criar um novo dataframe com qualquer medida de interesse.</p>
<p>Outro ponto importante é que a função <code>summary()</code> do R retorna um objeto do tipo <code>tabela</code>, enquanto as funções <code>summarise()</code> ou <code>summarize()</code> do pacote <code>dplyr</code> retornam um objeto do tipo <code>data frame</code>, que é muito mais flexivel de usar e extrair dados do que uma tabela.</p>
<p>Para verificar novamente como usar essa função veja o capítulo sobre o pacote <code>dplyr</code> (<span class="quarto-unresolved-ref">?sec-dply</span>).</p>
</section>
</section>
</section>
<section id="categorizando-variáveis-numéricas" class="level3" data-number="12.5.3">
<h3 data-number="12.5.3" class="anchored" data-anchor-id="categorizando-variáveis-numéricas"><span class="header-section-number">12.5.3</span> Categorizando variáveis numéricas</h3>
<section id="categorizando-com-a-função-cut" class="level4" data-number="12.5.3.1">
<h4 data-number="12.5.3.1" class="anchored" data-anchor-id="categorizando-com-a-função-cut"><span class="header-section-number">12.5.3.1</span> Categorizando com a função <code>cut( )</code></h4>
<p>A função <code>cut()</code> nos permite criar uma variável categórica a partir de uma variável numérica. A forma dessa função é:</p>
<blockquote class="blockquote">
<p>cut(variável, breaks=c(-Inf, x1, x2, Inf), labels=c(“label”, “label”, “label”))</p>
</blockquote>
<p>Veja que o parâmetro breaks pode usar <code>-Inf</code> como limite inferior e <code>Inf</code> como limite superior. Entre esses limites extremos serão definidos os pontos de corte. Podemos colocar quantos pontos desejarmos, mas é sempre prudente evitar excessos.</p>
<p>Veja também que com 2 pontos intermediários serão criados 3 categorias. Por padrão os intervalos são do abertos à esquerda e fechados à direita, tal como em (x1, x2]. De tal forma que o intervalo termina no valores indicados, incluindo esse valor.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/cut1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Cut</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Vamos continuar usando o dataset <code>mpg</code>. Para exemplificar o uso da função <code>cut()</code> vamos criar uma variável categórica <code>cty_cat</code> a partir <code>cty</code> (milhas percorridas na estrada com 1 galão de combustível). A variável <code>cty</code> é numérica, com valores variando de 9 milhas a 35 milhas. Vamos definir 3 categorias de carros:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/cut2.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Cut</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Como o limite superior do intervalo é aberto, o valor desse ponto de corte será parte da 1º categoria, portanto, o primeiro ponto de corte deve ser 15, já que definimos o primeiro intervalo como menor ou igual a 15. O segundo ponto de corte será 20, pois será o limite superior da segunda categoria é menor ou igual a 20. O código ficará então:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># necessário para usar o dataset mpg</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mpg) <span class="co"># carregando o dataset mpg na memória</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>cty_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(mpg<span class="sc">$</span>cty,</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="cn">Inf</span>),</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>, <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora o data frame mpg contém uma nova variável categórica denominada <code>cty_cat</code> com 3 níveis, o que podemos verificar com a função <code>class()</code> e <code>unique()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<p>Entretanto, ainda falta um pequeno detalhe. A variável criada deveria ser ordenada, mas foi criada como sendo uma variável nominal. Por padrão o R cria uma variável categórica nominal com a função <code>cut()</code>. Para indicar que desejamos que a nova variável seja ordenada devemos modificar o parâmetro <code>ordered_result</code> para TRUE (<code>ordered_result = TRUE</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>cty_cat <span class="ot">&lt;-</span> <span class="fu">cut</span>(mpg<span class="sc">$</span>cty,                  </span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="cn">Inf</span>),                  </span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>, <span class="st">"2"</span>),                  </span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ordered_result =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos verificar agora que a variável <code>cty_cat( )</code> é ordenada e qual a ordenação.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ordered" "factor" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 0
Levels: 0 &lt; 1 &lt; 2</code></pre>
</div>
</div>
<p>Observe que apesar dos valores da variável <code>cty_cat</code> serem 0, 1 e 2, essa variável é uma variável categórica e esses valores não representam números no R. Poderíamos muito tem ter nomeado essas categorias de A, B e C ou usar a função <code>fct_recode()</code> do pacote <code>forcats</code> para tornar esses dados mais compreensíveis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cty_cat =</span> <span class="fu">fct_recode</span>(cty_cat,</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"0 a 15 milhas com um galão"</span> <span class="ot">=</span> <span class="st">"0"</span>,</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"15 a 30 milhas com um galão"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Mais de 30 Milhas com um galão"</span> <span class="ot">=</span> <span class="st">"2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos agora criar uma tabela mais fácil de compreender com a função <code>table()</code> do R como mostrado abaixo. Observe que usamos como argumento da função <code>table()</code> o dataset <code>mpg</code> seguido do operador <code>$</code> para selecionar a coluna com a variável <code>cty_cat</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0 a 15 milhas com um galão    15 a 30 milhas com um galão 
                            97                             92 
Mais de 30 Milhas com um galão 
                            45 </code></pre>
</div>
</div>
<p>Mas podemos melhorar ainda mais esse código usando a função <code>count()</code> do <code>dplyr</code> já tratada em capítulos anteriores (<a href="#sec-count"><span>Section&nbsp;12.2.13</span></a>) e usando o operador pipe.</p>
<p>Veja que no código abaixo começamos com o dataset <code>mpg</code>, seguido do operador pipe para <em>passar</em> esse datase para a função <code>count()</code>. E inserimos como argumento da função <code>count()</code> o nome da variável categórica a ser usada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> <span class="fu">count</span>(cty_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  cty_cat                            n
  &lt;ord&gt;                          &lt;int&gt;
1 0 a 15 milhas com um galão        97
2 15 a 30 milhas com um galão       92
3 Mais de 30 Milhas com um galão    45</code></pre>
</div>
</div>
</section>
<section id="categorizando-com-a-função-ifelse" class="level4" data-number="12.5.3.2">
<h4 data-number="12.5.3.2" class="anchored" data-anchor-id="categorizando-com-a-função-ifelse"><span class="header-section-number">12.5.3.2</span> Categorizando com a função <code>ifelse( )</code></h4>
<p>Às vezes precisamos criar uma variável categórica com apenas dois valores a partir de uma variável numérica. Nesse caso, para criar uma variável dicotômica a partir de uma variável numérica a função <code>ifelse()</code> é mais simples de usar.</p>
<p>Para exemplificar vamos criar uma nova variável categoria denominada de <code>hwy_cat</code> a partir da variável <code>hwy</code> (milhas percorridas com um galão na estrada). Iremos definir como <code>BEBE MUITO</code> os carros que fizerem menos de 20 milhas na estrada e como <code>ECONOMICO</code> os outros.</p>
<p>A função ifelse tem o seguinte formato: &gt; ifelse(condição, rótulo.da.condição.verdadeira, rótulo.da.condição.falsa)</p>
<blockquote class="blockquote">
<p>O código fica então da seguinte maneira Condição: Testa se valor da variável hwy é menor que 20. Quando a condição for verdadeira, - o rótulo será o primeiro (“BEBEMUITO”), - se não o rótulo será o seguinte (“ECONOMICO”).</p>
</blockquote>
<p>O código acima na liguagem R é o seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>hwy_cat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mpg<span class="sc">$</span>hwy<span class="sc">&lt;</span><span class="dv">20</span>, <span class="st">"BEBEMUITO"</span>, <span class="st">"ECONOMICO"</span>)</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>hwy_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
BEBEMUITO ECONOMICO 
       78       156 </code></pre>
</div>
</div>
<p>Em sua forma mais simples poderíamos ter escrito:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>hwy_cat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mpg<span class="sc">$</span>hwy<span class="sc">&lt;</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>hwy_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
 78 156 </code></pre>
</div>
</div>
<p>Entretanto, cuidado, dessa última forma a variável criada será identificada no R como sendo numérica. Para indicar que a variável criada não é numérica coloque os rótulos entre aspas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>hwy_cat <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(mpg<span class="sc">$</span>hwy<span class="sc">&lt;</span><span class="dv">20</span>, <span class="st">"0"</span>, <span class="st">"1"</span>)</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>hwy_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
 78 156 </code></pre>
</div>
</div>
<p>De qualquer forma, no R a função ifelse não gera variáveis categóricas, para isso deveremos explicitamente indicar que desejamos que a nova variável seja categórica com a função <code>as.factor()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>mpg<span class="sc">$</span>hwy_cat <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(mpg<span class="sc">$</span>hwy<span class="sc">&lt;</span><span class="dv">20</span>, <span class="st">"BEBEMUITO"</span>, <span class="st">"ECONOMICO"</span>))</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mpg<span class="sc">$</span>hwy_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
BEBEMUITO ECONOMICO 
       78       156 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="resumindo-dados" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="resumindo-dados"><span class="header-section-number">12.6</span> Resumindo dados</h2>
<p>Resumir dados é uma tarefa muito comum em análise de dados. Podemos resumir dados de várias formas, como por exemplo, calculando medidas de tendência central, medidas de dispersão, tabelas de frequência, etc.</p>
<p>O R possui diversas funções para resumir dados. As funções <code>summarise()</code> ou <code>summarize()</code> do pacote <code>dplyr</code> são sinônimas e servem para criar um novo dataframe com informações resumidas, ou seja, estatísticas de um conjunto de dados. A diferença entre essas funções e a função <code>summary</code> do R é que precisamos especificar quais medidas estatísticas serão calculadas. Apesar de dar um trabalho a mais escrever o código, você tem muito mais flexibilidade, podendo criar um novo dataframe com qualquer medida de interesse.</p>
<p>O pacote <code>skimr</code> possui também algumas funções interessantes para resumir dados. A função <code>skim()</code> é uma delas. Ela fornece um resumo estatístico de um conjunto de dados, incluindo medidas de tendência central, dispersão, distribuição e muito mais. A função <code>skim()</code> é útil para obter uma visão geral rápida dos dados e identificar possíveis problemas ou padrões. Lembre-se que para usar essa funcção é necessário que você já tenha instalado o pacote skimr. Se ainda não tiver feito isso, use o comando <code>install.packages("skimr")</code> para instalar o pacote. Depois será necessário usar o comando <code>library(skimr)</code> para carregar esse pacote.</p>
<p>do pacote <code>psych</code> possui a função <code>describe()</code> que fornece um resumo estatístico de um conjunto de dados, incluindo medidas de tendência central, dispersão, distribuição e muito mais. A função <code>describe()</code> é útil para obter uma visão geral rápida dos dados e identificar possíveis problemas ou padrões. Lembre-se que para usar essa funcção é necessário que você já tenha instalado o pacote psych. Se ainda não tiver feito isso, use o comando <code>install.packages("psych")</code> para instalar o pacote. Depois será necessário usar o comando <code>library(psych)</code> para carregar esse pacote.</p>
<section id="resumindo-dados-com-summary" class="level3" data-number="12.6.1">
<h3 data-number="12.6.1" class="anchored" data-anchor-id="resumindo-dados-com-summary"><span class="header-section-number">12.6.1</span> Resumindo dados com <code>summary()</code></h3>
<p>Podemos resumir um conjunto de dados com a função <code>summary()</code>. O argumento dessa função é um data frame.</p>
<p>Essa função cria tabelas de todas as variáveis categóricas de um conjunto de dados de uma só vez e também calcula as medidas de mínimo, máximo, media, mediana e quartis de medidas numéricas.</p>
<p>Veja essa função aplicada no dataset <code>esoph</code> do R, que contém dados de um estudo de caso controle de câncer de esôfago na frança.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(esoph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   88 obs. of  5 variables:
 $ agegp    : Ord.factor w/ 6 levels "25-34"&lt;"35-44"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...
 $ alcgp    : Ord.factor w/ 4 levels "0-39g/day"&lt;"40-79"&lt;..: 1 1 1 1 2 2 2 2 3 3 ...
 $ tobgp    : Ord.factor w/ 4 levels "0-9g/day"&lt;"10-19"&lt;..: 1 2 3 4 1 2 3 4 1 2 ...
 $ ncases   : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ncontrols: num  40 10 6 5 27 7 4 7 2 1 ...</code></pre>
</div>
</div>
<p>Podemos ver acima que o dataset espoa contém 5 variáveis, 3 delas categóricas ordinais (chamadas no R de Ordered factor) e 2 numéricas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(esoph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   agegp          alcgp         tobgp        ncases         ncontrols     
 25-34:15   0-39g/day:23   0-9g/day:24   Min.   : 0.000   Min.   : 0.000  
 35-44:15   40-79    :23   10-19   :24   1st Qu.: 0.000   1st Qu.: 1.000  
 45-54:16   80-119   :21   20-29   :20   Median : 1.000   Median : 4.000  
 55-64:16   120+     :21   30+     :20   Mean   : 2.273   Mean   : 8.807  
 65-74:15                                3rd Qu.: 4.000   3rd Qu.:10.000  
 75+  :11                                Max.   :17.000   Max.   :60.000  </code></pre>
</div>
</div>
<p>Veja que a função <code>summary()</code> cria tabelas para as variáveis categóricas e calcula várias medidas estatísticas para as variáveis numéricas.</p>
<p>Poderíamos também tabular essas variáveis com a função <code>table()</code> como mostrado abaixo, para cada variável categórica separadamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(esoph<span class="sc">$</span>agegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
25-34 35-44 45-54 55-64 65-74   75+ 
   15    15    16    16    15    11 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(esoph<span class="sc">$</span>alcgp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
0-39g/day     40-79    80-119      120+ 
       23        23        21        21 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(esoph<span class="sc">$</span>tobgp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
0-9g/day    10-19    20-29      30+ 
      24       24       20       20 </code></pre>
</div>
</div>
<p>Frequentemente variáveis categóricas são representadas por algum valor numérico. Por exemplo, em muitas pesquisas o sexo masculino pode ser representado por <code>0</code> e o feminino por <code>1</code>. Nesses casos a variável sexo poderá ser erroneamente interpretada no R como numérica, quando na verdade é categórica.</p>
<p>Veja por exemplo o data frame <code>mtcars</code> no qual a variável <code>am</code> representa a marcha do carro, sendo 0 = câmbio automático, 1 = câmbio manual. Como os valores dessa variável são números (<code>0</code> e <code>1</code>), o R os interpreta como numéricos. O mesmo acontece na variável <code>vs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  11 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...
 $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
 $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
 $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
 $ qsec: num  16.5 17 18.6 19.4 17 ...
 $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
 $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
 $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
 $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</div>
</div>
<p>Nesse caso, a função <code>summary()</code> irá erroneamente calcular medidas numéricas nas variáveis <code>am</code> e <code>vs</code>, que na verdade são categóricas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5  
 Median :19.20   Median :6.000   Median :196.3   Median :123.0  
 Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0  
      drat             wt             qsec             vs        
 Min.   :2.760   Min.   :1.513   Min.   :14.50   Min.   :0.0000  
 1st Qu.:3.080   1st Qu.:2.581   1st Qu.:16.89   1st Qu.:0.0000  
 Median :3.695   Median :3.325   Median :17.71   Median :0.0000  
 Mean   :3.597   Mean   :3.217   Mean   :17.85   Mean   :0.4375  
 3rd Qu.:3.920   3rd Qu.:3.610   3rd Qu.:18.90   3rd Qu.:1.0000  
 Max.   :4.930   Max.   :5.424   Max.   :22.90   Max.   :1.0000  
       am              gear            carb      
 Min.   :0.0000   Min.   :3.000   Min.   :1.000  
 1st Qu.:0.0000   1st Qu.:3.000   1st Qu.:2.000  
 Median :0.0000   Median :4.000   Median :2.000  
 Mean   :0.4062   Mean   :3.688   Mean   :2.812  
 3rd Qu.:1.0000   3rd Qu.:4.000   3rd Qu.:4.000  
 Max.   :1.0000   Max.   :5.000   Max.   :8.000  </code></pre>
</div>
</div>
<p>Para resolver esse problema basta informar ao R que essas variáveis são categóricas com a função <code>as.factor()</code> como mostrado a seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>am)</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>vs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora a função <code>summary()</code> irá corretamente fazer as tabelas das variáveis <code>vs</code> e <code>am</code>, pois já estão configuradas como sendo categóricas. Podemos ver no código abaixo que existem 19 carros com cambio automático (am=0), e 13 carros com cambio manual (am=1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5  
 Median :19.20   Median :6.000   Median :196.3   Median :123.0  
 Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0  
      drat             wt             qsec       vs     am          gear      
 Min.   :2.760   Min.   :1.513   Min.   :14.50   0:18   0:19   Min.   :3.000  
 1st Qu.:3.080   1st Qu.:2.581   1st Qu.:16.89   1:14   1:13   1st Qu.:3.000  
 Median :3.695   Median :3.325   Median :17.71                 Median :4.000  
 Mean   :3.597   Mean   :3.217   Mean   :17.85                 Mean   :3.688  
 3rd Qu.:3.920   3rd Qu.:3.610   3rd Qu.:18.90                 3rd Qu.:4.000  
 Max.   :4.930   Max.   :5.424   Max.   :22.90                 Max.   :5.000  
      carb      
 Min.   :1.000  
 1st Qu.:2.000  
 Median :2.000  
 Mean   :2.812  
 3rd Qu.:4.000  
 Max.   :8.000  </code></pre>
</div>
</div>
<p>Vejamos alguns outros exemplos dessa funcão aplicada a alguns outros data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(USArrests)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Murder          Assault         UrbanPop          Rape      
 Min.   : 0.800   Min.   : 45.0   Min.   :32.00   Min.   : 7.30  
 1st Qu.: 4.075   1st Qu.:109.0   1st Qu.:54.50   1st Qu.:15.07  
 Median : 7.250   Median :159.0   Median :66.00   Median :20.10  
 Mean   : 7.788   Mean   :170.8   Mean   :65.54   Mean   :21.23  
 3rd Qu.:11.250   3rd Qu.:249.0   3rd Qu.:77.75   3rd Qu.:26.18  
 Max.   :17.400   Max.   :337.0   Max.   :91.00   Max.   :46.00  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> manufacturer          model               displ            year     
 Length:234         Length:234         Min.   :1.600   Min.   :1999  
 Class :character   Class :character   1st Qu.:2.400   1st Qu.:1999  
 Mode  :character   Mode  :character   Median :3.300   Median :2004  
                                       Mean   :3.472   Mean   :2004  
                                       3rd Qu.:4.600   3rd Qu.:2008  
                                       Max.   :7.000   Max.   :2008  
      cyl           trans               drv                 cty       
 Min.   :4.000   Length:234         Length:234         Min.   : 9.00  
 1st Qu.:4.000   Class :character   Class :character   1st Qu.:14.00  
 Median :6.000   Mode  :character   Mode  :character   Median :17.00  
 Mean   :5.889                                         Mean   :16.86  
 3rd Qu.:8.000                                         3rd Qu.:19.00  
 Max.   :8.000                                         Max.   :35.00  
      hwy             fl               class          
 Min.   :12.00   Length:234         Length:234        
 1st Qu.:18.00   Class :character   Class :character  
 Median :24.00   Mode  :character   Mode  :character  
 Mean   :23.44                                        
 3rd Qu.:27.00                                        
 Max.   :44.00                                        
                           cty_cat        hwy_cat   
 0 a 15 milhas com um galão    :97   BEBEMUITO: 78  
 15 a 30 milhas com um galão   :92   ECONOMICO:156  
 Mais de 30 Milhas com um galão:45                  
                                                    
                                                    
                                                    </code></pre>
</div>
</div>
<p>Veja que essa função resolve muitas de nossas necessidades no processo de análise de dados, porém, como já dito, é comum que uma variável categórica seja codificada com números, nesse caso, temos de fazer o ajuste antes de usar a função <code>summary()</code>, como fizemos antes de usar a função summary com o dataset <code>mtcars</code> em seções anteriores.</p>
</section>
<section id="resumindo-dados-com-summarise-do-pacote-dplyr" class="level3" data-number="12.6.2">
<h3 data-number="12.6.2" class="anchored" data-anchor-id="resumindo-dados-com-summarise-do-pacote-dplyr"><span class="header-section-number">12.6.2</span> Resumindo dados com <code>summarise()</code> do pacote <code>dplyr</code></h3>
<p>Vamos usar como exemplo o dataset <code>diabetes</code> disponível no site da Vanderbilt University School of Medicine:<br>
<a href="https://hbiostat.org/data/repo/diabetes.csv" class="uri">https://hbiostat.org/data/repo/diabetes.csv</a></p>
<p>Esse dataset contém dados de 403 pacientes e 19 variáveis num estudo sobre diabetes, obesidade e outros fatores de risco para doenças coronarianas. O data frame contém então 403 linhasa e 19 colunas. O dicionário de variáveis desse datase pode ser obtido no link a seguir: <a href="https://hbiostat.org/data/repo/Cdiabetes.html" class="uri">https://hbiostat.org/data/repo/Cdiabetes.html</a></p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/diabetes-dictionary.png" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">diabetes dictionary</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Para usar esse dataset é necessário fazer o download desse arquivo e depois carregar esse arquivo no R ou então podemos criar um código para ler os dados diretamente do site, como abaixo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://hbiostat.org/data/repo/diabetes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 403 Columns: 19
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): location, gender, frame
dbl (16): id, chol, stab.glu, hdl, ratio, glyhb, age, height, weight, bp.1s,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [403 × 19] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ id      : num [1:403] 1000 1001 1002 1003 1005 ...
 $ chol    : num [1:403] 203 165 228 78 249 248 195 227 177 263 ...
 $ stab.glu: num [1:403] 82 97 92 93 90 94 92 75 87 89 ...
 $ hdl     : num [1:403] 56 24 37 12 28 69 41 44 49 40 ...
 $ ratio   : num [1:403] 3.6 6.9 6.2 6.5 8.9 ...
 $ glyhb   : num [1:403] 4.31 4.44 4.64 4.63 7.72 ...
 $ location: chr [1:403] "Buckingham" "Buckingham" "Buckingham" "Buckingham" ...
 $ age     : num [1:403] 46 29 58 67 64 34 30 37 45 55 ...
 $ gender  : chr [1:403] "female" "female" "female" "male" ...
 $ height  : num [1:403] 62 64 61 67 68 71 69 59 69 63 ...
 $ weight  : num [1:403] 121 218 256 119 183 190 191 170 166 202 ...
 $ frame   : chr [1:403] "medium" "large" "large" "large" ...
 $ bp.1s   : num [1:403] 118 112 190 110 138 132 161 NA 160 108 ...
 $ bp.1d   : num [1:403] 59 68 92 50 80 86 112 NA 80 72 ...
 $ bp.2s   : num [1:403] NA NA 185 NA NA NA 161 NA 128 NA ...
 $ bp.2d   : num [1:403] NA NA 92 NA NA NA 112 NA 86 NA ...
 $ waist   : num [1:403] 29 46 49 33 44 36 46 34 34 45 ...
 $ hip     : num [1:403] 38 48 57 38 41 42 49 39 40 50 ...
 $ time.ppn: num [1:403] 720 360 180 480 300 195 720 1020 300 240 ...
 - attr(*, "spec")=
  .. cols(
  ..   id = col_double(),
  ..   chol = col_double(),
  ..   stab.glu = col_double(),
  ..   hdl = col_double(),
  ..   ratio = col_double(),
  ..   glyhb = col_double(),
  ..   location = col_character(),
  ..   age = col_double(),
  ..   gender = col_character(),
  ..   height = col_double(),
  ..   weight = col_double(),
  ..   frame = col_character(),
  ..   bp.1s = col_double(),
  ..   bp.1d = col_double(),
  ..   bp.2s = col_double(),
  ..   bp.2d = col_double(),
  ..   waist = col_double(),
  ..   hip = col_double(),
  ..   time.ppn = col_double()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>Lembre-se que será sempre util recodificar as variáveis categóricas como factor usando <code>as.factor()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>diabetes<span class="sc">$</span>gender   <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(diabetes<span class="sc">$</span>gender)</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a>diabetes<span class="sc">$</span>frame    <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(diabetes<span class="sc">$</span>frame)</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>diabetes<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(diabetes<span class="sc">$</span>location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com os dados lidos, podemos agora verificar as primeiras linhas com a função <code>head()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 19
     id  chol stab.glu   hdl ratio glyhb location     age gender height weight
  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt; &lt;fct&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1  1000   203       82    56  3.60  4.31 Buckingham    46 female     62    121
2  1001   165       97    24  6.90  4.44 Buckingham    29 female     64    218
3  1002   228       92    37  6.20  4.64 Buckingham    58 female     61    256
4  1003    78       93    12  6.5   4.63 Buckingham    67 male       67    119
5  1005   249       90    28  8.90  7.72 Buckingham    64 male       68    183
6  1008   248       94    69  3.60  4.81 Buckingham    34 male       71    190
# ℹ 8 more variables: frame &lt;fct&gt;, bp.1s &lt;dbl&gt;, bp.1d &lt;dbl&gt;, bp.2s &lt;dbl&gt;,
#   bp.2d &lt;dbl&gt;, waist &lt;dbl&gt;, hip &lt;dbl&gt;, time.ppn &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Agora sim, estamos prontos para usar a função <code>summarise()</code> do <code>dplyr</code>. Vamos usar a função <code>summarise()</code> para calcular a média e o desvio padrão da glicose, que está na variável denominada <code>stab.glu</code>. Vou precisar usar as funções <code>mean(stab.glu))</code> e <code>sd(stab.glu))</code>. Essas funções serão os argumentos da função <code>summarise()</code>.</p>
<p>1º - Indicar o data frame a ser usado (<code>diabetes</code>);<br>
2º - usar o operador pipe para passar esse data frame adiante;<br>
3º - agrupar os dados de acordo com o sexo (<code>gender</code>);<br>
3º - chamar a função <code>summarise()</code>;<br>
4º - definir os argumentos da função <code>summarise()</code>: a média (usando a função <code>mean()</code>) e o desvio padrão (usando a função <code>sd()</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="sc">|&gt;</span> </span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">|&gt;</span> </span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_da_glicose =</span> <span class="fu">mean</span>(stab.glu), <span class="at">desvio_padrao_da_glicose =</span> <span class="fu">sd</span>(stab.glu))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  gender media_da_glicose desvio_padrao_da_glicose
  &lt;fct&gt;             &lt;dbl&gt;                    &lt;dbl&gt;
1 female             103.                     43.6
2 male               112.                     63.6</code></pre>
</div>
</div>
<p>Podemos incluir as medidas que desejarmos como argumentos da função <code>summarise()</code>. Vamos acrescentar a medida da média e desvio padrão da idade, altura e peso, e dessa vez, estratificando pelo biotipo (variável <code>frame</code>), incluindo o número de participantes em cada grupo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="sc">|&gt;</span> </span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(frame) <span class="sc">|&gt;</span> </span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_glicose =</span> <span class="fu">mean</span>(stab.glu), </span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_glicose    =</span> <span class="fu">sd</span>(stab.glu),</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_altura  =</span> <span class="fu">mean</span>(height),</span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_altura     =</span> <span class="fu">sd</span>(height),</span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_peso    =</span> <span class="fu">mean</span>(weight),</span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_peso       =</span> <span class="fu">sd</span>(weight), </span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n             =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  frame media_glicose dp_glicose media_altura dp_altura media_peso dp_peso     n
  &lt;fct&gt;         &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1 large         121.        63.7         NA       NA          204.    43.2   103
2 medi…         104.        49.9         65.7      4.00        NA     NA     184
3 small          96.0       44.4         NA       NA          151.    30.0   104
4 &lt;NA&gt;          111.        48.4         NA       NA          172.    38.3    12</code></pre>
</div>
</div>
<p>Como várias das estatísticas retornaram com valores NA, é preciso incluir o argumento na.rm=TRUE, como faremos a seguir. Podemos também ordenar o data frame criado conforme desajarmos. Por exemplo, vou colocar a quantidade de participantes como a primeira coluna.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>diabetes <span class="sc">|&gt;</span> </span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(frame) <span class="sc">|&gt;</span> </span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n             =</span> <span class="fu">n</span>(),</span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_glicose =</span> <span class="fu">mean</span>(stab.glu), </span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_glicose    =</span> <span class="fu">sd</span>(stab.glu),</span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_altura  =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb334-7"><a href="#cb334-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_altura     =</span> <span class="fu">sd</span>(height,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb334-8"><a href="#cb334-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_peso    =</span> <span class="fu">mean</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb334-9"><a href="#cb334-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">dp_peso       =</span> <span class="fu">sd</span>(weight,   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  frame     n media_glicose dp_glicose media_altura dp_altura media_peso dp_peso
  &lt;fct&gt; &lt;int&gt;         &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
1 large   103         121.        63.7         66.6      3.42       204.    43.2
2 medi…   184         104.        49.9         65.7      4.00       178.    33.9
3 small   104          96.0       44.4         66.1      4.06       151.    30.0
4 &lt;NA&gt;     12         111.        48.4         65        5.06       172.    38.3</code></pre>
</div>
</div>
<p>Veja que esse data frame novo não foi armazenado em nenhum objeto ainda, se desejarmos fazer isso basta criar um nome para o objeto e usar o operador de atribuição <code>&lt;-</code>. No código abaixo coloquei o data frame criado num objeto chamado <code>resumo</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>resumo <span class="ot">&lt;-</span> diabetes <span class="sc">|&gt;</span> </span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(frame) <span class="sc">|&gt;</span> </span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarise</span>(<span class="at">n             =</span> <span class="fu">n</span>(),</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">media_glicose =</span> <span class="fu">mean</span>(stab.glu), </span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dp_glicose    =</span> <span class="fu">sd</span>(stab.glu),</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">media_altura  =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dp_altura     =</span> <span class="fu">sd</span>(height,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">media_peso    =</span> <span class="fu">mean</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dp_peso       =</span> <span class="fu">sd</span>(weight,   <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a>resumo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  frame     n media_glicose dp_glicose media_altura dp_altura media_peso dp_peso
  &lt;fct&gt; &lt;int&gt;         &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
1 large   103         121.        63.7         66.6      3.42       204.    43.2
2 medi…   184         104.        49.9         65.7      4.00       178.    33.9
3 small   104          96.0       44.4         66.1      4.06       151.    30.0
4 &lt;NA&gt;     12         111.        48.4         65        5.06       172.    38.3</code></pre>
</div>
</div>
</section>
<section id="resumindo-dados-com-skim-do-pacote-skimr" class="level3" data-number="12.6.3">
<h3 data-number="12.6.3" class="anchored" data-anchor-id="resumindo-dados-com-skim-do-pacote-skimr"><span class="header-section-number">12.6.3</span> Resumindo dados com <code>skim()</code> do pacote <code>skimr</code></h3>
<p>Vamos usar agora a função <code>skim</code> do pacote <code>skimr</code> para resumir os dados. Veja como essa função resolve de forma simples e rápida o problema de resumir os dados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">diabetes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">403</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">location</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Lou: 203, Buc: 200</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">fem: 234, mal: 169</td>
</tr>
<tr class="odd">
<td style="text-align: left;">frame</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">med: 184, sma: 104, lar: 103</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">15978.31</td>
<td style="text-align: right;">11881.12</td>
<td style="text-align: right;">1000.00</td>
<td style="text-align: right;">4792.50</td>
<td style="text-align: right;">15766.00</td>
<td style="text-align: right;">20336.00</td>
<td style="text-align: right;">41756.00</td>
<td style="text-align: left;">▇▇▇▁▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">chol</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">207.85</td>
<td style="text-align: right;">44.45</td>
<td style="text-align: right;">78.00</td>
<td style="text-align: right;">179.00</td>
<td style="text-align: right;">204.00</td>
<td style="text-align: right;">230.00</td>
<td style="text-align: right;">443.00</td>
<td style="text-align: left;">▁▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stab.glu</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">106.67</td>
<td style="text-align: right;">53.08</td>
<td style="text-align: right;">48.00</td>
<td style="text-align: right;">81.00</td>
<td style="text-align: right;">89.00</td>
<td style="text-align: right;">106.00</td>
<td style="text-align: right;">385.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">hdl</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">50.45</td>
<td style="text-align: right;">17.26</td>
<td style="text-align: right;">12.00</td>
<td style="text-align: right;">38.00</td>
<td style="text-align: right;">46.00</td>
<td style="text-align: right;">59.00</td>
<td style="text-align: right;">120.00</td>
<td style="text-align: left;">▂▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ratio</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">4.52</td>
<td style="text-align: right;">1.73</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">4.20</td>
<td style="text-align: right;">5.40</td>
<td style="text-align: right;">19.30</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">glyhb</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">5.59</td>
<td style="text-align: right;">2.24</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">4.38</td>
<td style="text-align: right;">4.84</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: right;">16.11</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">46.85</td>
<td style="text-align: right;">16.31</td>
<td style="text-align: right;">19.00</td>
<td style="text-align: right;">34.00</td>
<td style="text-align: right;">45.00</td>
<td style="text-align: right;">60.00</td>
<td style="text-align: right;">92.00</td>
<td style="text-align: left;">▆▇▆▃▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">height</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">66.02</td>
<td style="text-align: right;">3.92</td>
<td style="text-align: right;">52.00</td>
<td style="text-align: right;">63.00</td>
<td style="text-align: right;">66.00</td>
<td style="text-align: right;">69.00</td>
<td style="text-align: right;">76.00</td>
<td style="text-align: left;">▁▂▇▆▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weight</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">177.59</td>
<td style="text-align: right;">40.34</td>
<td style="text-align: right;">99.00</td>
<td style="text-align: right;">151.00</td>
<td style="text-align: right;">172.50</td>
<td style="text-align: right;">200.00</td>
<td style="text-align: right;">325.00</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">bp.1s</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">136.90</td>
<td style="text-align: right;">22.74</td>
<td style="text-align: right;">90.00</td>
<td style="text-align: right;">121.25</td>
<td style="text-align: right;">136.00</td>
<td style="text-align: right;">146.75</td>
<td style="text-align: right;">250.00</td>
<td style="text-align: left;">▅▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bp.1d</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">83.32</td>
<td style="text-align: right;">13.59</td>
<td style="text-align: right;">48.00</td>
<td style="text-align: right;">75.00</td>
<td style="text-align: right;">82.00</td>
<td style="text-align: right;">90.00</td>
<td style="text-align: right;">124.00</td>
<td style="text-align: left;">▁▆▇▃▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">bp.2s</td>
<td style="text-align: right;">262</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">152.38</td>
<td style="text-align: right;">21.71</td>
<td style="text-align: right;">110.00</td>
<td style="text-align: right;">138.00</td>
<td style="text-align: right;">149.00</td>
<td style="text-align: right;">161.00</td>
<td style="text-align: right;">238.00</td>
<td style="text-align: left;">▂▇▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bp.2d</td>
<td style="text-align: right;">262</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">92.52</td>
<td style="text-align: right;">11.56</td>
<td style="text-align: right;">60.00</td>
<td style="text-align: right;">84.00</td>
<td style="text-align: right;">92.00</td>
<td style="text-align: right;">100.00</td>
<td style="text-align: right;">124.00</td>
<td style="text-align: left;">▁▅▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">waist</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">37.90</td>
<td style="text-align: right;">5.73</td>
<td style="text-align: right;">26.00</td>
<td style="text-align: right;">33.00</td>
<td style="text-align: right;">37.00</td>
<td style="text-align: right;">41.00</td>
<td style="text-align: right;">56.00</td>
<td style="text-align: left;">▃▇▆▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hip</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">43.04</td>
<td style="text-align: right;">5.66</td>
<td style="text-align: right;">30.00</td>
<td style="text-align: right;">39.00</td>
<td style="text-align: right;">42.00</td>
<td style="text-align: right;">46.00</td>
<td style="text-align: right;">64.00</td>
<td style="text-align: left;">▁▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">time.ppn</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">341.25</td>
<td style="text-align: right;">309.54</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">90.00</td>
<td style="text-align: right;">240.00</td>
<td style="text-align: right;">517.50</td>
<td style="text-align: right;">1560.00</td>
<td style="text-align: left;">▇▂▂▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Observe que a função <code>skim()</code> reconheceu corretamente as variáveis location, gender e frame como categóricas, e as variáveis age, height, weight, bmi, waist, hip, time.ppn, and stab.glu como numéricas. A função <code>skim()</code> fornece um resumo estatístico de um conjunto de dados, incluindo medidas de tendência central, dispersão, distribuição e muito mais, sendo útil para obter uma visão geral rápida dos dados e identificar possíveis problemas ou padrões.</p>
</section>
<section id="resumindo-dados-com-describe-do-pacote-psych" class="level3" data-number="12.6.4">
<h3 data-number="12.6.4" class="anchored" data-anchor-id="resumindo-dados-com-describe-do-pacote-psych"><span class="header-section-number">12.6.4</span> Resumindo dados com <code>describe()</code> do pacote <code>psych</code></h3>
<p>Vamos usar agora a função <code>describe()</code> do pacote <code>psych</code> para resumir os dados. Veja como essa função também resolve de forma simples e rápida o problema de resumir os dados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          vars   n     mean       sd   median  trimmed     mad     min      max
id           1 403 15978.31 11881.12 15766.00 14704.79 8176.54 1000.00 41756.00
chol         2 402   207.85    44.45   204.00   204.93   37.06   78.00   443.00
stab.glu     3 403   106.67    53.08    89.00    94.54   17.79   48.00   385.00
hdl          4 402    50.45    17.26    46.00    48.52   14.83   12.00   120.00
ratio        5 402     4.52     1.73     4.20     4.36    1.63    1.50    19.30
glyhb        6 390     5.59     2.24     4.84     5.11    0.83    2.68    16.11
location*    7 403     1.50     0.50     2.00     1.50    0.00    1.00     2.00
age          8 403    46.85    16.31    45.00    46.22   19.27   19.00    92.00
gender*      9 403     1.42     0.49     1.00     1.40    0.00    1.00     2.00
height      10 398    66.02     3.92    66.00    65.98    4.45   52.00    76.00
weight      11 402   177.59    40.34   172.50   174.81   37.81   99.00   325.00
frame*      12 391     2.00     0.73     2.00     2.00    1.48    1.00     3.00
bp.1s       13 398   136.90    22.74   136.00   134.87   20.76   90.00   250.00
bp.1d       14 398    83.32    13.59    82.00    82.97   11.86   48.00   124.00
bp.2s       15 141   152.38    21.71   149.00   150.26   16.31  110.00   238.00
bp.2d       16 141    92.52    11.56    92.00    92.19   11.86   60.00   124.00
waist       17 401    37.90     5.73    37.00    37.58    5.93   26.00    56.00
hip         18 401    43.04     5.66    42.00    42.61    4.45   30.00    64.00
time.ppn    19 400   341.25   309.54   240.00   301.02  266.87    5.00  1560.00
             range  skew kurtosis     se
id        40756.00  0.81     0.06 591.84
chol        365.00  0.92     2.54   2.22
stab.glu    337.00  2.75     8.10   2.64
hdl         108.00  1.19     1.93   0.86
ratio        17.80  2.20    13.17   0.09
glyhb        13.43  2.23     4.98   0.11
location*     1.00 -0.01    -2.00   0.02
age          73.00  0.32    -0.67   0.81
gender*       1.00  0.33    -1.90   0.02
height       24.00  0.03    -0.21   0.20
weight      226.00  0.72     0.67   2.01
frame*        2.00  0.00    -1.12   0.04
bp.1s       160.00  1.10     2.38   1.14
bp.1d        76.00  0.27     0.04   0.68
bp.2s       128.00  1.17     2.34   1.83
bp.2d        64.00  0.18    -0.12   0.97
waist        30.00  0.47    -0.17   0.29
hip          34.00  0.80     0.83   0.28
time.ppn   1555.00  1.20     1.02  15.48</code></pre>
</div>
</div>
<p>Observe que a função <code>describe()</code> não foi capaz de interpretar corretamente as variáveis location, gender e frame como categóricas, tendo calculado diversas estatísticas inadequadas para esse tipo de variável, como por exemplo, média e desvio padrão.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10-Reading_data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Lendo dados</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-Ploting_graphics.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Gráficos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>